define("platform/common/constants",[],function(){"use strict";return{EDITOR_API_NS:"editorAPI",PLATFORM_PANEL:"PLATFORM_PANEL",PLATFORM_ON_EVENT:"PLATFORM_ON_EVENT",PLATFORM_SDK_ALIVE:"PLATFORM_SDK_ALIVE",PLATFORM_SDK_READY:"PLATFORM_SDK_READY",CONTROLLER_COMPONENT_TYPE:"platform.components.AppController",TPA_WIDGET_TYPE_TEMPLATE:{qname:{prefix:"$w",shortName:"IFrame"},componentType:"wysiwyg.viewer.components.tpapps.TPAWidget",tagName:"",members:null,events:null,baseTypes:{},inheritanceChain:null},ACTION_CONNECT:"connect",EVENTS:{controllerSettingsButtonClicked:"controllerSettingsButtonClicked",componentConnectButtonClicked:"componentConnectButtonClicked",createCollectionButtonClicked:"openCreateNewCollection",formBuilderAppClicked:"formBuilderAppClicked"},panelTypes:{COMPONENT_PANEL:"componentPanel",FULL_STAGE:"fullStagePanel",MODAL:"modalPanel",TOOL:"toolPanel",TOOL_BAR:"toolBarPanel"},pages:{page_settings:{layout:{type:"layout",fallbackType:"Pages_Layouts_Tab_Title"},permissions:{type:"permissions",fallbackType:"Pages_Permissions_Tab_Title"},pageInfo:{type:"page_info"},seo:{type:"seo"}},page_actions:{rename:{title:"Pages_Actions_Page_Rename",type:"Pages_Actions_Page_Rename",icon:"quickActionsRename"}}},members:{router_actions:{view_site_members:{title:"Pages_Panel_MemberMenu_SiteMembers_Link",type:"view_site_members",icon:"goToURLAction"},open_signup_settings:{title:"Pages_Panel_MemberMenu_SignupSettings_Link",type:"open_signup_settings",icon:"membersAction"}}},controller:{DEFAULT_STATE:"default"}}}),define("platform/bi/events.json",[],function(){return{CONTROLLER_GFPP_CLICK:{evid:26,src:79,endpoint:"platform",fields:{app_name:"string",action_name:"string",controller_type:"string",component_id:"string",pageId:"string"}},page_delete_dataset:{evid:91,src:79,endpoint:"platform",fields:{app_name:"string",controller_type:"string",component_id:"string",pageId:"string"}}}}),define("platform/appController/controllerSettingsGfpp",["lodash","platform/common/constants","platform/bi/events.json"],function(e,n,t){"use strict";function o(n,t){var o=e.get(n.platform.controllers.getStageData(e.head(t)),"mainAction.label");return e.isNil(o)?i:o}var r={dataset:"7f921134-acd3-4771-ac24-33bbeafefb90",router_dataset:"7f921134-acd3-4771-ac24-33bbeafefb90"},i="Manage Dataset",a={mainActions:[{label:o,shouldTranslate:!1,onClick:function(r,i){var a=e.head(i),c=r.components.data.get(a),p=n.EVENTS.controllerSettingsButtonClicked,s=r.documentServices.platform.controllers.settings.get(a),l=r.documentServices.platform.controllers.getName(a),u={controllerRef:a,controllerConfig:s,controllerType:c.controllerType,controllerDisplayName:l,origin:"gfpp"};r.bi.event(t.CONTROLLER_GFPP_CLICK,{action_name:o(r,i),app_name:c.applicationId,controller_type:c.controllerType,component_id:a.id,pageId:r.pages.getCurrentPageId()});var m=r.documentServices.platform.getAppDataByAppDefId(c.applicationId);r.documentServices.platform.notifyApplication(m.applicationId,{eventType:p,eventPayload:u})}}],presetActions:{help:{helpId:function(e,n){var t=e.components.data.get(n).controllerType;return r[t]||"3c9b0528-699b-475f-818c-2123885cb11f"}}}};return{init:function(e,n){a.enabledActions=[n.HELP],e("AppController",a)}}}),define("platform/appController/appController",["lodash","platform/appController/controllerSettingsGfpp","platform/bi/events.json"],function(e,n,t){"use strict";function o(n,t){var o=e.reduce(t,function(e,t){return n.components.is.container(t)?e.concat(t,n.components.get.byAncestor(t)):e.concat(t)},[]),r=void 0;return e.some(o,function(t){var i=n.documentServices.platform.controllers.connections.get(t);return!e.isEmpty(i)&&function(t){return r=r||e.keyBy(o,"id"),e(t).map("controllerRef").some(function(e){var t=e.id;return!r[t]&&n.components.getPage(e).id!==n.pages.getMasterPageId()})}(i)})}function r(n,t,r){function i(t){n.panelManager.openPanel("platform.panels.warnForDisconnectedComponentsPanel",e.assign({undo:n.history.undo},t))}t=e.isArray(t)?t:[t];var a=n.components.isShowOnAllPages(t),c=n.components.isShowOnAllPages(r);a&&!c&&function(n,t){return e(t).reduce(function(e,t){return n.components.is.container(t)?e.concat(t,n.components.get.byAncestor(t)):e.concat(t)},[]).some(function(e){return"platform.components.AppController"===n.components.getType(e)})}(n,t)&&i({controllerComp:!0}),!a&&c&&o(n,t)&&i({connectedComps:!0})}function i(e,o,i){return n.init(o,i),e.registerCannotRemovePlugin("platform.components.AppController",function(e,n){var o=e.components.data.get(n);e.bi.event(t.page_delete_dataset,{app_name:o.applicationId,controller_type:o.controllerType,controller_id:n.id,pageId:e.documentServices.pages.getPrimaryPageId()})}.bind(null,e)),e.editorEventRegistry.register(e.editorEventRegistry.constants.events.SET_CONTAINER_BEFORE,r),this}return{init:i}}),define("platform/common/utils",["lodash","util"],function(e,n){"use strict";return{getPanelName:function(e){return"platformPanels."+e},getFullApplicationUrl:function(t,o,r,i){var a=e.chain(window.location.search.substr(1)).thru(n.url.parseUrlParams).get("editorPlatformAppSources","").split(",").invokeMap("split",":").fromPairs().value();if(e.startsWith(o,"http"))return n.url.setUrlParam(o,"applicationId",i);var c=function(o){var i=t.documentServices.platform.getAppDataByAppDefId(r),a=e.get(i,"appFields.platform.editorScriptUrl");if(a)return a;var c=e.get(i,"editorArtifact");return c?o?n.url.joinURL(n.serviceTopology.scriptsDomainUrl,"services",c,o):n.serviceTopology.scriptsLocationMap[c]:void 0}(a[r]);if(c){var p=new URL(o,c).href;return n.url.setUrlParam(p,"applicationId",i)}}}}),define("platform/connection/connectableComponentsConfig",["lodash","experiment"],function(e,n){"use strict";var t=["WRichText","Image","MatrixGallery","PaginatedGridGallery","SliderGallery","SlideShowGallery","SiteButton","TextInput","TextAreaInput","Checkbox","RadioButton","RadioGroup","OptionsListInput","WPhoto","ImageButton","ComboBoxInput","Grid","DatePicker"],o=["Impress","Masonry","Thumbnails","StripSlideshow","StripShowcase","Accordion","Freestyle","Collage","Honeycomb","SlideShowGallery","TPA3DGallery","TPA3DCarousel"];return{getConnectableComponents:function(){return n.isOpen("se_addConnectButtonToTpaGalleries")&&(t=[].concat(t,o)),n.isOpen("se_addFileUploaderConnect")&&(t=[].concat(t,["FileUploader"])),n.isOpen("se_addSocialVideoPlayerConnect")&&(t=[].concat(t,["Video"])),n.isOpen("se_addColumnConnect")&&(t=[].concat(t,["Column"])),n.isOpen("se_addPageConnect")&&(t=[].concat(t,["Page"])),n.isOpen("se_addStripConnect")&&(t=[].concat(t,["StripColumnsContainer"])),[].concat(t)}}}),define("platform/connection/connectableComponents",["lodash","platform/common/constants","platform/connection/connectableComponentsConfig"],function(e,n,t){"use strict";var o={enabledActions:[n.ACTION_CONNECT]};return{registerGfpp:function(e){t.getConnectableComponents().forEach(function(n){e(n,o)})}}}),define("platform/connection/connection",["lodash","coreUtilsLib","platform/common/constants","platform/common/utils","platform/connection/connectableComponents"],function(e,n,t,o,r){"use strict";function i(n,t){return n.platform.controllers.connections.isConnectedToDataBindingController(e.head(t))}function a(o,r){var i=o.documentServices.platform.getInstalledAppsData(),a=1===i.length?e.head(i):"multiple application ids provided - TODO",c=e.head(r),p=t.EVENTS.componentConnectButtonClicked,s={componentRef:c,componentType:o.components.getType(c),componentSdkType:o.wixCode.getCompSdkType(c),origin:"gfpp"};o.documentServices.platform.notifyApplication(a.applicationId,{eventType:p,eventPayload:n.objectUtils.cloneDeep(s)})}var c={connect:{isSelected:function(n){var r=o.getPanelName(t.panelTypes.COMPONENT_PANEL);return e.some(n.panelManager.getOpenPanels(),{name:r})},isApplied:i,tooltip:"gfpp_component_connect",tooltip_active:"gfpp_component_connected_to_controllers",icon:"connect",rightClickMenuLabel:"PLATFORM_RightClick_Menu_Connect",className:function(e,n){return i(e,n)?"connected":""},onClick:a}};return{init:function(e,n){return e(c),r.registerGfpp(n),this},notifyConnectButtonClicked:a}}),define("platform/api/controllers/controllers",["lodash"],function(e){"use strict";function n(e,n,o){o=e.platform.getAppDataByApplicationId(o.applicationId);var r=n?n.id:null;return e.documentServices.components.getAllComponents(r,function(n){return e.components.getType(n)===t&&o.appDefinitionId===e.components.data.get(n).applicationId})}var t="platform.components.AppController";return{getAllCollections:function(){},listControllers:function(t,o,r,i){var a=n(t,e.get(i,"pageRef")||t.pages.getFocusedPage(),o);return e.map(a,function(e){return{controllerRef:e}})},listAllControllers:function(t,o){var r=n(t,null,o);return e.map(r,function(e){return{controllerRef:e}})},listConnectableControllers:function(t,o,r,i){var a=n(t,t.components.getPage(i.componentRef),o);return e.map(a,function(e){return{controllerRef:e}})},getControllerConnections:function(e,n,t,o){return e.documentServices.platform.controllers.connections.getControllerConnections(o.controllerRef)},listConnections:function(n,t,o,r){var i=n.documentServices.platform.controllers.connections.get(r.componentRef);return e.reject(i,{type:"WixCodeConnectionItem"})},listConnectedComponents:function(e,n,t,o){return e.documentServices.platform.controllers.connections.getConnectedComponents(o.controllerRef)},connect:function(n,t,o,r){return n.documentServices.platform.controllers.connections.connect(r.connectToRef,r.controllerRef,r.role,r.connectionConfig),e.pick(r,"connectToRef","controllerRef","role")},disconnect:function(e,n,t,o){e.documentServices.platform.controllers.connections.disconnect(o.connectToRef,o.controllerRef,o.role)},getData:function(n,t,o,r){var i=n.documentServices.platform.controllers.settings.get(r.controllerRef);return{type:e.get(n.components.data.get(r.controllerRef),"controllerType"),config:i,displayName:n.documentServices.platform.controllers.getName(r.controllerRef)}},saveConfiguration:function(e,n,t,o){return e.documentServices.platform.controllers.settings.set(o.controllerRef,o.config),new Promise(e.documentServices.waitForChangesApplied)},setDisplayName:function(e,n,t,o){return e.documentServices.platform.controllers.setName(o.controllerRef,o.name),new Promise(e.documentServices.waitForChangesApplied)},setState:function(e,n,t,o){return e.documentServices.platform.controllers.setState(o.state),new Promise(e.documentServices.waitForChangesApplied)}}}),define("platform/services/tokenService",["lodash"],function(e){"use strict";return{generatePanelToken:function(n){return e.uniqueId("platform_"+n+"_")},generateStaticGlobalPanelToken:function(n){return e.uniqueId("platform_"+n)}}}),define("platform/api/editor/utils/utils",["util"],function(e){"use strict";return{getLinkAsString:function(n,t,o,r){return e.link.getLinkValueAsString(n,r.link)}}}),define("platform/api/editor/editor",["lodash","jquery","pmrpc","constants","platform/common/constants","platform/common/utils","platform/services/tokenService","platform/api/editor/utils/utils","stateManagement"],function(e,n,t,o,r,i,a,c,p){"use strict";function s(t,o,a,c){var p=l(t,o,c),s=i.getPanelName(r.panelTypes.TOOL),u=function(t,o){o=o||{};var r=t.panelManager.getOpenPanels(),i=e.find(r,{type:"platform"});if(i){var a=n('[name="'+i.token+'"]');if(a){var c=a.offset();if(c&&e.isNumber(c.top)&&e.isNumber(c.left)){if(e.isNumber(o.x)&&e.isNumber(o.y))return{top:c.top+o.y,left:c.left+o.x};if(e.isNumber(o.height)&&e.get(i,"props.height")&&e.get(i,"props.width"))return{top:c.top+i.props.height/2-o.height/2,left:c.left+i.props.width/2}}}}return{top:"25%",left:"45%"}}(t,c);return e.merge(p,u),new Promise(function(e){t.panelManager.openPlatformPanel({panelName:s,panelProps:p,panelMetaData:{resolve:e}})})}function l(n,t,o){var r=n.documentServices.platform.getAppDataByApplicationId(t.applicationId),c=e.assign({token:a.generatePanelToken(r.appDefinitionId)},o);return o.url&&e.assign(c,{url:i.getFullApplicationUrl(n,o.url,r.appDefinitionId,r.applicationId)}),c}function u(n,t,o,r){var i=function(n,t){return e.find(n.panelManager.getOpenPanels(),{token:t})}(n,o);if(i){var a=l(n,t,r);a.token=o,n.panelManager.updatePanelProps(i.name,a)}}var m={IMAGE:function(e){return{uri:e.uri,title:e.title,width:e.width,height:e.height}},DOCUMENT:function(e){return{uri:e.uri,title:e.title}},VIDEO:function(n){var t=function(n){var t=Math.floor(n.length/2)-(1-n.length%2);return e.nth(n,t)}(n.fileOutput.image);return{id:n.id,title:n.title,posterUri:t&&t.url,posterWidth:t&&t.width,posterHeight:t&&t.height}}};return{openPanel:function(e,n,t,o,r){e.panelManager.openPanel(t,o,r)},openComponentPanel:function(e,n,t,a){var c=l(e,n,a);e.selection.selectComponentByCompRef(a.componentRef),e.panelManager.openPlatformPanel({panelName:i.getPanelName(r.panelTypes.COMPONENT_PANEL),panelProps:c,panelMetaData:{frameType:o.PANEL_TYPES.COMP,closeAllOtherPanels:!0}})},openModalPanel:function(e,n,t,o){var a=l(e,n,o);return new Promise(function(n){e.panelManager.openPlatformPanel({panelName:i.getPanelName(r.panelTypes.MODAL),panelProps:a,panelMetaData:{resolve:n}})})},openToolPanel:s,openPagePanel:function(n,t,o,r){var i=n.documentServices.pages.getPagesData(),a=r.pageRef.id,c=n.pages.dynamicPages.getMenuItems(),p=e.flatMap(c,"items"),s=n.mainMenu.getMenuItemsFlattened(i),l=e.find(s,["pageData.id",a])||e.find(p,{id:a}),u=n.pages.dynamicPages.getDynamicPageActions(a,"pageSettings")||[],m={menuItemToShowSettingsFor:l,selectedSettingsTab:e.isEmpty(u)?null:u[0].title};n.navigateAndOpenPagesPanel(a,m)},openFullStagePanel:function(e,n,t,a){var c=l(e,n,a);e.panelManager.openPlatformPanel({panelName:i.getPanelName(r.panelTypes.FULL_STAGE),panelProps:c,panelMetaData:{frameType:o.PANEL_TYPES.FULL_STAGE,closeAllOtherPanels:!0}})},openLinkPanel:function(n,t,o,r){return new Promise(function(t){var o={link:e.get(r,"value",null),callback:t,onCancelCallback:t};n.openLinkPanel(o)})},openMediaPanel:function(n,t,o,r){return r=e.defaults(r||{},{callOnCancel:!0,isMultiSelect:!0,mediaType:"IMAGE"}),new Promise(function(t){n.mediaServices.mediaManager.open(r.mediaType,{multiSelect:r.isMultiSelect,callback:function(n){var o=void 0;if(e.isEmpty(n))r.callOnCancel&&(o=null);else{e.isArray(n)||(n=[n]);var i=e.get(m,r.mediaType,m.IMAGE);o=n.map(i)}t(o)}})})},openHelpPanel:function(e,n,t,o){var r={component:e.selection.getSelectedComponentType(),learn_more:!1,panel_name:"platform"};e.panelManager.openHelpCenter(o.helpId,{origin:"platform"},r)},updatePanelOptions:u,closePanel:function(e,n,t,o){e.store.dispatch(p.panels.logic.closePlatformPanel(t,o))},setAppAPI:function(e,n){return t.api.request(n.applicationId,{target:e.documentServices.platform.getAppsContainer()}).then(function(e){t.api.set(n.applicationId,e)})},save:function(e){return new Promise(function(n,t){e.saveManager.saveInBackground(function(){n()},t)})},utils:c}}),define("platform/api/preview/preview",[],function(){"use strict";return{navigateTo:function(e,n,t,o){return new Promise(function(n){e.documentServices.platform.pages.navigateTo(o.pageUrl,function(){e.preview.isInPreviewMode()?n():e.preview.togglePreview(n)})})}}}),define("platform/api/vfs/vfs",["lodash"],function(e){"use strict";function n(e){return{name:e.name,fullPath:e.location,isDirectory:e.directory}}return{listChildren:function(t,o,r,i){var a=t.wixCode.fileSystem,c=a.getVirtualDescriptor(i.path,!0);return a.getChildren(c).then(function(t){return e.map(t,n)})},readFile:function(e,n,t,o){var r=e.wixCode.fileSystem,i=r.getVirtualDescriptor(o.path,!1);return r.readFile(i)},writeFile:function(e,n,t,o){var r=e.wixCode.fileSystem,i=r.getVirtualDescriptor(o.path,!1);return r.writeFile(i,o.content)},flush:function(e){return e.wixCode.fileSystem.flush()}}}),define("platform/api/pages/pages",["lodash","util"],function(e,n){"use strict";return{navigateTo:function(n,t,o,r){var i=e.get(r.pageRef,"id");if(i)return new Promise(function(e){n.pages.navigateTo(i,function(){e()})})},getCurrent:function(e){return e.documentServices.pages.getReference(e.documentServices.pages.getFocusedPageId())},rename:function(e,t,o,r){var i=r.pageRef.id,a=n.validate.pageNameValidator(r.title);return a||e.pages.data.update(i,{title:r.title}),a},add:function(e,n,t,o){return new Promise(function(n){var t=e.pages.add(o.title,o.definition);e.pages.navigateTo(t.id,function(){n(t)})})},data:{get:function(n,t,o,r){var i=r.pageRef.id,a=n.pages.data.get(i);return e.pick(a,["title","hidePage","pageSecurity"])},update:function(e,n,t,o){var r=o.pageRef.id;e.pages.data.update(r,o.data)}},permissions:{hasPassword:function(e,n,t,o){var r=o.pageRef.id;return e.documentServices.pages.permissions.hasPassword(r)},updatePagePassword:function(e,n,t,o){var r=o.pageRef.id;e.documentServices.pages.permissions.updatePassword(r,o.plainPassword)},removePagePassword:function(e,n,t,o){var r=o.pageRef.id;e.documentServices.pages.permissions.removePassword(r)}}}}),define("platform/api/components/components",["lodash"],function(e){"use strict";function n(n,t,o,r){return new Promise(function(t,o){e.isEmpty(r.componentDefinition.componentType)&&o(new Error("componentDefinition must contain componentType"));var i=n.components.buildDefaultComponentStructure(r.componentDefinition.componentType);!function(n,t,o){var r=e.get(o,"pageRef.id")||n.documentServices.pages.getFocusedPageId(),i=n.pasteLogic.addContext.getPastePosition(n,t.layout,r);e.merge(t.layout,i)}(n,i,r),e.merge(i,r.componentDefinition);var a=n.components.add(r.pageRef,i,r.customId,void 0,"editorSdk",{showAddToHeaderPanel:r.showAddToHeaderPanel});n.documentServices.waitForChangesApplied(function(){n.components.is.exist(a)?t(a):o(new Error("Could not add component"))})})}return{add:n,remove:function(e,n,t,o){return new Promise(function(n){e.documentServices.components.remove(o.componentRef),e.documentServices.waitForChangesApplied(n)})},getAllComponents:function(e){return e.documentServices.components.getAllComponents()},getPage:function(e,n,t,o){return e.components.getPage(o.componentRef)},getById:function(e,n,t,o){return e.documentServices.components.get.byId(o.id)},getChildren:function(e,n,t,o){var r=o.componentRef;return e.documentServices.components.getChildren(r,o.recursive||!1)},getAncestors:function(e,n,t,o){return e.documentServices.components.getAncestors(o.componentRef)},getType:function(e,n,t,o){return e.documentServices.components.getType(o.componentRef)},get:function(n,t,o,r){var i=r.componentRefs,a=r.properties||[],c=e.compact(e.isArray(i)?i:[i]);return e.reduce(c,function(t,o){var r={componentRef:o},i=n.documentServices.components.serialize(o);if(e.assign(r,e.pick(i,a)),e.includes(a,"sdkType")&&(r.sdkType=n.wixCode.getCompSdkType(o)),e.includes(a,"connections")){var c=n.documentServices.platform.controllers.connections.get(o);r.connections=e.reject(c,{type:"WixCodeConnectionItem"})}return e.includes(a,"style")&&(r.style=n.documentServices.components.style.get(o)),t.push(r),t},[])},properties:{get:function(e,n,t,o){return e.components.properties.get(o.componentRef)},update:function(e,n,t,o){e.components.properties.update(o.componentRef,o.props)}},data:{get:function(e,n,t,o){return e.components.data.get(o.componentRef)},update:function(e,n,t,o){e.components.data.update(o.componentRef,o.data,!0)}},layout:{get:function(e,n,t,o){return e.components.layout.get(o.componentRef)},update:function(e,n,t,o){return new Promise(function(n,t){try{e.documentServices.components.layout.update(o.componentRef,o.layout)}catch(e){t(e)}e.documentServices.waitForChangesApplied(n)})}},modes:{showComponentOnlyOnPagesGroup:function(e,n,t,o){return new Promise(function(n){e.documentServices.components.modes.showComponentOnlyOnPagesGroup(o.componentPointer,o.pagesGroupPointer),e.documentServices.waitForChangesApplied(n)})}}}}),define("platform/api/routers/routers",["lodash","util"],function(e,n){"use strict";function t(n,t,o,r){var i=n.documentServices.routers.get.byRef(r.routerRef),a=e.get(n.documentServices.platform.getAppDataByApplicationId(t.applicationId),"appDefinitionId");if(i&&a===i.appDefinitionId)return{id:i.id,prefix:i.prefix,config:i.config,pages:e(i.pages).invertBy().map(function(e,t){return{pageRef:n.documentServices.pages.getReference(t),pageRoles:e}}).value()}}function o(n,t,o,r){var i=e.get(n.documentServices.platform.getAppDataByApplicationId(t.applicationId),"appDefinitionId"),a=n.documentServices.routers.getRouterRef.byPrefix(r.prefix);if(!a)return a;var c=n.documentServices.routers.get.byRef(a);return c&&c.appDefinitionId===i?a:void 0}return{add:function(n,t,o,r){return new Promise(function(o,i){var a={appDefinitionId:e.get(n.documentServices.platform.getAppDataByApplicationId(t.applicationId),"appDefinitionId"),prefix:e.get(r,"prefix"),config:e.get(r,"config")};e.get(r,"group")&&(a.group=r.group);var c=n.documentServices.routers.add(a);n.documentServices.waitForChangesApplied(function(){n.documentServices.routers.get.byRef(c)?o(c):i(new Error("Could not add router"))})})},remove:function(n,t,o,r){var i=e.get(n.documentServices.platform.getAppDataByApplicationId(t.applicationId),"appDefinitionId"),a=n.documentServices.routers.get.byRef(r.routerRef);if(a&&a.appDefinitionId===i)return n.documentServices.routers.remove(r.routerRef)},get:t,getAll:function(n,r,i){var a=e.get(n.documentServices.platform.getAppDataByApplicationId(r.applicationId),"appDefinitionId");return e.map(n.documentServices.routers.get.byApp(a),function(e){var i=o(n,r,0,{prefix:e.prefix});return t(n,r,0,{routerRef:i})})},update:function(n,t,o,r){return new Promise(function(o){var i=e.get(n.documentServices.platform.getAppDataByApplicationId(t.applicationId),"appDefinitionId"),a=n.documentServices.routers.get.byRef(r.routerRef);a&&a.appDefinitionId===i&&(n.documentServices.routers.update(r.routerRef,r),n.documentServices.waitForChangesApplied(function(){o()}))})},getByPage:function(n,t,o,r){var i=e.get(n.documentServices.platform.getAppDataByApplicationId(t.applicationId),"appDefinitionId"),a=n.documentServices.routers.getRouterRef.byPage(r.pageRef);if(!a)return a;var c=n.documentServices.routers.get.byRef(a);return c&&c.appDefinitionId===i?a:void 0},getByPrefix:o,isValidPrefix:function(t,o,r,i){var a=e.get(o,"applicationId"),c=t.documentServices.routers.isValidPrefix(a,i.prefix);if(!c.valid){var p="";switch(c.message){case 1:p="DYNAMIC_PAGES_VALIDATION_PREFIX_CAN_NOT_BE_EMPTY";break;case 2:p="DYNAMIC_PAGES_VALIDATION_PREFIX_IS_TOO_LONG";break;case 3:p="DYNAMIC_PAGES_VALIDATION_PREFIX_IS_DUPLICATE_OF_URISEO";break;case 4:p="DYNAMIC_PAGES_VALIDATION_PREFIX_CONTAINS_INVALID_CHARCTERS";break;case 5:p="DYNAMIC_PAGES_VALIDATION_PREFIX_IS_FORBIDDEN_WORD";break;case 6:p="DYNAMIC_PAGES_VALIDATION_PREFIX_IS_IN_USE_BY_ANOTHER_APPLICATION"}c.message=n.translate(p)}return c},pages:{add:function(n,t,o,r){var i=e.get(n.documentServices.platform.getAppDataByApplicationId(t.applicationId),"appDefinitionId"),a=n.documentServices.routers.get.byRef(r.routerRef);if(a&&a.appDefinitionId===i)return n.documentServices.routers.pages.add(r.routerRef,r.pageTitle,r.pageRoles)},delete:function(n,t,o,r){return new Promise(function(o,i){var a=e.get(n.documentServices.platform.getAppDataByApplicationId(t.applicationId),"appDefinitionId"),c=n.documentServices.routers.get.byRef(r.routerRef);c&&c.appDefinitionId===a?n.pages.remove(r.pageRef.id,function(){o()},function(){i()},!1):i()})},connect:function(n,t,o,r){var i=e.get(n.documentServices.platform.getAppDataByApplicationId(t.applicationId),"appDefinitionId"),a=n.documentServices.routers.get.byRef(r.routerRef);if(a&&a.appDefinitionId===i)return n.documentServices.routers.pages.connect(r.routerRef,r.pageRef,r.pageRoles)},disconnect:function(n,t,o,r){var i=e.get(n.documentServices.platform.getAppDataByApplicationId(t.applicationId),"appDefinitionId"),a=n.documentServices.routers.get.byRef(r.routerRef);if(a&&a.appDefinitionId===i)return n.documentServices.routers.pages.disconnect(r.routerRef,r.pageRef)},move:function(n,t,o,r){var i=e.get(n.documentServices.platform.getAppDataByApplicationId(t.applicationId),"appDefinitionId"),a=n.documentServices.routers.get.byRef(r.fromRouterRef),c=n.documentServices.routers.get.byRef(r.toRouterRef);if(a&&c&&c.appDefinitionId===i&&a.appDefinitionId===i)return n.documentServices.routers.pages.move(r.pageRef,r.fromRouterRef,r.toRouterRef)},listConnectablePages:function(e){return e.documentServices.routers.pages.listConnectablePages()}}}}),define("platform/api/history/history",[],function(){"use strict";return{add:function(e,n,t,o){return new Promise(function(n){e.documentServices.waitForChangesApplied(function(){e.history.add(o.label),n()})})}}}),define("platform/api/ide/ide",["lodash"],function(e){"use strict";function n(e,n,t,o){return e.wixCode.collectionsTree.navigateToCollection(e,o.name)}function t(t,o,r,i){var a=i.path,c=t.wixCode.fileSystem.getRoots().schemas.location;if(function(n,t){return e.startsWith(t,n)&&e.endsWith(t,".json")}(c,a)){return n(t,0,0,{name:function(e,n){return n.replace(e,"").replace(".json","")}(c,i.path)})}return t.wixCode.fileTree.navigateToFile(t,i.path,e.pick(i,["functionName","caretOffset"]))}return{openFile:t,navigateToCollection:n,treePane:{isOpen:function(e){return e.developerMode.ui.treePane.isOpen()},toggle:function(e){return new Promise(function(n){e.developerMode.ui.treePane.toggle(function(){n()})})}}}}),define("platform/api/info/info",["lodash","util"],function(e,n){"use strict";function t(e,n){return["//",r(),"/my-account/sites/",e.documentServices.generalInfo.getMetaSiteId(),"/app/",n,"?referralInfo=editor"].join("")}function o(e){return["//",r(),"/my-account/sites/",e.documentServices.generalInfo.getMetaSiteId(),"/simple-app","?app=wixcode","&referralInfo=editor_platform"].join("")}function r(){var e=window.location.hostname.match(/editor\.(.*)/);return e?"www."+e[1]:"www.wix.com"}function i(e){return!e.documentServices.generalInfo.isFirstSave()}var a=window.mainLoaded||0;return{getDashboardUrl:function(n,r){return new Promise(function(a,c){var p=i(n),s=e.get(n.documentServices.platform.getAppDataByApplicationId(r.applicationId),"appDefinitionId");p?a(s===n.documentServices.platform.editorApps.DATA_BINDING.appDefId?o(n):t(n,s)):s===n.documentServices.platform.editorApps.DATA_BINDING.appDefId?n.saveManager.saveInBackground(function(){a(o(n))},c):n.saveManager.saveInBackground(function(){a(t(n,s))},c)})},getMetaSiteId:function(e){return e.documentServices.generalInfo.getMetaSiteId()},getEditorSessionId:function(){return n.editorSessionUtil.editorSessionId},getSiteId:function(e){return e.documentServices.generalInfo.getSiteId()},getEditorReadyTimestamp:function(){return e.now()-a},getEditorMode:function(e){return e.getDeviceType()},getAppDefinitionId:function(e,n){var t=n.applicationId;return e.documentServices.platform.getAppDataByApplicationId(t).appDefinitionId},isSitePublished:function(e){return e.documentServices.generalInfo.isSitePublished()},getLanguage:function(e){return e.documentServices.generalInfo.getLanguage()},isSiteSaved:i}}),define("platform/api/environment/environment",["util"],function(e){"use strict";return{getLocale:function(){return e.editorModel.languageCode}}}),define("platform/api/siteSegments/siteSegments",[],function(){"use strict";return{getFooter:function(e){return e.siteSegments.getFooter()},getHeader:function(e){return e.siteSegments.getHeader()},getPagesContainer:function(e){return e.siteSegments.getPagesContainer()},getSiteStructure:function(e){return e.siteSegments.getSiteStructure()}}}),define("platform/api/userPreferences/userPreferences",["lodash"],function(e){"use strict";return{site:{set:function(n,t,o,r){var i=e.get(n.documentServices.platform.getAppDataByApplicationId(t.applicationId),"appDefinitionId");if(!i)throw new Error("Illegal appData - application is not registered in clientSpecMap");e.forEach(r,function(e,t){n.userPreferences.site.set(t,e,i)})},get:function(n,t,o,r){var i=e.get(n.documentServices.platform.getAppDataByApplicationId(t.applicationId),"appDefinitionId");if(!i)throw new Error("Illegal appData - application is not registered in clientSpecMap");var a=e.isArray(r)?e(r).keyBy().mapValues(e.noop).value():r,c=e.mapValues(a,function(e,t){return n.userPreferences.site.get(t,i)});return e.defaults(c,a)}}}}),define("platform/api/tpa/tpa",["lodash"],function(e){"use strict";return{add:{application:function(n,t,o,r){return new Promise(function(t,o){e.get(r,"appDefinitionId")?n.tpa.addApplication(r.appDefinitionId,r).then(function(e){t(e)}).catch(function(e){o(e)}):o(new Error("options must contain appDefinitionId"))})},component:function(n,t,o,r){return new Promise(function(o,i){if((r=r||{}).componentType){if(r.appDefinitionId||(r.appDefinitionId=t.appDefinitionId),"WIDGET"===r.componentType){if(!e.isObject(r.widget))return void i(new Error("options must contain a widget object"));r.widget.tpaWidgetId=r.widget.widgetId}else if("PAGE"===r.componentType){if(!e.isObject(r.page))return void i(new Error("options must contain a page object"));if(r.page.isHidden&&!e.isBoolean(r.page.isHidden))return void i(new Error("isHidden param should be of type boolean"))}n.tpa.addComponent(r).then(function(e){o(e)}).catch(function(e){i(e)})}else i(new Error("options must contain componentType"))})}},isApplicationInstalled:function(n,t,o,r){return new Promise(function(t,o){e.get(r,"appDefinitionId")?t(n.documentServices.tpa.app.isInstalled(r.appDefinitionId)):o(new Error("options must contain appDefinitionId"))})},isAppSectionInstalled:function(n,t,o,r){return new Promise(function(o,i){if(e.get(r,"sectionId")){var a=t.applicationId;if(r.appDefinitionId){var c=n.documentServices.tpa.app.getDataByAppDefId(r.appDefinitionId);a=e.get(c,"applicationId")}o(n.documentServices.tpa.section.isSectionInstalledByTpaPageId(a,r.sectionId))}else i(new Error("options must contain sectionId"))})}}}),define("platform/api/language/language",[],function(){"use strict";return{add:function(e,n,t,o){e.documentServices.language.add(o.languageCode)},current:{set:function(e,n,t,o){e.documentServices.language.current.set(o.languageCode)}},multilingual:{init:function(e,n,t,o){e.documentServices.language.multilingual.init(o.languageCode)}}}}),define("platform/api/menu/menu",["lodash"],function(e){"use strict";return{create:function(n,t,o,r){return new Promise(function(o){var i=e.assign({appId:t.applicationId},r.menuData),a=n.documentServices.menu.create(i,r.customId);n.documentServices.waitForChangesApplied(function(){o(a)})})},connect:function(e,n,t,o){return new Promise(function(n){e.documentServices.menu.connect(o.menuCompPointer,o.menuId),e.documentServices.waitForChangesApplied(n)})},update:function(e,n,t,o){return new Promise(function(n){e.documentServices.menu.update(o.menuId,o.menuData),e.documentServices.waitForChangesApplied(n)})},remove:function(e,n,t,o){return new Promise(function(n){e.documentServices.menu.remove(o.menuId),e.documentServices.waitForChangesApplied(n)})},addItem:function(e,n,t,o){return new Promise(function(n){e.documentServices.menu.addItem(o.menuId,o.menuItem),e.documentServices.waitForChangesApplied(n)})},getById:function(e,n,t,o){return new Promise(function(n){var t=e.documentServices.menu.getById(o.menuId);e.documentServices.waitForChangesApplied(function(){n(t)})})}}}),define("platform/api/pagesGroup/pagesGroup",[],function(){"use strict";return{create:function(e,n,t,o){return new Promise(function(t){var r=e.documentServices.pagesGroup.create({groupName:o.groupName,appId:n.applicationId});e.documentServices.waitForChangesApplied(function(){t(r)})})},addPageToPagesGroup:function(e,n,t,o){return new Promise(function(n){e.documentServices.pagesGroup.addPageToPagesGroup(o.pagesGroupPointer,o.pageId),e.documentServices.waitForChangesApplied(n)})},getById:function(e,n,t,o){return e.documentServices.pagesGroup.getById(o.pagesGroupId)},getByGroupName:function(e,n,t,o){return e.documentServices.pagesGroup.getByGroupName(o.groupName)},getAll:function(e,n){return e.documentServices.pagesGroup.getAll(n.applicationId)},remove:function(e,n,t,o){return e.documentServices.pagesGroup.remove(o.pagesGroupPointer)}}}),define("platform/api/application/application",["lodash","experiment"],function(e,n){"use strict";return{install:function(t,o,r,i){return new Promise(function(o,r){e.get(i,"appDefinitionId")?n.isOpen("se_santaMembers")?t.documentServices.platform.provision(i.appDefinitionId,{origin:{type:"APP",info:{appDefinitionId:e.get(i,"initiatorAppDefinitionId")}}}).then(o,r):r():r(new Error("options must contain appDefinitionId"))})}}}),define("platform/api/theme/theme",[],function(){"use strict";return{colors:{getAll:function(e){return e.documentServices.theme.colors.getAll()}},fonts:{getMap:function(e){return e.documentServices.theme.fonts.getMap()}}}}),define("platform/api/fonts/fonts",[],function(){"use strict";return{getFontsOptions:function(e){return e.documentServices.fonts.getFontsOptions()}}}),define("platform/api/internalAPIs",["lodash"],function(e){"use strict";return{addApp:function(n,t,o){n.wixCode.provision(e.noop,e.noop),n.documentServices.platform.initApp({appDefinitionId:e.get(o,"appDefinitionId"),editorUrl:e.get(o,"editorUrl"),viewerUrl:e.get(o,"viewerUrl")})}}}),define("platform/api/selection/selection",["lodash"],function(e){"use strict";return{getSelectedComponents:function(e){return e.selection.getSelectedComponents()},deselectComponents:function(n,t,o,r){n.selection.deselectComponents(e.get(r,"compsToDeselect",[]))},selectComponentByCompRef:function(n,t,o,r){n.selection.selectComponentByCompRef(e.get(r,"compsToSelect",[]))}}}),define("platform/api/api",["lodash","platform/api/controllers/controllers","platform/api/editor/editor","platform/api/preview/preview","platform/api/vfs/vfs","platform/api/pages/pages","platform/api/components/components","platform/api/routers/routers","platform/api/history/history","platform/api/ide/ide","platform/api/info/info","platform/api/environment/environment","platform/api/siteSegments/siteSegments","platform/api/userPreferences/userPreferences","platform/api/tpa/tpa","platform/api/language/language","platform/api/menu/menu","platform/api/pagesGroup/pagesGroup","platform/api/application/application","platform/api/theme/theme","platform/api/fonts/fonts","platform/api/internalAPIs","platform/api/selection/selection"],function(e,n,t,o,r,i,a,c,p,s,l,u,m,f,d,g,v,P,C,I,S,_,A){"use strict";var y={preview:o,controllers:n,vfs:r,components:a,routers:c,history:p,ide:s,pages:i,info:l,environment:u,userPreferences:f,tpa:d,menu:v,pagesGroup:P,language:g,siteSegments:m,application:C,theme:I,fonts:S,__internal__:_,selection:A};return y.editor=e.assign(t,y),y}),define("platform/services/platformPostMessageService",["lodash","pmrpc","coreUtilsLib","platform/common/constants"],function(e,n,t,o){"use strict";function r(n,r){return function(i){if(i.data.intent===o.PLATFORM_PANEL&&i.data.sourcePanel===r)switch(i.data.type){case o.PLATFORM_SDK_READY:!function(n,o,r){if(e.isUndefined(n))return;o.event.eventPayload=t.objectUtils.cloneDeep(o.event.eventPayload),n.postMessage||(n=n.contentWindow);n.postMessage(o,r||"*")}(i.source,{intent:o.PLATFORM_ON_EVENT,event:{eventType:"startConfiguration",eventPayload:n}});break;default:return}}}return{init:function(e,t){n.api.set(o.EDITOR_API_NS,t,{onApiCall:e.documentServices.platform.reportAPICallBI})},createPostMessageListener:r}}),define("platform/plugins/componentsRemoveHandlerPlugins",["lodash","stateManagement"],function(e,n){"use strict";function t(t,o,r,i,a){if(function(n,t,o){var r=(o=e(o)).filter(function(e){return"platform.components.AppController"===n.components.getType(e)});if(r.isEmpty())return!1;var i=o.map("id").value();return r.map(function(e){return n.platform.controllers.connections.getConnectedComponents(e)}).some(function(n){return!e(n).map("id").difference(i).isEmpty()})}(o,0,i)){var c=e.filter(i,function(e){return"platform.components.AppController"===o.components.getType(e)}),p=1===c.length;return t(n.panels.logic.updateOrOpenPanel("platform.panels.appControllerDeleteConfirmationPanel",{onConfirm:a,isSingleController:p,controllerDisplayName:p?o.platform.controllers.getName(c[0]):""})),!0}return!1}function o(t,o,r,i,a){var c=!1;return e.forEach(i,function(r){var i=function(n,t){var o=e.head(n.platform.controllers.connections.get(t));if(!o)return!1;var r=e.get(n.platform.controllers.getStageData(o.controllerRef),["connections",o.role,"confirmOnDelete"]);return r||!1}(o,r);if(i)return t(n.panels.logic.updateOrOpenPanel("platform.panels.connectedComponentsDeleteConfirmationPanel",{onConfirm:a,title:i.title,contentText:i.contentText})),c=!0,!1}),c}return{confirmOnOrphanConnections:t,confirmOnProtectedComponents:o}}),define("platform/panels/appControllerDeleteConfirmationPanel.rt",["react","lodash","panels","baseUI"],function(e,n,t,o){"use strict";return function(){return e.createElement(t.frames.confirmationPanelFrame,{type:"important",panelName:"platform.panels.appControllerDeleteConfirmationPanel",onConfirm:this.props.onConfirm,confirmLabel:"PLATFORM_messages_delete",cancelLabel:"PLATFORM_messages_cancel_delete",panelTitle:this.getTitle()},e.createElement("div",{className:"icon"},e.createElement(o.symbol,{name:"deleteBlogConfirmationIcon"})),e.createElement("div",{className:"content"},e.createElement("p",{},this.getContentText())))}}),define("platform/panels/appControllerDeleteConfirmationPanel",["react","core","util","platform/panels/appControllerDeleteConfirmationPanel.rt"],function(e,n,t,o){"use strict";return e.createClass({displayName:"appControllerDeleteConfirmationPanel",mixins:[t.translationMixin,n.mixins.editorAPIMixin],propTypes:{controllerDisplayName:e.PropTypes.string,isSingleController:e.PropTypes.bool,onConfirm:e.PropTypes.func},getContentText:function(){var e=this.props.isSingleController?"PLATFORM_messages_delete_dataset_text":"PLATFORM_messages_multidelete_dataset_text";return this.translateTemplate(e,{appName:"Wix Database"},this.getEditorAPI())},getTitle:function(){var e=this.props.isSingleController?"PLATFORM_messages_delete_dataset_title":"PLATFORM_messages_multidelete_dataset_title";return this.translateTemplate(e,{appControllerName:this.props.controllerDisplayName},this.getEditorAPI())},render:o})}),define("platform/panels/connectedComponentsDeleteConfirmationPanel.rt",["react","lodash","panels","baseUI"],function(e,n,t,o){"use strict";return function(){return e.createElement(t.frames.confirmationPanelFrame,{type:"important",panelName:"platform.panels.connectedComponentsDeleteConfirmationPanel",onConfirm:this.props.onConfirm,confirmLabel:"PLATFORM_messages_delete",cancelLabel:"PLATFORM_messages_cancel_delete",panelTitle:this.getTitle()},e.createElement("div",{className:"icon"},e.createElement(o.symbol,{name:"deleteBlogConfirmationIcon"})),e.createElement("div",{className:"content"},e.createElement("p",{},this.getContentText())))}}),define("platform/panels/connectedComponentsDeleteConfirmationPanel",["react","core","util","higherOrderComponents","platform/panels/connectedComponentsDeleteConfirmationPanel.rt"],function(e,n,t,o,r){"use strict";var i=e.createClass({displayName:"connectedComponentsDeleteConfirmationPanel",propTypes:{title:e.PropTypes.string,contentText:e.PropTypes.string,onConfirm:e.PropTypes.func},getContentText:function(){return this.props.contentText||t.translationUtil.translateTemplate("PLATFORM_messages_confirm_delete_connected_component_text",{},this.props.reportOnBiError)},getTitle:function(){return this.props.title||t.translationUtil.translateTemplate("PLATFORM_messages_confirm_delete_connected_component_title",{},this.props.reportOnBiError)},render:r});return o.connectEditorAPI(function(e){return{reportOnBiError:e.documentServices.bi.error}})(i)}),define("platform/panels/warnForDisconnectedComponentsPanel.rt",["react","lodash","panels","baseUI"],function(e,n,t,o){"use strict";return function(){return e.createElement(t.frames.confirmationPanelFrame,{type:"important",panelName:"platform.panels.warnForDisconnectedComponentsPanel",onCancel:this.props.undo,confirmLabel:"PLATFORM_messages_continue",cancelLabel:"PLATFORM_messages_cancel",shouldCloseByDefaultOnConfirm:!0,panelTitle:this.getTitle()},e.createElement("div",{className:"icon"},e.createElement(o.symbol,{name:"platformWarning"})),this.props.connectedComps?e.createElement("div",{className:"content",key:"connectedCompsContent"},e.createElement("p",{},this.translateIfNeeded("PLATFORM_messages_move_connected_element_text_line1")),e.createElement("p",{},this.translateIfNeeded("PLATFORM_messages_move_connected_element_text_line2"))):null,this.props.connectedComps?null:e.createElement("div",{className:"content",key:"connectedDatasetContent"},e.createElement("p",{},this.translateIfNeeded("PLATFORM_messages_move_connected_dataset_text_line1")),e.createElement("p",{},this.translateIfNeeded("PLATFORM_messages_move_connected_dataset_text_line2"))))}}),define("platform/panels/warnForDisconnectedComponentsPanel",["react","lodash","util","platform/panels/warnForDisconnectedComponentsPanel.rt"],function(e,n,t,o){"use strict";return e.createClass({displayName:"warnForDisconnectedComponentsPanel",mixins:[t.translationMixin],propTypes:{undo:e.PropTypes.func.isRequired,connectedComps:e.PropTypes.bool.isRequired},getTitle:function(){var e=this.props.connectedComps?"PLATFORM_messages_move_connected_element_title":"PLATFORM_messages_move_connected_dataset_title";return this.translateIfNeeded(e)},render:o})}),define("platform",["lodash","experiment","platform/appController/appController","platform/connection/connection","platform/api/api","platform/services/platformPostMessageService","platform/services/tokenService","platform/common/constants","platform/common/utils","platform/plugins/componentsRemoveHandlerPlugins","platform/panels/appControllerDeleteConfirmationPanel","platform/panels/connectedComponentsDeleteConfirmationPanel","platform/panels/warnForDisconnectedComponentsPanel"],function(e,n,t,o,r,i,a,c,p,s,l,u,m){"use strict";function f(a,c,p,l,u){var m=g(r,a),f=a.documentServices.platform.getAPIForSDK(m);t.init(a,p,u),o.init(c,l),i.init(a,f),a.documentServices.platform.init(m),function(t){t.registerSitePublishedCallbacks(e.partial(d,t)),n.isOpen("se_platformConfirmOnDelete")&&t.registerComponentsRemoveHandlerPlugin(s.confirmOnProtectedComponents);t.registerComponentsRemoveHandlerPlugin(s.confirmOnOrphanConnections)}(a)}function d(n){var t=n.platform.getInstalledEditorApps();e.forEach(t,function(e){n.documentServices.platform.notifyApplication(e.applicationId,{eventType:"siteWasPublished"})})}function g(n,t){return e.isFunction(n)?e.partial(n,t):e.isObject(n)?e.mapValues(n,function(e){return g(e,t)}):n}return{api:r,init:f,platformPostMessageService:i,tokenService:a,constants:c,utils:p,panels:{appControllerDeleteConfirmationPanel:l,connectedComponentsDeleteConfirmationPanel:u,warnForDisconnectedComponentsPanel:m}}});
//# sourceMappingURL=platform.min.js.map