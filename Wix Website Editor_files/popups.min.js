define("popups/constants/closeButtonsConstants",[],function(){"use strict";return{ICON:"icon",ICON_TYPE:"wysiwyg.viewer.components.PopupCloseIconButton",TEXT:"text",TEXT_TYPE:"wysiwyg.viewer.components.PopupCloseTextButton"}}),define("popups/presets/closeButtonsPresets",["lodash","popups/constants/closeButtonsConstants"],function(e,t){"use strict";function o(o){var n=o.addPanelInfra.componentsDefaultData.getComponentDefault(t.TEXT_TYPE),s=e.head(function(e){return e.addPanelInfra.addPanelStyleManager.getComponentThemeStyles(t.TEXT_TYPE,e.theme,e.components)}(o));return n.layout=n.panelLayout,n.style=s,delete n.panelLayout,n}var n={};return n[t.ICON_TYPE]=function(o){var n=o.addPanel.getSectionsByComponentType(t.ICON_TYPE,null),s=e.get(n,"0.props.items.0.structure");return s.layout=e.omit(s.layout,["x","y"]),s},n[t.TEXT_TYPE]=o,n}),define("popups/actions/closeButtonsActions",["lodash","util","popups/constants/closeButtonsConstants","popups/presets/closeButtonsPresets"],function(e,t,o,n){"use strict";function s(o,s,p){var a=o.pages.popupPages.getCurrentPopup(),r=o.pages.popupPages.getPopupContainer(),i=o.components.layout.get(r);i.width=Math.min(980,i.width);var u=function(o,n,s){return e.defaults({layout:t.layoutUtils.convertAnyPositionToLeftTopPosition(e.assign({},o.layout,s),n)},o)}(n[s](o),i,p);o.components.add(r,u),o.history.add("added close "+s+" button to popup "+a.id)}function p(t,o){var n=t.pages.popupPages.getCurrentPopup(),s=t.components.get.byType(o,n);e.isEmpty(s)||(e.forEach(s,function(e){t.components.remove(e)}),t.history.add("removed close buttons from popup "+n.id))}return{addIconButton:function(e){s(e,o.ICON_TYPE,{y:20,right:20})},addTextButton:function(e){s(e,o.TEXT_TYPE,{center:0,bottom:20})},removeIconButton:function(e){p(e,o.ICON_TYPE)},removeTextButton:function(e){p(e,o.TEXT_TYPE)}}}),define("popups/constants/openBehaviorsConstants",[],function(){"use strict";return{DESKTOP:1,MOBILE:2,DESKTOP_AND_MOBILE:3,FLAG_DESKTOP:"openInDesktop",FLAG_MOBILE:"openInMobile",OPEN_DELAY_DEFAULT_VALUE:2,SITE_BEHAVIOR_TYPE:"site",LOAD_ACTION:"load",OPEN_POPUP_BEHAVIOR:"openPopup"}}),define("popups/queries/openBehaviorsQueries",["lodash","popups/constants/openBehaviorsConstants"],function(e,t){"use strict";function o(o,n){return e.isEmpty(o)?n.behaviors.getDefinition(t.OPEN_POPUP_BEHAVIOR):o[0]}function n(t,o){var n=t.documentServices.siteSegments.getSiteStructureId();return e.find(o,{pageId:n})}function s(t,o,s){var p=n(t,o);return p?e.map(s,function(t){return e.defaults({pageId:t},p)}):o}return{isOpenInMobile:function(e,n){return o(e,n).params[t.FLAG_MOBILE]},isMasterPageSelected:function(e,t){return!!n(e,t)},findMasterPageBehavior:n,getCurrentOpenBehaviors:function(e){var t=e.documentServices.pages.popupPages.getCurrentPopupId();return e.pages.popupPages.getOpenBehaviorsForPopupWithId(t)},getSomeBehavior:o,getDelay:function(e,t){return o(e,t).params.delay},getDenormalizedBehaviors:s,getDisabledPageIds:function(t,o,n){var p=s(n,t,n.documentServices.pages.getPageIdList());return e(p).reject({popupId:o}).map("pageId").value()}}}),define("popups/mappers/getInfoForActions",["lodash","popups/queries/openBehaviorsQueries"],function(e,t){"use strict";return function(o){var n=o.pages.popupPages.getCurrentPopup(),s=o.pages.popupPages.getOpenBehaviorsForPopups(),p=e.filter(s,{popupId:n.id}),a=t.getDisabledPageIds(s,n.id,o),r=o.documentServices.pages.getPageIdList();return{allPageIds:r,behaviorDefaults:t.getSomeBehavior(p,o).params,disabledPageIds:e.zipObject(a),enabledPageIds:e.difference(r,a),openBehaviors:p,popupPointer:n,selectedPageIds:e.map(p,"pageId")}}}),define("popups/actions/openBehaviorsActions",["core","lodash","popups/mappers/getInfoForActions","popups/queries/openBehaviorsQueries","popups/constants/openBehaviorsConstants"],function(e,t,o,n,s){"use strict";function p(e){return t(e.enabledPageIds).union(e.selectedPageIds).size()}function a(e,t,o){var n=p(t);i(e,{all_pages_selected:o,num_selected_pages:o?n:0,num_unselected_pages:o?0:n})}function r(e,o,n,s){var a=p(o),r=n?t(o.selectedPageIds).push(s).size():t(o.selectedPageIds).pull(s).size();i(e,{all_pages_selected:a===r,num_selected_pages:r,num_unselected_pages:a-r})}function i(t,o){t.bi.event(e.bi.events.popups.POP_UP_SETTINGS_PAGE_SELECTOR_OK,o)}function u(e,s){var p=e.documentServices.pages.popupPages.getCurrentPopupId(),a=e.pages.popupPages.getOpenBehaviorsForPopupWithId(p),i=n.findMasterPageBehavior(e,a),u=o(e);i?function(e,o,n){var s=t.without(e.documentServices.pages.getPageIdList(),n);d(e,e.documentServices.siteSegments.getSiteStructureId(),o.popupId),s.forEach(function(t){c(e,t,o.popupId,o.params)})}(e,i,s):d(e,s,p),r(e,u,!1,s),e.history.add("remove open behavior from page")}function c(e,t,o,n){var p=e.components.get.byId(t),a=e.components.get.byId(o),r=e.actions.getDefinition(s.LOAD_ACTION),i=e.behaviors.getDefinition(s.OPEN_POPUP_BEHAVIOR);i.params=n,e.behaviors.update(p,r,a,i)}function d(e,t,o){var n=e.components.get.byId(t),p=e.components.get.byId(o),a=e.actions.getDefinition(s.LOAD_ACTION),r=e.behaviors.getDefinition(s.OPEN_POPUP_BEHAVIOR);e.behaviors.remove(n,a,p,r)}function g(e,o){t.forEach(o,function(t){d(e,t.pageId,t.popupId)})}return{assignOpenBehaviorOnlyToCurrentPage:function(e){var n=o(e),s=e.documentServices.pages.getPrimaryPageId();r(e,n,!0,s),t.has(n.disabledPageIds,s)||(g(e,n.openBehaviors),c(e,s,n.popupPointer.id,n.behaviorDefaults),e.history.add("assign open behavior only to current page"))},removeOpenBehaviorFromAllPages:function(e){var t=o(e);g(e,t.openBehaviors),a(e,t,!1),e.history.add("remove open behavior from all pages")},assignOpenBehaviorToAllPages:function(e){var s=o(e),p=s.popupPointer.id,r=s.openBehaviors;n.isMasterPageSelected(e,r)||(t.isEmpty(s.disabledPageIds)?(g(e,r),c(e,e.documentServices.siteSegments.getSiteStructureId(),p,s.behaviorDefaults)):t(s.enabledPageIds).difference(s.selectedPageIds).forEach(function(t){c(e,t,p,s.behaviorDefaults)}),a(e,s,!0),e.history.add("assign open behavior to all pages"))},assignOpenBehaviorToPage:function(e,s){var p=o(e),a=p.popupPointer.id,i=p.openBehaviors;if(!n.isMasterPageSelected(e,i)&&!t.has(p.disabledPageIds,s)){var u=p.selectedPageIds.concat(s);u.length>1&&u.length===p.allPageIds.length?(g(e,i),c(e,e.documentServices.siteSegments.getSiteStructureId(),a,p.behaviorDefaults)):c(e,s,a,p.behaviorDefaults),r(e,p,!0,s),e.history.add("assign open behavior to page")}},removeOpenBehaviorFromPage:u,changeOpenDelay:function(e,o){var n=e.documentServices.pages.popupPages.getCurrentPopupId();e.pages.popupPages.getOpenBehaviorsForPopupWithId(n).forEach(function(n){c(e,n.pageId,n.popupId,t.defaults({delay:o},n.params))})},toggleLoadOnMobile:function(e,o){var n=e.documentServices.pages.popupPages.getCurrentPopupId();e.pages.popupPages.getOpenBehaviorsForPopupWithId(n).forEach(function(n){c(e,n.pageId,n.popupId,t.defaults({openInMobile:o},n.params))}),e.history.add("toggle load on mobile")}}}),define("popups/mappers/getPopupsInfoTitles",["lodash","popups/queries/openBehaviorsQueries"],function(e,t){"use strict";return function(o,n){var s=e.map(n,"id"),p=o.pages.popupPages.getOpenBehaviorsForPopups(),a=e.partial(function(t,o){return e.get(t,[o,0,"title"],"")},e.groupBy(n,"id"));return{infoTitles:e(p).groupBy("popupId").mapValues(function(n){return t.isMasterPageSelected(o,p)?e.map(s,a):e(n).map("pageId").map(a).value()}).value()}}}),define("popups/queries/closeButtonsQueries",["lodash","popups/constants/closeButtonsConstants"],function(e,t){"use strict";function o(t,o,n){var s=n.components.get.byType(t,o);return!e.isEmpty(s)}var n=t;return{getCloseButtonsInfo:function(e,t){var s={};return s[n.ICON]=o(n.ICON_TYPE,e,t),s[n.TEXT]=o(n.TEXT_TYPE,e,t),{has:s}}}}),define("popups/mappers/getDesktopPanelProps",["lodash","popups/queries/closeButtonsQueries","popups/queries/openBehaviorsQueries"],function(e,t,o){"use strict";return function(n){var s=n.pages.popupPages.getCurrentPopup(),p=n.pages.popupPages.getOpenBehaviorsForPopups(),a=e.filter(p,{popupId:s.id}),r=t.getCloseButtonsInfo(s,n);return{delay:o.getDelay(a,n),hasIconButton:r.has.icon,hasTextButton:r.has.text,isMasterPageSelected:o.isMasterPageSelected(n,a),selectedPageIds:e.map(a,"pageId")}}}),define("popups/mappers/getMobilePanelProps",["popups/queries/openBehaviorsQueries"],function(e){"use strict";return function(t){var o=e.getCurrentOpenBehaviors(t);return{shouldOpenInMobile:e.isOpenInMobile(o,t)}}}),define("popups/mappers/getPageSelectorPanelProps",["lodash","popups/queries/openBehaviorsQueries"],function(e,t){"use strict";var o=e.curry(function(e,t){var o=t[0].popupId;return e.pages.getPageTitle(o)});return function(n){var s=n.pages.popupPages.getCurrentPopup(),p=n.documentServices.pages.getPageIdList(),a=t.getDenormalizedBehaviors(n,n.pages.popupPages.getOpenBehaviorsForPopups(),p),r=e.filter(a,{popupId:s.id}),i=e.reject(a,{popupId:s.id}),u=e(i).groupBy("pageId").mapValues(o(n)).value(),c=e.difference(p,e.keys(u)),d=e.map(r,"pageId");return{selectAll:{visible:p.length>1,disabled:0===c.length,indeterminate:function(e,t,o){return e<t&&t<o}(0,r.length,c.length),checked:d.length>0&&d.length===c.length},selectedPageIds:d,occupiedPages:u}}}),define("popups",["popups/actions/closeButtonsActions","popups/actions/openBehaviorsActions","popups/mappers/getPopupsInfoTitles","popups/mappers/getDesktopPanelProps","popups/mappers/getMobilePanelProps","popups/mappers/getPageSelectorPanelProps"],function(e,t,o,n,s,p){"use strict";return{actions:{closeButtons:e,openBehaviors:t},mappers:{popupsList:o,desktopPanel:n,mobilePanel:s,pagesSelectorPanel:p}}});
//# sourceMappingURL=popups.min.js.map