define("wixCodeInit/utils/urlBuilder",[],function(){"use strict";function e(){for(var e=arguments[0],t=1;t<arguments.length;++t)e=e.replace(/\/$/,"")+"/"+arguments[t].replace(/^\//,"");return e}function t(e){return/^https?:\/\/localhost(:[0-9]+)?\/?$/.test(e)}function i(e){return/^https?:\/\/s3.amazonaws.com\/integration-tests-statics\/(.+)\/SNAPSHOT\/santa?$/.test(e)}function r(e){return/^\d+\.\d+\.\d+$/.test(e)}function n(e,t){var i=e.lastIndexOf("/");return r(t)?e.substring(0,i+1)+t:e}function o(e,r){var o=e.serviceTopology,a=t(e.santaBase)||i(e.santaBase)?o.scriptsLocationMap.santa:e.santaBase;return a=n(a,r),/(.*\/services\/)?(.*)/.exec(a)[2]}function a(t,i,r,n){var a=n?"pub":"dev",s="//"+i.instanceId+"."+a+".",c=t.serviceTopology.wixCloudBaseDomain,d="node_modules/santa-wix-code/"+(r.useWixCodeFallback?"fallback.html":"index.html");return s+e(c,"_partials",o(t,r.runtimeSource),d)}function s(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}return{buildUrl:function(e,t,i){i=i||{};var r=!!e.publicModel,n=a(e,t,i,r),o={compId:"wixCode_"+t.appDefinitionId,deviceType:i.isMobileView?"mobile":"desktop",viewMode:r?"site":e.renderFlags.componentViewMode||"preview",locale:e.rendererModel.languageCode,wixCodeBase:e.santaBase+"/node_modules/santa-wix-code","wix-code-platform":e.serviceTopology.scriptsLocationMap["wix-code-platform"]};return i.sdkSource&&(o.sdkSource=i.sdkSource),i.semiNativeSDKSource&&(o.semiNativeSDKSource=i.semiNativeSDKSource),i.applications&&(o.applications=JSON.stringify(i.applications)),i.ReactSource&&(o.ReactSource=i.ReactSource),i.ReactLibSource&&(o.ReactLibSource=i.ReactLibSource),i.ReactDomSource&&(o.ReactDomSource=i.ReactDomSource),n+"?"+s(o)},buildStaticUrl:function(e,t){t=t||{};var i=e.santaBase+"/node_modules/santa-wix-code/"+(t.useWixCodeFallback?"fallback.html":"index.html"),r=!!e.publicModel,n={deviceType:t.isMobileView?"mobile":"desktop",viewMode:r?"site":e.renderFlags.componentViewMode||"preview",locale:e.rendererModel.languageCode};return t.sdkSource&&(n.sdkSource=t.sdkSource),t.semiNativeSDKSource&&(n.semiNativeSDKSource=t.semiNativeSDKSource),t.applications&&(n.applications=JSON.stringify(t.applications)),t.ReactSource&&(n.ReactSource=t.ReactSource),t.ReactLibSource&&(n.ReactLibSource=t.ReactLibSource),t.ReactDomSource&&(n.ReactDomSource=t.ReactDomSource),i+"?"+s(n)}}}),define("wixCodeInit/utils/iFrameUtils",["lodash"],function(e){"use strict";return{getIFrameForApp:function(t,i){var r=window.document.createElement("iframe");return r.style.cssText="position: fixed; left: 0; right: 0; top: 0; bottom: 0; width: 1px; height: 1px; background: transparent; border: 0",r.tabIndex=-1,r.setAttribute("aria-hidden","true"),r.src=t,e.get(i,"applicationId")&&e.get(i,"appDefinitionId")&&(r.setAttribute("data-app-id",i.applicationId),r.setAttribute("data-app-definition-id",i.appDefinitionId)),r},isIFrameEvent:function(e,t){return t.source===e.contentWindow}}}),define("wixCodeInit/api/wixCodeAppApi",["lodash","platformInit","wixCodeInit/utils/urlBuilder","wixCodeInit/utils/iFrameUtils"],function(e,t,i,r){"use strict";function n(e){return("PLATFORM_IFRAME"===e.intent||"WIX_CODE"===e.intent)&&"wix_code_iframe_loaded"===e.type}function o(e){function t(){var t=window.document.body;t.insertBefore(e,t.firstChild),window&&window.performance&&window.performance.mark&&window.performance.mark("platform-iframe-added-to-dom")}"loading"!==window.document.readyState?t():window.document.addEventListener("DOMContentLoaded",function(){t()})}function a(t){var i=t.rendererModel.clientSpecMap.toJS?t.rendererModel.clientSpecMap.toJS():t.rendererModel.clientSpecMap;return!!t.rendererModel.wixCodeModel&&e.some(i,{type:"siteextension"})}return{getApi:function(){function e(e,i){r.isIFrameEvent(e,i)&&(n(i.data)&&u.setMessageHandler(function(t){e.contentWindow.postMessage(t,"*")}),t.biUtils.shouldUseFallbackReportBI(i.data,c)&&t.biUtils.reportBiWithWixBiSession(i.data),c.forEach(function(e){e(i.data)}))}function s(e){return d.reduce(function(e,t){return t(e)},e)}var c=[],d=[],u=t.messageProxy.get(),p=!1,l=!0,m=null,f=null,g=null,w=void 0;return{init:function(n,s,c){if(p)console.warn("Wix code is already initiated");else{var d=t.appsUtils.getAppsBaseInfo({clientSpecMap:s,serviceTopology:n.serviceTopology,rendererModel:n.rendererModel}).length>0,u=void 0;if(a(n)){var l=t.specMapUtils.getAppSpec(s);u=i.buildUrl(n,l,c),w=r.getIFrameForApp(u,l)}else{if(!d)return;u=i.buildStaticUrl(n,c),w=r.getIFrameForApp(u,{})}var m=e.bind(null,w);window.addEventListener("message",m,!1),o(w),p=!0}},sendMessage:function(e){e&&u.sendOrHoldMessage(s(e))},registerMessageHandler:function(e){c.push(e)},registerMessageModifier:function(e){d.push(e)},unregisterMessageHandler:function(e){var t=c.indexOf(e);-1!==t&&c.splice(t,1)},preLoadWidgets:function(e,i){!m&&a(e)&&t.widgetsPreLoader.asyncGetPreLoadMessage(e,i,function(e){l&&!m&&(m=e,u.sendOrHoldMessage(m))})},preLoadUserCode:function(e,i){(!f&&a(e)||t.appsUtils.getAppsBaseInfo({clientSpecMap:e.rendererModel.clientSpecMap,serviceTopology:e.serviceTopology,rendererModel:e.rendererModel}))&&t.widgetsPreLoader.asyncGetPreLoadUserCodeMessage(e,i,function(e){f||(f=e,u.sendOrHoldMessage(f))})},preInitWidgets:function(e,i){!g&&a(e)&&t.widgetsPreLoader.asyncGetPreInitMessage(e,i,function(e){g||(g=e,u.sendOrHoldMessage(g))})},isAppInitiated:function(){return p},getAppsIframe:function(){return w}}}}}),define("wixCodeInit/api/initMainR",["lodash","platformInit"],function(e,t){"use strict";var i="//static.parastorage.com/services/semi-native-sdk/1.7.0/lib/wix.min.js",r="//unpkg.parastorage.com/react@16.0.0/umd/react",n="//unpkg.parastorage.com/react-dom@16.0.0/umd/react-dom";return function(o,a,s,c,d,u,p){function l(e){return t.specMapUtils.getAppSpec(e)||I.applications.length}function m(e){return new e.FullSiteData(s,function(){})}function f(t,i){if(!i)return!1;var r=e.find(t.pageList.pages,{pageId:i});return!!r&&!r.pageJsonFileName}function g(e){var t=m(e);t.currentUrl=e.urlUtils.parseUrl(u);var i=e.wixUrlParser.parseUrl(t,u);return i&&i.pageId}function w(e,t,i){t&&f(t,g(i))||(o.init(s,e,I),l(e)&&(o.preLoadUserCode(s,u),!!s.publicModel&&o.preLoadWidgets(s,u)))}u=u||window.document.location.href;var S=e.trimEnd(s.serviceTopology.scriptsLocationMap["js-wixcode-sdk"],"/")+"/lib/"+(d.getParameterByName("debug")?"wix.js":"wix.min.js"),M=i||e.trimEnd(s.serviceTopology.scriptsLocationMap["semi-native-sdk"],"/")+"/lib/"+(d.getParameterByName("debug")?"wix.js":"wix.min.js"),v=function(e){return"false"!==e&&("true"===e||!window.Worker||p)}(d.getParameterByName("useWixCodeFallback")),b=r+(d.getParameterByName("debug")?".development.js":".production.min.js"),x=n+(d.getParameterByName("debug")?".development.js":".production.min.js"),I={isMobileView:c,sdkSource:S,semiNativeSDKSource:M,runtimeSource:d.getParameterByName("WixCodeRuntimeSource"),ReactLibSource:b,ReactDomSource:x,ReactSource:d.getParameterByName("ReactSource"),useWixCodeFallback:v},y=d.getParameterByName("viewerPlatformAppSources");I.applications=t.appsUtils.getAppsBaseInfo({rendererModel:s.rendererModel,clientSpecMap:s.rendererModel.clientSpecMap,serviceTopology:s.serviceTopology,viewerPlatformAppSources:y,santaBase:s.santaBase}),function(){function t(e){w(s.rendererModel.clientSpecMap,s.publicModel,e)}e.isObject(a)?t(a):requirejs.defined("utils")?t(requirejs("utils")):requirejs(["utils"],t)}()}}),define("wixCodeInit",["wixCodeInit/api/wixCodeAppApi","wixCodeInit/api/initMainR","platformInit"],function(e,t,i){"use strict";return{getAppApi:e.getApi,initMainR:t,appsUtils:i.appsUtils,specMapUtils:i.specMapUtils,registerDeps:i.registerDeps}});
//# sourceMappingURL=wixCodeInit.min.js.map