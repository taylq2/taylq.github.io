define("fileUploader/components/fileUploader",["santaProps","lodash","reactDOM","core","textCommon","siteUtils"],function(e,t,i,o,n,s){"use strict";function l(e){return t.assign(o.compMixins.validatableWithSyncMixin.getPublicState(e),{value:t.get(e,["value"],[]),uploadStatus:t.get(e,"uploadStatus",c.NOT_STARTED),serverMessage:t.get(e,"serverMessage","")})}function r(e){var i=t.get(e,"valid"),o=t.get(e,"fileNotUploaded");return!i&&!o}var a=o.compMixins,p=e.Types,d=s.fileUploadManager,c={NOT_STARTED:"NOT_STARTED",STARTED:"STARTED",FAILED:"FAILED",DONE:"DONE"};return{displayName:"FileUploader",mixins:[a.skinBasedComp,n.textScaleMixin,o.compMixins.inputFocusMixin,o.compMixins.validatableWithSyncMixin.validatableWithSync,o.compMixins.compStateMixin(l)],statics:{useSantaTypes:!0,behaviors:t.assign({reset:{methodName:"reset"}},o.compMixins.inputFocusMixin.INPUT_FOCUS_BEHAVIORS,o.compMixins.validatableWithSyncMixin.VALIDATABLE_WITH_SYNC_BEHAVIORS)},propTypes:{compData:e.Types.Component.compData.isRequired,scale:e.Types.Component.scale,compProp:e.Types.Component.compProp.isRequired,siteMediaToken:p.RendererModel.siteMediaToken.isRequired,windowKeyboardEvent:e.Types.SiteAspects.windowKeyboardEvent.isRequired,getMediaFullStaticUrl:e.Types.ServiceTopology.getMediaFullStaticUrl,shouldResetComponent:e.Types.RenderFlags.shouldResetComponent.isRequired},getInitialState:function(){return this.uploadCounter=0,l()},isUploading:function(){return this.state.uploadStatus===c.STARTED},componentDidMount:function(){this.props.windowKeyboardEvent.registerToKeyDownWithFocus(this,this.refs.chooseFileButton)},componentWillReceiveProps:function(e){e.shouldResetComponent&&this.props.shouldResetComponent!==e.shouldResetComponent&&(this.hideValidityIndication(),this.removeFile(!1))},onKeyDown:function(e){if(!this.props.compProp.isDisabled&&t.includes([13,32],e.keyCode)){var i=t.includes(e.target.className,"chooseFileButton"),o=t.includes(e.target.classList[0],"uploadName");i?(this.refs.fileInput.click(),this.refs.chooseFileButton.blur()):o&&this.removeFile()}},focus:function(){this.refs.chooseFileButton.focus()},blur:function(){this.refs.chooseFileButton.blur()},createFileNodes:function(e){var i=this.props.compProp.showPlaceholder,o=this.props.compProp.filesAlignment,n=this.props.compData.placeholderLabel,s=t.cloneDeep(this.state.value),l={isPlaceholder:!!t.isEmpty(s)&&i,alignment:o,previewState:e,errorState:this.hasErrorIndication()&&this.shouldShowValidityIndication(),removeFunction:this.removeFile,scale:this.props.scale,uploading:this.isUploading()};return t.isEmpty(s)&&(e&&t.includes(e.split(" "),"regular")?(s.push({name:"Example.txt"}),l.isPlaceholder=!1):(n=""===n?" ":n,s.push({name:n}),i&&" "!==n||(l.hidePlaceholder=!0))),t.map(s,function(e,t){return this.createChildComponent({id:"uploadName"+t,fileName:e.name},"wysiwyg.viewer.components.inputs.uploadName","uploadName",l)}.bind(this))},removeFile:function(e){this.isUploading()||(e=t.isNil(e)||e,this.setState(l(),function(){i.findDOMNode(this.refs.fileInput).value="",e&&this.handleAction(s.constants.ACTION_TYPES.CHANGE)}))},setUserCallback:function(e){this.userCallback=e},clearUserCallback:function(){this.userCallback=null},applyUserCallback:function(e,t){this.userCallback&&this.userCallback(e,t),this.clearUserCallback()},reset:function(){this.resetValidity(),this.setState(l(),function(){i.findDOMNode(this.refs.fileInput).value="",this.uploadCounter++,this.applyUserCallback(null,{errorCode:-1,errorDescription:"Upload Reset"})})},shouldExecuteUploadCb:function(e){return e===this.uploadCounter},getUploadCompleteCB:function(e){return function(t){if(this.shouldExecuteUploadCb(e)){var i=t[0];"Image"===this.props.compProp.filesType&&(i.uri=i.file_name,i.title=i.file_name),"Document"===this.props.compProp.filesType&&(i.uri=i.file_name,i.filename=i.original_file_name),this.uploadCounter++,this.setState({uploadStatus:c.DONE},function(){this.handleAction(s.constants.ACTION_TYPES.VALIDATE),this.applyUserCallback(i,null)})}}.bind(this)},getUploadFailedCB:function(e){return function(t){if(this.shouldExecuteUploadCb(e)){var i={errorCode:t.error_code,errorDescription:t.error_description};this.uploadCounter++,this.setState({uploadStatus:c.FAILED,serverMessage:i.errorDescription},function(){this.handleAction(s.constants.ACTION_TYPES.VALIDATE),this.applyUserCallback(null,i)})}}.bind(this)},isReadyToUpload:function(){return!this.isUploading()&&!t.isEmpty(this.state.value)&&!r(this.getValidity())},uploadFiles:function(e){if(this.isReadyToUpload()){var i=this.props.siteMediaToken,o=this.props.compProp.filesType;this.setUserCallback(e);var n=this.getUploadCompleteCB(this.uploadCounter),s=this.getUploadFailedCB(this.uploadCounter);this.setState({uploadStatus:c.STARTED},function(){t.forEach(this.refs.fileInput.files,function(e){d.uploadFile(e,i,o,n,s)})})}else e&&e(null,{errorCode:-1,errorDescription:"No File To Upload"})},onFileSelectionChange:function(){if(this.refs.fileInput.files.length>0){var e=t.map(this.refs.fileInput.files,function(e){return{name:e.name,size:e.size}});this.setState({value:e,uploadStatus:c.NOT_STARTED},function(){this.handleAction(s.constants.ACTION_TYPES.CHANGE)})}},getAcceptableFileTypes:function(){switch(this.props.compProp.filesType){case"Image":return".jpeg,.png,.jpg";case"Document":return".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.odp,.odt,.epub"}},handleButtonFocus:function(e){this.handleAction(s.constants.ACTION_TYPES.FOCUS,e)},handleButtonBlur:function(e){this.handleAction(s.constants.ACTION_TYPES.BLUR,e)},hasErrorIndication:function(){if(this.isValid())return!1;var e=this.getValidity();return t.some(t.omit(e,"fileNotUploaded","valid"))||this.state.uploadStatus===c.FAILED},getSkinProperties:function(){var e=this.props.compData,t=this.props.compProp,i={"no-label":""===e.buttonLabel};i[t.buttonAlignment]=!0;var o=this.getComponentPreviewState()||this.props.previewState,n=!!this.props.compProp.isDisabled||this.isUploading();return{"":{},chooseFileButton:{className:this.classSet(i),onClick:function(){n||(this.refs.fileInput.click(),this.refs.chooseFileButton.blur())}.bind(this),onFocus:n?null:this.handleButtonFocus,onBlur:n?null:this.handleButtonBlur,"data-preview":o,"data-disabled":n,"data-error":this.hasErrorIndication()&&this.shouldShowValidityIndication()},buttonLabel:{children:[e.buttonLabel],style:this.getFontSize("btn_fnt")},fileInput:{onChange:this.onFileSelectionChange,accept:this.getAcceptableFileTypes()},files:{children:this.createFileNodes(o),"data-preview":o}}}}}),define("fileUploader/components/uploadName",["santaProps","react","lodash","core","textCommon"],function(e,t,i,o,n){"use strict";return{displayName:"UploadName",mixins:[o.compMixins.skinBasedComp,n.textScaleMixin],statics:{useSantaTypes:!0},propTypes:i.assign({compData:e.Types.Component.compData.isRequired,compProp:e.Types.Component.compProp.isRequired,alignment:t.PropTypes.string.isRequired,removeFunction:t.PropTypes.func.isRequired,isPlaceholder:t.PropTypes.bool.isRequired,scale:t.PropTypes.number.isRequired,previewState:t.PropTypes.string,errorState:t.PropTypes.bool,uploading:t.PropTypes.bool,windowKeyboardEvent:e.Types.SiteAspects.windowKeyboardEvent.isRequired}),componentDidMount:function(){var e=this.props.id.split("uploadName")[0];this.props.windowKeyboardEvent.registerToKeyDownWithFocus({props:{id:e}},this.refs["x-icon"])},getSkinProperties:function(){var e=this.props.compData,t={};t["align-"+this.props.alignment]=!0,t["hide-placeholder"]=this.props.hidePlaceholder;var i=!!this.props.compProp.isDisabled||this.props.uploading,o=this.getComponentPreviewState()||this.props.previewState,n=this.props.errorState;return{"":{className:this.classSet(t),"data-preview":o,"data-error":n},"x-icon":{style:this.props.isPlaceholder?{display:"none"}:{},onClick:function(){this.props.removeFunction&&!this.props.uploading&&this.props.removeFunction(e.fileName)}.bind(this),"data-preview":o,"data-disabled":i},"file-name":{className:this.classSet({"file-name-placeholder":this.props.isPlaceholder}),children:[e.fileName],"data-preview":o,"data-disabled":i,style:this.getFontSize("file_fnt",this.props.scale)}}}}}),define("fileUploader/skins/skins.json",[],function(){"use strict";var e={};return e["wysiwyg.viewer.skins.FileUploaderDefaultSkin"]={react:[["div","chooseFileButton",[],{tabIndex:0},["svg",null,[],{width:"15px",height:"15px",viewBox:"0 0 15 15",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},["g","Page-1",[],{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},["g","plusIcon",[],{},["rect","Rectangle-2",[],{x:"6",y:"1",width:"3",height:"13"}],["rect","Rectangle",[],{x:"1",y:"6",width:"13",height:"3"}]]]],["span","buttonLabel",[],{}]],["input","fileInput",[],{type:"file",ref:"fileInput"}],["div","files",[],{}]],exports:{uploadName:{skin:"wysiwyg.viewer.skins.UploadNameDefaultSkin"}},params:{btn_bg:"BG_COLOR",btn_brd:"COLOR_ALPHA",btn_brw:"SIZE",btn_rd:"BORDER_RADIUS",btn_shd:"BOX_SHADOW",btn_txt:"COLOR",btn_fnt:"FONT",btn_bg_h:"BG_COLOR",btn_brd_h:"COLOR_ALPHA",btn_brw_h:"SIZE",btn_txt_h:"COLOR",bg_f:"BG_COLOR",brd_f:"COLOR_ALPHA",brw_f:"SIZE",txt_f:"COLOR",bg_d:"BG_COLOR",brd_d:"COLOR_ALPHA",brw_d:"SIZE",txt_d:"COLOR",bg_e:"BG_COLOR",brd_e:"COLOR_ALPHA",brw_e:"SIZE",txt_e:"COLOR"},paramsDefaults:{btn_bg:"color_1",btn_brd:"color_6",btn_brw:"1px",btn_rd:"0",btn_shd:"0 0 0 transparent",btn_txt:"color_6",btn_fnt:"font_9",btn_bg_h:"color_1",btn_brd_h:"color_6",btn_brw_h:"1px",btn_txt_h:"color_6",bg_f:"color_18",brd_f:"color_6",brw_f:"0",txt_f:"color_28",bg_d:"color_18",brd_d:"color_6",brw_d:"1px",txt_d:"color_6",bg_e:"color_1",brd_e:"color_6",brw_e:"1px",txt_e:"color_6"},css:{"%":"display:-webkit-box;display:-webkit-flex;display:flex;height:100%;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column;","%fileInput":"height:0;width:0;visibility:hidden;","%chooseFileButton":"display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;height:100%;padding-left:10px;padding-right:10px;cursor:pointer;background-color:[btn_bg];border:solid [btn_brd] [btn_brw];[btn_rd]  [btn_shd]","%chooseFileButton %plusIcon":"fill:[btn_txt];","%chooseFileButton %buttonLabel":"[btn_fnt]    color:[btn_txt];display:inline-block;position:relative;white-space:nowrap;",'%chooseFileButton:hover,%chooseFileButton[data-preview~="hover"]':"background-color:[btn_bg_h];border:solid [btn_brd_h] [btn_brw_h];",'%chooseFileButton:hover %plusIcon,%chooseFileButton[data-preview~="hover"] %plusIcon':"fill:[btn_txt_h];",'%chooseFileButton:hover %buttonLabel,%chooseFileButton[data-preview~="hover"] %buttonLabel':"color:[btn_txt_h];",'%chooseFileButton:focus,%chooseFileButton[data-preview~="focus"]':"background-color:[bg_f];border:solid [brd_f] [brw_f];",'%chooseFileButton:focus %plusIcon,%chooseFileButton[data-preview~="focus"] %plusIcon':"fill:[txt_f];",'%chooseFileButton:focus %buttonLabel,%chooseFileButton[data-preview~="focus"] %buttonLabel':"color:[txt_f];",'%chooseFileButton[data-disabled="true"],%chooseFileButton[data-preview~="disabled"]':"background-color:[bg_d];border:solid [brd_d] [brw_d];cursor:default;",'%chooseFileButton[data-disabled="true"] %plusIcon,%chooseFileButton[data-preview~="disabled"] %plusIcon':"fill:[txt_d];",'%chooseFileButton[data-disabled="true"] %buttonLabel,%chooseFileButton[data-preview~="disabled"] %buttonLabel':"color:[txt_d];",'%chooseFileButton[data-error="true"],%chooseFileButton[data-preview~="error"]':"background-color:[bg_e];border:solid [brd_e] [brw_e];",'%chooseFileButton[data-error="true"] %plusIcon,%chooseFileButton[data-preview~="error"] %plusIcon':"fill:[txt_e];",'%chooseFileButton[data-error="true"] %buttonLabel,%chooseFileButton[data-preview~="error"] %buttonLabel':"color:[txt_e];","%files":"width:100%;margin-top:14px;min-width:90px;","%_ltr %buttonLabel":"padding-left:8px;","%_rtl":"direction:rtl;","%_rtl %buttonLabel":"padding-right:8px;direction:ltr;","%_no-label %buttonLabel":"padding-right:0;padding-left:0;"}},e["wysiwyg.viewer.skins.UploadNameDefaultSkin"]={react:[["svg","x-icon",[],{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 15 15",width:"15",height:"15"},["path",null,[],{d:"M7.5 14C11 14 14 11 14 7.5S11 1 7.5 1 1 4 1 7.5 4 14 7.5 14zm0 1C3.5 15 0 11.6 0 7.5 0 3.5 3.4 0 7.5 0c4 0 7.5 3.4 7.5 7.5 0 4-3.4 7.5-7.5 7.5z"}],["path",null,[],{d:"M8.2 7.5L11 4.7l-.7-.7-2.8 2.8L4.7 4l-.7.7 2.8 2.8L4 10.3l.7.7 2.8-2.8 2.8 2.8.7-.7"}]],["div","file-name",[],{}]],params:{x_file_txt_h:"COLOR",file_bg_h:"BG_COLOR",x_file_txt_e:"COLOR",x_file_txt:"COLOR",x_file_txt_f:"BG_COLOR",x_file_txt_d:"COLOR",file_fnt:"FONT"},paramsDefaults:{x_file_txt_h:"color_6",file_bg_h:"color_16",x_file_txt_e:"color_6",x_file_txt:"color_6",x_file_txt_f:"color_6",x_file_txt_d:"color_6",file_fnt:"font_9"},css:{"%":"display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;min-height:17px;",'%:hover %x-icon,%[data-preview~="hover"] %x-icon':"fill:[x_file_txt_h];",'%:hover %file-name,%[data-preview~="hover"] %file-name':"background-color:[file_bg_h];color:[x_file_txt_h];",'%[data-error="true"] %x-icon,%[data-preview~="error"] %x-icon':"fill:[x_file_txt_e];",'%[data-error="true"] %file-name,%[data-preview~="error"] %file-name':"color:[x_file_txt_e];","%x-icon":"display:inline-block;cursor:pointer;height:17px;width:17px;min-width:16px;fill:[x_file_txt];",'%x-icon:focus,%x-icon[data-preview~="focus"]':"fill:[x_file_txt_f];",'%x-icon[data-disabled="true"],%x-icon[data-preview~="disabled"]':"fill:[x_file_txt_d];","%file-name":"display:inline-block;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;color:[x_file_txt];direction:ltr;padding-right:3px;[file_fnt]","%file-name:hover":"overflow:visible;",'%file-name[data-disabled="true"],%file-name[data-preview~="disabled"]':"color:[x_file_txt_d];","%_file-name-placeholder":"opacity:0.7;","%_hide-placeholder":"visibility:hidden;","%_align-right":"direction:rtl;","%_align-right %x-icon":"margin-left:8px;","%_align-left %x-icon":"margin-right:8px;","%_align-center":"-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;","%_align-center %x-icon":"margin-right:8px;"}},e}),define("fileUploader",["fileUploader/components/fileUploader","fileUploader/components/uploadName","core","skins","fileUploader/skins/skins.json"],function(e,t,i,o,n){"use strict";var s={fileUploader:e,uploadName:t};return i.compRegistrar.register("wysiwyg.viewer.components.inputs.FileUploader",s.fileUploader,!0).register("wysiwyg.viewer.components.inputs.uploadName",s.uploadName,!0),o.skinsMap.addBatch(n),s});
//# sourceMappingURL=fileUploader.min.js.map