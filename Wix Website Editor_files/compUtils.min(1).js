define("compUtils/core/compFactory",["react","create-react-class","lodash","utils"],function(e,t,r,i){"use strict";function o(o){var d=a[o];if(!d){var h=r.get(s,[o,"def"]);if(!h)return void i.log.error("Component not implemented:",o);var m=t({displayName:"componentClass",mixins:n[o].concat([h])});if(u[o]=m,d=e.createFactory(m),c[o]=d,r.get(s,[o,"isAPIComp"])){var l=p(o,m);a[o]=e.createFactory(l)}else a[o]=d}}var s={},n={},p=void 0,a={},c={},u={};return i.sessionFreezer.freeze(s),i.sessionFreezer.freeze(n),{getCompClass:function(e,t){return o(e),t?c[e]:a[e]},getCompReactClass:function(e){return this.getCompClass(e),u[e]},invalidate:function(e){delete a[e]},extend:function(e,t){s.hasOwnProperty(e)?n[e]=r.union(n[e].concat(t)):i.log.error("Component can't be extended:",e)},register:function(e,t,r){return s[e]={def:t,isAPIComp:r},n[e]=[],this},registerMobxObserver:function(e){return p=e,this},keys:function(){return r.keys(s)}}}),define("compUtils/core/MagicStructure",["lodash","mobx","utils"],function(e,t,r){"use strict";function i(t,r){e.forOwn(r,function(e,r){Object.defineProperty(t,r,{value:e,enumerable:!1})})}function o(e,t,r,o,s,n,p){i(this,{cachedComputedStructureValues:{},siteData:e,displayedDAL:t,pointers:r,compId:o,computedPagePointer:s,computedChildrenToRender:n,computedParentDimensions:p})}function s(e){if(this.cachedComputedStructureValues[e])return this.cachedComputedStructureValues[e].get();var r=t.computed(function(){var t=this.pointers.components.getComponent(this.compId,this.computedPagePointer.get());if(!t||!this.displayedDAL.isExist(t))return null;var r=this.pointers.getInnerPointer(t,[e]);return this.displayedDAL.getStructureProperty(r)},{context:this,compareStructural:!0,name:this.compId+"_MagicStructure_"+e});return this.cachedComputedStructureValues[e]=r,r.get()}var n=e(r.constants.COMP_DATA_QUERY_KEYS).values().concat(["id","componentType","type","modes","layout","skin","styleId","originalStyleId","originCompId"]).value();return o.prototype=e.transform(n,function(e,t){Object.defineProperty(e,t,{get:function(){return s.call(this,t)}})},{}),Object.defineProperty(o.prototype,"components",{get:function(){if(this.cachedComputedStructureValues.components)return this.cachedComputedStructureValues.components.get();var r=t.computed(function(){return e.map(this.computedChildrenToRender.get(),"id")},{context:this,compareStructural:!0,name:this.compId+"_MagicStructure_components"});return this.cachedComputedStructureValues.components=r,r.get()}}),Object.defineProperty(o.prototype,"dimensions",{get:function(){if(this.cachedComputedStructureValues.dimensions)return this.cachedComputedStructureValues.dimensions.get();var e=t.computed(function(){return r.positionAndSize.isVerbsLayout(this.layout)?r.positionAndSize.getVerbsPositionAndSize(this.layout,this.computedParentDimensions.get(),this.siteData.getScreenSize(),this.siteData.getSiteWidth()):r.positionAndSize.getAbsolutePositionAndSize(this.layout)},{context:this,compareStructural:!0,name:this.compId+"_MagicStructure_dimensions"});return this.cachedComputedStructureValues.dimensions=e,e.get()}}),o}),define("compUtils/core/mobxObserverWrapper",["lodash","zepto","react","create-react-class","reactDOM","mobx","mobx-react","utils","coreUtils","compUtils/core/compFactory","compUtils/core/MagicStructure","santaProps"],function(e,t,r,i,o,s,n,p,a,c,u,d){"use strict";function h(e,t){var r=e.getRootIdsWhichShouldBeRendered();return a.componentUtils.shouldBeRendered(r,t)}function m(e){return"SITE_PAGES"===e}function l(e){return{siteData:e.getSiteData(),siteAPI:e}}function g(t,r,i,o){var s=e.isUndefined(r)?"masterPage":r;return{structure:i,rootNavigationInfo:t.getSiteData().getExistingRootNavigationInfo(s),rootId:s,id:o}}function P(e,t,r,i){var o=l(e),s=g(e,t,r,i);return w.getInstance(o,s).getComputedProps(s).get()}function f(t,r,i,o){var s=P(t.mobxObserverWrapperProps.siteAPI,t.rootId,o,t.id);return m(t.id)&&e.assign(s,t.mobxObserverWrapperProps.propsForSitePages),s.isAffectedByModeChanges=r,i&&(s.className=(s.className||"")+" transitioning-comp"),s}function v(e,t){return"SantaTypeObserver("+(e.displayName||e.name||t.split(".").pop())+")"}function y(e){return e&&c.getCompClass(e)||r.DOM.div}function C(e,t,r,i,o){var s=r&&!!o,n=f(i,r,i.compAnimationType===k.TRANSITION||s,e);return n.childrenSet=t,n}function b(t,r,i,o){return e.some([o].concat(i.components.getChildrenRecursively(o)),function(o){var s=r.get(i.getInnerPointer(o,["componentType"]));return e.includes(t.COMPONENTS_TO_KEEP_IN_STUB,s)})}function S(t){return!e.isEmpty(t)}function A(t,r,i){var o=e.map(i,function(e){return!!t||O(e,r)});return e.zipObject(e.map(i,"id"),o)}function I(t,r,i){var o=e.keyBy(t.childrenSet,"id"),s=e.keyBy(r.childrenSet,"id"),n=e.reduce(s,function(t,r,i){return!!o[i]?t:e.set(t,i,k.ENTER)},{});return e.reduce(o,function(t,r,o){return!!s[o]?i[o]?e.set(t,o,k.TRANSITION):t:e.set(t,o,k.LEAVE)},n)}function O(t,r){var i=[],o=e.get(t,"modes.definitions");if(o&&o.length){var s=e.map(o,"modeId"),n=e.keys(r);i=e.intersection(n,s)}return!e.isEmpty(i)}function x(t,r,i){var o=t.getSiteData(),s=o.measureMap;if(!s)return{};var n=t.getSiteAspect("windowScrollEvent").getScrollPosition(),p=e.partial(e.isEqual,k.TRANSITION);return e(r).pickBy(p).mapValues(function(t,r){var p=s.shownInFixed[r]?s.absoluteLeft[r]-n.x:s.absoluteLeft[r]-o.getSiteX()-n.x;return{width:s.width[r],height:s.height[r],left:p,top:s.absoluteTop[r]-n.y,rotation:e.get(i,["rotationDegrees",r])}}).value()}function R(e,t,r,i,o,s){t.getSiteAspect("actionsAspect").executeAction("modeChange",V.MODE_CHANGED_INIT,{modeChanges:r,componentAnimations:i,transitioningComponentsPrevLayout:o,pageId:e,onComplete:s})}function T(t,r,i,o){var s=e.filter(i,function(e){return!!o[e.id]});return e.unionBy(t.childrenSet,s,r.childrenSet,"id")}function D(e){e.getSiteAspect("actionsAspect").executeAction("modeChange",V.MODE_CHANGED_EXECUTE)}function M(t,r,i){return e.map(t,function(e){return{id:r.get(i.getInnerPointer(e,["id"])),componentType:r.get(i.getInnerPointer(e,["componentType"]))}})}function E(e,t,r){var i=e&&t.components.getChildrenContainer(e);return i&&r.get(i)}function W(){var t=this.props.mobxObserverWrapperProps.viewerPrivateServices.displayedDAL,r=this.props.mobxObserverWrapperProps.viewerPrivateServices.pointers,i=this.props.mobxObserverWrapperProps.siteAPI.getSiteData();this.pagePointer=this.props.pagePointer||s.computed(function(){var e=i.getViewMode();return r.components.getPage(this.props.rootId,e)||r.components.getMasterPage(e)},{context:this,compareStructural:!0,name:"pagePointer_"+this.props.id}),this.childrenPointers=s.computed(function(){var e=r.components.getComponent(this.props.id,this.pagePointer.get());return E(e,r,t),e?r.components.getChildren(e):[]},{context:this,compareStructural:!0,name:"childrenPointers_"+this.props.id}),this.isPageStub=this.props.isPageStub||s.computed(function(){return!h(this.props.mobxObserverWrapperProps.siteAPI,this.props.rootId)},{context:this,name:"isPageStub_"+this.props.id}),this.computedChildrenToRender=s.computed(function(){var i=this.childrenPointers.get();return this.isPageStub.get()&&(i=e.filter(this.childrenPointers.get(),b.bind(this,this.props.mobxObserverWrapperProps.siteAPI,t,r))),M(i,t,r)},{context:this,compareStructural:!0,name:"computedChildrenToRender_"+this.props.id}),this.magicStructure=new u(i,t,r,this.props.id,this.pagePointer,this.computedChildrenToRender,this.props.computedParentDimensions),this.computedDimensions=s.computed(function(){return this.magicStructure.dimensions},{name:"computedDimensions_"+this.props.id,context:this}),this.shouldRenderInStub=s.computed(function(){var t=this.isPageStub.get(),r=e.isEmpty(this.computedChildrenToRender.get()),i=this.magicStructure.componentType;return!t||!r||e.includes(this.props.mobxObserverWrapperProps.siteAPI.COMPONENTS_TO_KEEP_IN_STUB,i)},{context:this,name:this.props.id+"_shouldRenderInStub"}),this.compModes=s.computed(function(){var i=e.get(this.magicStructure.modes,"definitions");if(e.isEmpty(i))return{};var o=this.pagePointer.get().id,s=r.activeModes.getPageActiveModes(o),n=t.get(s);return e(n).mapValues(function(t,r){return e.some(i,{modeId:r})}).pickBy().value()},{context:this,compareStructural:!0,name:this.props.id+"_activeModes"}),this.compBehaviors=s.computed(function(){var e=this.props.mobxObserverWrapperProps.siteAPI,t=this.magicStructure.propertyQuery,r=this.magicStructure.behaviorQuery;return z.getCompBehaviors(e,t,r,this.props.rootId,this.props.id)},{context:this,compareStructural:!0})}function N(){var e=this.props.mobxObserverWrapperProps.siteAPI,t=this.props.mobxObserverWrapperProps.siteAPI.getPointers(),r=this.props.mobxObserverWrapperProps.siteAPI.getDisplayedDAL(),i=this.pagePointer.get(),o=t.components.getComponent(this.props.id,i);(this.props.structure||o&&r.isExist(o))&&e.registerCompBehaviours(this.props.rootId,this.props.id,this.compBehaviors.get())}function _(){return s.observe(this.compBehaviors,N.bind(this),{})}function L(e){return e.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()})}function U(t,r,i){return e.includes(t.getRenderRealtimeConfigItem("compsToShowOnTop"),r)?a.style.MAX_Z_INDEX:i?t.getRenderFlag("renderFixedPositionContainers")?50:49:""}function B(r,i,s,n,p){var c=r.getComponentByPageAndCompId(i,s);if(c){var u=e.clone(n),d=a.style.getPrefixedTransform(),h=L(d);u[h]=n[d],d!==h&&(u[d]=""),u.zIndex=U(r,s,p),c.hasOwnProperty("getRootStyle")&&e.assign(u,c.getRootStyle(u)),t(o.findDOMNode(c)).css(u)}}function F(t,r,i){var o=e.omitBy(r,function(r,i){return t[i]===r||e.isEqual(t[i],r)}),s=1===e.size(o)&&!!o.style&&!e.isEqual(t.style,r.style)&&r.style.display===t.style.display;return e.isFunction(i.compSpecificIsDomOnly)?s&&i.compSpecificIsDomOnly(t,r):s}var V=p.triggerTypesConsts,w=d.computedPropsBuilder,z=d.propsBuilderUtil,k={ENTER:p.siteConstants.Animations.Modes.AnimationType.ENTER,LEAVE:p.siteConstants.Animations.Modes.AnimationType.LEAVE,TRANSITION:p.siteConstants.Animations.Modes.AnimationType.TRANSITION};return function(t,o){return n.observer(i({displayName:v(o,t),mixins:[a.renderDoneMixin],propTypes:{id:r.PropTypes.string.isRequired,structure:r.PropTypes.object,rootId:r.PropTypes.string,mobxObserverWrapperProps:r.PropTypes.object,applyStyleOverrides:r.PropTypes.bool},componentWillMount:function(){this.transitioningChildrenPrevLayout={},this.currentlyAnimatingChildren={},this.childrenAnimations={},this.renderedCompProps={},this.childrenToRender={},this.lastRenderedComp=null,this.isDomOnly=!1,W.call(this),this.prevActiveModes=null,this.disposeReactions=_.call(this),this.props.mobxObserverWrapperProps.siteAPI.setComponentRenderStart(this.props.id||this.props.structure.id);var e=this.props.mobxObserverWrapperProps.siteAPI,t=this.props.structure||this.magicStructure,r=l(e),i=g(e,this.props.rootId,t,this.props.id);this.computedPropsManager=w.getInstance(r,i,!!o.shouldLayout)},componentWillUpdate:function(){this.setComponentRenderStartIfNeeded()},componentWillReact:function(){this.props.mobxObserverWrapperProps.siteAPI.getSiteData().reacted=!0,this.setComponentRenderStartIfNeeded()},componentWillUnmount:function(){var t=this.props.mobxObserverWrapperProps.siteAPI;t.cancelReLayoutPending(this.props.id||this.props.structure.id),t.unregisterCompBehaviours(this.props.rootId,this.props.id||this.props.structure.id),e.invoke(this,"disposeReactions")},componentDidMount:function(){N.call(this),this.prevActiveModes=this.compModes.get(),a.displayedOnlyStructureUtil.isDisplayedComponent(this.props.id)&&this.props.mobxObserverWrapperProps.siteAPI.requestEnforceAnchors(),this.props.mobxObserverWrapperProps.siteAPI.setComponentRenderEnd(this.props.id||this.props.structure.id)},getModesChanges:function(){return this.prevActiveModes?p.modes.getModeChanges(this.prevActiveModes,this.compModes.get()):{}},componentDidUpdate:function(){var t=this.props.mobxObserverWrapperProps.siteAPI,r=t.getSiteAspect("WidgetAspect").isContextReady(this.props.rootId);if(this.isDomOnly&&t.isDuringPostUpdatesOperations(this.props.id)||!r)return t.removePostUpdateOperationsRender(this.props.id),void t.cancelReLayoutPending(this.props.id);if(S(this.childrenAnimations)&&(R(this.props.rootId,t,this.getModesChanges(),this.childrenAnimations,this.transitioningChildrenPrevLayout,this.handleModeChangeAnimationsFinished),D(t),this.childrenAnimations={},this.transitioningChildrenPrevLayout={}),this.isDomOnly){this.isDomOnly=!1;var i=this.renderedCompProps.style,o=e.get(this.magicStructure,"layout.fixedPosition",!1);B(t,this.props.rootId,this.props.id,i,o)}var s=this.props.mobxObserverWrapperProps.siteAPI.getPointers(),n=this.props.mobxObserverWrapperProps.siteAPI.getDisplayedDAL(),p=this.pagePointer.get(),c=this.computedChildrenToRender.get();this.childrenData={rotationDegrees:e.reduce(c,function(t,r){var i=r.id,o=s.components.getComponent(i,p);return e.set(t,i,n.get(s.getInnerPointer(o,"layout.rotationInDegrees")))},{})},this.prevActiveModes=this.compModes.get(),a.displayedOnlyStructureUtil.isDisplayedComponent(this.props.id)&&t.requestEnforceAnchors(),this.computedPropsManager.clearChangedPropsMap();var u=this.props.id||this.props.structure.id;this.shouldLayout&&t.setComponentRenderEnd(u)},getRenderedCompProps:function(t,r){var i=t.mobxObserverWrapperProps.siteAPI,o=this.currentlyAnimatingChildren,s=this.getModesChanges(),n=!e.isEmpty(s),p=C(t.structure||this.magicStructure,this.props.structure?[]:this.computedChildrenToRender.get(),n,t,r);if(n){var a=A(p.isAffectedByModeChanges,s,this.computedChildrenToRender.get());this.childrenAnimations=I(r,p,a),this.transitioningChildrenPrevLayout=x(i,this.childrenAnimations,this.childrenData),e.assign(o,this.childrenAnimations)}return S(o)?this.childrenToRender=T(r,p,this.childrenToRender,o):this.childrenToRender=p.childrenSet,e.assign(p,{pageStub:this.isPageStub.get(),ref:this.compRefFunction},this.props)},compRefFunction:function(e){this.props.mobxObserverWrapperProps.addComponentRef&&this.props.mobxObserverWrapperProps.addComponentRef(e,this.props.id)},getChildProps:function(t){return{id:t,rootId:this.props.rootId,anyChangeInParentActiveModes:!(!this.props.anyChangeInParentActiveModes&&e.isEmpty(this.getModesChanges())),computedParentDimensions:this.computedDimensions,mobxObserverWrapperProps:this.props.mobxObserverWrapperProps,pagePointer:this.pagePointer,isPageStub:this.isPageStub,key:t,refInParent:t}},setComponentRenderStartIfNeeded:function(){var t=this;this.shouldLayout=function(){var r=t.computedPropsManager.getChangedProps(),i=o.shouldLayout;if(i){if(e.isFunction(i))return i(r);if(e.isObject(i))return e.some(r,function(t,r){return e.isUndefined(i[r])||i[r]})}return!0}(),this.shouldLayout&&this.props.mobxObserverWrapperProps.siteAPI.setComponentRenderStart(this.props.id||this.props.structure.id)},render:function(){var t=this.props.mobxObserverWrapperProps.siteAPI.getSiteAspect("WidgetAspect").isContextReady(this.props.rootId);if(!this.props.structure&&!this.magicStructure.id||!this.shouldRenderInStub.get()||!t&&!this.isPageStub.get())return this.lastRenderedComp;var i=e.clone(this.renderedCompProps);if(this.renderedCompProps=this.getRenderedCompProps(this.props,i),this.isDomOnly=F(i,this.renderedCompProps,o),this.isDomOnly)return this.lastRenderedComp;var s=e.map(this.childrenToRender,function(e){return y(e.componentType)(this.getChildProps(e.id))}.bind(this)),n=e.omit(this.renderedCompProps,["mobxObserverWrapperProps","childrenSet","isPageStub","pagePointer"]);return this.lastRenderedComp=r.createElement(o,n,s),this.lastRenderedComp},handleModeChangeAnimationsFinished:function(t){this.currentlyAnimatingChildren=e.omit(this.currentlyAnimatingChildren,e.keys(t)),S(this.currentlyAnimatingChildren)||this.forceUpdate()}}))}}),define("compUtils",["compUtils/core/compFactory","compUtils/core/mobxObserverWrapper"],function(e,t){"use strict";return{compFactory:e,mobxObserverWrapper:t}});
//# sourceMappingURL=compUtils.min.js.map