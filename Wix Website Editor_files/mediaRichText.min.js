define("mediaRichText/bi/errors.json",[],function(){return{MEDIA_RICH_TEXT_WRONG_COMP_DATA:{errorCode:32e3,severity:"fatal",params:{p1:"wixCompJson",p2:"errorDesc",p3:"errorStack"}},MEDIA_RICH_TEXT_UNSUPPORTED_COMPONENT:{errorCode:32001,severity:"fatal",params:{p1:"wixCompJson"}},MEDIA_RICH_MISSING_COMPONENT_PLACEHOLDER:{errorCode:32002,severity:"fatal",params:{p1:"dataQuery"}}}}),define("mediaRichText/bi/errors",["mediaRichText/bi/errors.json","lodash","utils"],function(e,t,i){"use strict";return t.forEach(e,function(e,t){e.errorName=t}),i.logger.register("mediaRichText","error",e),e}),define("mediaRichText/galleryHelpers/galleryHelpers",["lodash","utils"],function(e,t){"use strict";function i(e){return e===s}function n(e){return e===l}function r(e,t){var r=0;if(i(t.componentType)){var o=t.cols,a=t.rows,s=2*t.margin,p=Math.round((e-(o-1)*s)/o),l=d*p;r=Math.round(l*a)+(a-1)*s+26}else n(t.componentType)&&(r=Math.round(d*e));return r}function o(e,t){var i=e.width;return{width:i,height:r(i,t),position:"relative"}}function a(e){var r={};return i(e.componentType)?r={skin:p,compProp:{type:"MatrixGalleryProperties",metaData:{schemaVersion:"1.0"},expandEnabled:!0,imageMode:e.fixedSize?"clipImage":"flexibleWidthFixed",numCols:e.cols,maxRows:e.rows,incRows:2,margin:2*e.margin,alignText:"left"}}:n(e.componentType)?r={skin:c,compProp:{autoplay:e.autoplay,autoplayInterval:e.autoplayInterval,bidirectional:!1,expandEnabled:!0,imageMode:"flexibleWidthFixed",metaData:{schemaVersion:"1.0"},reverse:!1,showAutoplay:!0,showCounter:!0,showExpand:!1,showNavigation:!0,showSocial:!1,transDuration:1,transition:"swipeHorizontal",type:"SlideShowGalleryProperties"}}:t.log.error("Unknown gallery type: "+e.componentType),r}var s="wysiwyg.viewer.components.MatrixGallery",p="wysiwyg.viewer.skins.gallerymatrix.BlogMatrixGallery",l="wysiwyg.viewer.components.SlideShowGallery",c="skins.viewer.gallery.BlogSlideShow",m=[s,l],d=.75;return{buildGalleryJsonFromCkData:function(r,s,l){var m=r.componentType,d=e.assign({dataQuery:r.dataQuery,propertyQuery:r.dataQuery,componentType:r.componentType,type:"Component",style:o(l,r),compData:{type:"ImageList",items:e.map(r.imageList,function(t){var i=e.get(s,t.dataQuery);return e.assign({},t,i,{type:"Image",id:t.id+t.uri,isRef:!1,metaData:{isHidden:!1,isPreset:!0,schemaVersion:"1.0"}})}),metaData:{isPreset:!0,schemaVersion:"1.0",isHidden:!1}}},a(r));return n(m)&&(d.styleId=t.santaTypes.shortenStyleId(c)),i(m)&&(d.styleId=t.santaTypes.shortenStyleId(p)),d},isGalleryComponent:function(t){return e.includes(m,t)}}}),define("mediaRichText/wixMusicEmbedMixin/wixMusicEmbedMixin",["lodash"],function(e){"use strict";return{getInitialState:function(){return{height:this.props.height}},onPlayerMessage:function(e){"resizeOfWixMusicIframe"===e.data.event&&e.data.playerId===this.props.playerId&&this.setState({height:e.data.size.maxHeight})},componentDidMount:function(){window.addEventListener("message",this.onPlayerMessage)},componentWillUnmount:function(){window.removeEventListener("message",this.onPlayerMessage)},getIframeProps:function(){return e.assign({},this.props,{height:this.state.height})}}}),define("mediaRichText/mediaRichTextStylesCollector/mediaRichTextStylesCollector",["lodash","skins","core","utils"],function(e,t,i,n){"use strict";var r=t.skinsMap;i.styleCollector.registerClassBasedStyleCollector("wysiwyg.viewer.components.MediaRichText",function(e,t,i,o){for(var a=/(<img[^>]*wix-comp="([^"]+)"[^>]*>)/g,s=void 0;s=a.exec(e.dataItem.text);){var p=JSON.parse(s[2].replace(/&quot;/g,'"')),l="";p.skin&&r.get(p.skin)&&(l=p.skin),l&&!o[l]&&(o[n.santaTypes.shortenStyleId(l)]=e.structure.skin)}})}),define("mediaRichText",["lodash","core","utils","coreUtils","compUtils","react","santaProps","textCommon","mediaRichText/bi/errors","mediaRichText/galleryHelpers/galleryHelpers","mediaRichText/wixMusicEmbedMixin/wixMusicEmbedMixin","mediaRichText/mediaRichTextStylesCollector/mediaRichTextStylesCollector"],function(e,t,i,n,r,o,a,s,p,l,c){"use strict";function m(e){return P[e]||e}function d(){var e=this.props.siteData.measureMap;return e&&(this._lastMeasuredWidth=e.width[this.props.id]),this._lastMeasuredWidth}function u(e,t){var i=JSON.parse(e.replace(/&quot;/g,'"'));return i.url=t,i}function h(e,t){try{return u(e,t)}catch(t){return void this.props.siteAPI.reportBI(p.MEDIA_RICH_TEXT_WRONG_COMP_DATA,{wixCompJson:e,errorDesc:t.message,errorStack:t.stack})}}function y(e){return"innerComp_"+e.replace("#","")}function g(e,t){var i=e.style;i.marginTop="10px",i.marginBottom="10px",i.marginLeft=t.marginLeft,i.marginRight=t.marginRight,i.position="static"}function f(e,t){var i=t.style;e.floatValue?(i.float=e.floatValue,i.display="",i.clear=""):(i.display=e.display,i.clear="both",i.float="")}function w(t,i){return e.has(t,"post-cover-photo")&&(i.addItemProp=!0),i}function C(t){var i=e.cloneDeep(t.compData);t.compData.items=e.map(t.compData.items,function(t){return e.assign({galleryData:i},t)})}function T(e){return e.childNodes&&1===e.childNodes.length&&e.childNodes[0].nodeType===E.Node.TEXT_NODE}function v(t){return e.assign(t,{wixComp:!0})}function x(t){return e.isFunction(t.type)&&t.props.wixComp}function I(e){return e.replace(/^#/,"")}function D(t,i){return t&&!e.has(P,i.tagName.toLowerCase())}function _(t,i){var n=e.get(t,"structure.layout",{});return n.width&&(n.width=Math.min(i,n.width)),e.assign({},t.structure,{dataItem:t.compData,propertiesItem:t.compProp,layout:n,id:t.structure.id,type:t.structure.componentType,structure:t.structure})}function M(e){var t=this.props.siteData,i=this.props.id,n=_(e,this._getMediaRichTextComponentWidth()),r=n.id;t.registerMediaRichTextInnerComponent(i,r,n)}function R(t){var i=t.id||y(t.dataQuery);return e.assign(t,{id:i})}var b=o.createClass({displayName:"wixMusicEmbed",mixins:[c],render:function(){return o.createElement("iframe",v(this.getIframeProps()))}}),E=n.fragment,N=s.textComponentsUtils,P={wline:"div"},L={displayName:"MediaRichText",mixins:[s.textCompMixin],allowIframes:!0,convertCompDataTextToHTML:function(t){this.componentDataQueryList=e.map(t.compData.componentDataList||[],I),this._compData=t.compData,this._componentHtml=this._componentHtml.replace(/\n|\r|\t/g,""),this._componentHtml=N.convertDataQueryLinksIntoHtmlAnchors(this._componentHtml,t.compData.linkList,e.partialRight(i.linkRenderer.renderLink,t.siteData,t.rootNavigationInfo)),this._componentHtml=N.mobileTextTransformIfNeeded(this._componentHtml,{brightness:e.get(t,"compProp.brightness"),isMobileView:t.siteData.isMobileView(),scale:e.get(t,"structure.layout.scale"),fontGetter:t.siteData.getFont.bind(t.siteData),colorGetter:t.siteData.getColor.bind(t.siteData)}),this.renderedDataQueries={},this._componentHtml=this._convertComponentsPlaceHoldersToRenderedComponents(this._componentHtml),e.size(this.renderedDataQueries)!==e.size(this.componentDataQueryList)&&e(this.componentDataQueryList).without(e.keys(this.renderedDataQueries)).forEach(function(e){this.props.siteAPI.reportBI(p.MEDIA_RICH_MISSING_COMPONENT_PLACEHOLDER,{dataQuery:"#"+e})}.bind(this)),this._registerReLayoutFunc=t.registerReLayout},_addToCompDataListIfMissing:function(t){var i=I(t);e.includes(this.componentDataQueryList,i)||this.componentDataQueryList.push(i)},_convertNodeFragmentToReactElements:function(t){if(t.nodeType===E.Node.ELEMENT_NODE){var i=e.reduce(t.attributes,function(t,i){return"style"===i.name?t.style=e.reduce(i.value.split(";"),function(t,i){var n=i.split(":");return 2===n.length&&(t[e.camelCase(n[0])]=n[1]),t},{}):"class"===i.name?t.className=i.value:"frameborder"===i.name?t.frameBorder=i.value:e.startsWith(i.name,"data-")?t[i.name]=i.value:t[e.camelCase(i.name)]=i.value,t},{});if(D(i.wixComp,t)){var n=h.call(this,i.wixComp,i.src);return n?this._handleInnerComps(n,i):""}var r=T(t)?t.textContent:e.flatMap(t.childNodes,this._convertNodeFragmentToReactElements);if(e.isArray(r)&&r.length&&e.every(r,x))return r;var a=e.includes(this.voidElements,t.tagName.toLowerCase())?i:e.assign(i,{children:r});return o.createElement(m(t.tagName.toLowerCase()),a)}return t.nodeType===E.Node.TEXT_NODE?t.textContent:""},voidElements:["area","base","basefont","bgsound","br","col","command","embed","frame","hr","image","img","input","isindex","keygen","link","menuitem","meta","nextid","param","source","track","wbr"],_convertComponentsPlaceHoldersToRenderedComponents:function(t){var i=E.document.createElement("div");return i.innerHTML=t,e.map(i.childNodes,this._convertNodeFragmentToReactElements)},_validateAndFixGalleryCompData:function(t,i){var n=e.clone(t),r=l.buildGalleryJsonFromCkData(i,this._compData.innerCompsData,t.style);return e.assign(n,r),C(n),n},_createInnerComponentProperties:function(e){var t=this._createInnerComponentBasicProperties(e);return"wysiwyg.viewer.components.WPhoto"===e.componentType||"wysiwyg.viewer.components.Video"===e.componentType?w(e,t):l.isGalleryComponent(e.componentType)?this._validateAndFixGalleryCompData(t,e):(this.props.siteAPI.reportBI(p.MEDIA_RICH_TEXT_UNSUPPORTED_COMPONENT,{wixCompJson:e}),t)},_getMediaRichTextComponentWidth:function(){return d.call(this)||e.get(this.props,"style.width")||630},_createInnerComponentBasicProperties:function(t){var i=R(t),n=e.get(this._compData.innerCompsData,i.dataQuery),r=void 0;if("wysiwyg.viewer.components.WPhoto"===i.componentType){if(i.linkDataQuery){var o=i.linkDataQuery.slice(1);n.link=e.find(this._compData.linkList,{id:o})}r={displayMode:"fitWidthStrict"}}else"wysiwyg.viewer.components.Video"===i.componentType&&(r={showControls:"temp_show",enablejsapi:1});var s=a.componentPropsBuilder.getCompProps(i,this.props.siteAPI,this.props.rootId,null,{compData:n,compProp:r});return s.key=s.key||t.key,delete s.ref,s.registerReLayout=this._registerReLayoutFunc||this.registerReLayout,g(s,i),f(i,s),this._calcInnerCompWidthAndHeight(i,s),s},_calcInnerCompWidthAndHeight:function(t,i){var n=this._getMediaRichTextComponentWidth(),r=n,o=i.compData&&i.compData.width,a=t.width;e.isNumber(a)?r=this._getWidthMultiplier(t)*n:e.isNumber(o)&&(r=Math.min(o,n)),i.style.width=r,t.dimsRatio?i.style.height=i.style.width*t.dimsRatio:"wysiwyg.viewer.components.Video"===t.componentType&&(i.style.height=.5625*i.style.width)},_getWidthMultiplier:function(e){return this.props.siteData.isMobileView()?.99:e.width},_handleInnerComps:function(e,t){return"htmlComp"===e.componentType?this._handleHtmlComp(e,t):"music"===e.componentType?this._handleMusicComp(e,t):this._handleInnerSantaComponent(e)},_handleInnerSantaComponent:function(e){var t=this._createInnerComponentProperties(e),i=r.compFactory.getCompClass(e.componentType,!0);return this.renderedDataQueries[I(e.dataQuery)]=1,this._addToCompDataListIfMissing(e.dataQuery),M.call(this,t),i(v(t))},_handleHtmlComp:function(e,t){var i=this.props.siteData.serviceTopology.staticHTMLComponentUrl,n=void 0;if(n="website"===e.type?"//"+function(e){return e.replace(/^(https?:)?\/\//,"")}(e.websiteUrl):("temp"===e.urlStatus?"//0.htmlcomponentservice.com/":i)+e.relativeUrl,"center"===e.align?t.style={display:"block",clear:"both",margin:"0 auto"}:t.style={float:e.align},t.src=n,t.sandbox="allow-scripts allow-same-origin allow-popups",this.props.siteData.isMobileView()&&e.dimsRatio){if(t.width="99%",e.dimsRatio>1){var r=.99*(this._getMediaRichTextComponentWidth()?parseInt(this._getMediaRichTextComponentWidth(),10):1)*e.dimsRatio;t.height=r}}else t.width=e.width;return o.createElement("iframe",v(t))},_handleMusicComp:function(t,i){var n=e.get(this.props.siteData,["serviceTopology","scriptsLocationMap","wix-music-embed"]),r=/^[\w\-]+$/i,a=r.test(t.paymentId)||""===t.paymentId;if(r.test(t.albumId)&&r.test(t.presetId)&&a)return i.src=n+"/index.html?albumId="+t.albumId+"&paymentsId="+t.paymentId+"&presetId="+t.presetId+"&playerId="+t.playerId+"&hideDetailedTrackInfo=true",this.props.siteData.isMobileView()&&(i.src+="&isMobile=true"),i.sandbox="allow-scripts allow-same-origin allow-popups",i.playerId=t.playerId,delete i.wixComp,i.width="100%",o.createElement(b,i)},componentWillUnmount:function(){this.props.siteData.clearMediaRichTextInnerComponents(this.props.id)}};return t.compRegistrar.register("wysiwyg.viewer.components.MediaRichText",L,!0),L});
//# sourceMappingURL=mediaRichText.min.js.map