function _toConsumableArray(e){if(Array.isArray(e)){for(var i=0,t=Array(e.length);i<e.length;i++)t[i]=e[i];return t}return Array.from(e)}define("loggingUtils/bi/errors.json",[],function(){return{SINGLE_PAGE_RETRIEVAL_ATTEMPT_FAILED:{errorCode:111020,severity:"warning",params:{p2:"pageId",p1:"hostname",p3:"url",p4:"responseStatusCode"}},ALL_PAGE_RETRIEVAL_ATTEMPTS_FAILED:{errorCode:111021,severity:"fatal",params:{p1:"pageId"}},UNHANDLED_LINK_TYPE_IN_DATA_FIXER:{errorCode:21067,severity:"fatal",params:{p1:"newLinkDataItem"}},DATA_PLUGIN_ERROR:{errorCode:111029,severity:"fatal",params:{p1:"store",p2:"path",p3:"value",p4:"stack"}}}}),define("loggingUtils/bi/services/wixBI",["lodash","coreUtils","experiment"],function(e,i,t){"use strict";function n(e,t,n,o,s){var g=i.urlUtils.joinURL(t,n);o&&(g+="?"+o),e.wixBiSession.sendBeacon(g,s),u&&a&&r(g)}function r(e){if(s){var t=window._biCalls;if(t){var n=t.push(i.urlUtils.parseUrl(e));n>g&&t.splice(0,n>>2)}}}function o(i,t){var n=a&&"editor"===t.adapter?window.parent.mainLoaded:0;return n=n||i.wixBiSession.initialTimestamp||i.wixBiSession.mainLoaded,e.now()-n}var s="undefined"!=typeof window,a=s&&window.queryUtil&&window.queryUtil.isParameterTrue("isEdited"),u=s&&window.queryUtil&&window.queryUtil.isParameterTrue("isqa"),g=1e3;u&&a&&(window._biCalls=[]);var c={biUrl:"//frog.wixpress.com",adapter:"",params:{}};return{report:function(r,s){var a=e.get(r,["serviceTopology","biServerUrl"]);a&&(c.biUrl=a),e.defaults(s,c);var u="useBeacon"in s?s.useBeacon:t.isOpen("useBeacon",r),g=e.isString(s.queryString)?s.queryString:i.urlUtils.toQueryString(e.defaults(s.params,{ts:o(r,s)}));n(r,s.biUrl,s.adapter,g,u)}}}),define("loggingUtils/bi/services/googleAnalytics",["lodash","coreUtils"],function(e,i){"use strict";function t(i,t,n){function r(){var r=window._gaq||[];window._gaq=r,e.forEach(t,function(e,t){var o=0===t?"":"t"+t+".";r.push([o+"_setAccount",e],[o+"_setAllowAnchor",!0]),n&&r.push([o+"_setCustomVar",1,"version",n.ver,1],[o+"_setCustomVar",2,"language",n.lng,1],[o+"_setCustomVar",3,"userType",n.userType,1]),r.push([o+"_trackPageview",i])})}window._gaq?r():requirejs(["https://stats.g.doubleclick.net/dc.js"],r,e.noop)}function n(i,t,n){e.isEmpty(i)||(window.ga?n():requirejs(["//www.google-analytics.com/analytics.js"],function(){window.ga=window.ga||function(){(window.ga.q=window.ga.q||[]).push(arguments)},window.ga.l=e.now(),window.ga.q=window.ga.q||[],e.forEach(i,function(e){window.ga("create",e,"auto")}),t&&window.ga("set","anonymizeIp",!0),n()}))}return{reportPageEvent:function(e,r,o,s){"undefined"!=typeof window&&setTimeout(function(){e.isUsingUrlFormat(i.siteConstants.URL_FORMATS.SLASH)?n(o,e.ipAnonymization,function(){window.ga("send","pageview",{page:r})}):t(r,o,s)},200)},report:function(i,t){var r=e.drop(arguments,2);n(i,t,function(){window.ga.apply(window.ga,r)})}}}),define("loggingUtils/bi/services/facebookRemarketing",["lodash","coreUtils"],function(e,i){"use strict";function t(e){if(!window._fbq){var i=window._fbq||(window._fbq=[]);if(!i.loaded){var t=window.document.createElement("script");t.async=!0,t.src="//connect.facebook.net/en_US/fbds.js";var n=window.document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n),i.loaded=!0}i.push(["addPixelId",e]),window._fbq.push(["track","PixelInitialized",{}])}}function n(e){var i=void 0,t=void 0,n=void 0;window.fbq||(i=window.fbq=function(){i.callMethod?i.callMethod.apply(i,arguments):i.queue.push(arguments)},window._fbq||(window._fbq=i),i.push=i,i.loaded=!0,i.version="2.0",i.queue=[],(t=window.document.createElement("script")).async=!0,t.src="//connect.facebook.net/en_US/fbevents.js",(n=window.document.getElementsByTagName("script")[0]).parentNode.insertBefore(t,n)),window.fbq("init",e),window.fbq("track","PageView")}function r(i){return Number(i)&&e.isString(i)&&!e.isEmpty(i)}function o(e){return e.isUsingUrlFormat(i.siteConstants.URL_FORMATS.SLASH)}return{initRemarketingPixel:function(e,i){r(i)&&(o(e)?n(i):t(i))},initPixelId:function(e,i){r(i)&&o(e)&&this.initRemarketingPixel(e,i)},fireRemarketingPixel:function(i,t,n){o(i)&&window.fbq&&e.isString(t)&&window.fbq("track",t,n||{})}}}),define("loggingUtils/bi/services/googleRemarketing",["lodash"],function(e){"use strict";function i(i){return e.isArray(i)&&1===i.length&&Number(i[0])}function t(){var e=window.document.createElement("script");e.type="text/javascript",e.src="//www.googleadservices.com/pagead/conversion_async.js",e.async=!0,e.setAttribute("onload","google_trackConversion("+JSON.stringify(r)+")");var i=window.document.getElementsByTagName("script")[0];i.parentNode.insertBefore(e,i)}var n=!1,r={google_custom_params:{},google_remarketing_only:!0};return{initRemarketingPixel:function(o){!n&&i(o)&&(e.assign(r,{google_conversion_id:o[0]}),t(),n=!0)},fireRemarketingPixel:function(){n&&window.google_trackConversion&&window.google_trackConversion(r)}}}),define("loggingUtils/bi/services/yandexMetrika",["lodash"],function(e){"use strict";function i(i){return e.isArray(i)&&e.isFinite(parseInt(i[0],10))}function t(e){u="yaCounter"+e}function n(e){(window[s]=window[s]||[]).push(function(){try{window[u]=new window.Ya.Metrika(o(e))}catch(e){}})}function r(){if(!a){var e=window.document.getElementsByTagName("script")[0],i=window.document.createElement("script");i.type="text/javascript",i.async=!0,i.src="https://mc.yandex.ru/metrika/watch.js",i.addEventListener("load",function(){a=!0}),e.parentNode.insertBefore(i,e)}}function o(e){return{id:parseInt(e,10),clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!0,trackHash:!0}}var s="yandex_metrika_callbacks",a=!1,u=void 0;return{initialize:function(e){i(e)&&(t(e[0]),n(e[0]),r())},reportPageHit:function(i){a&&window[u]&&e.isFunction(window[u].hit)&&window[u].hit(i)}}}),define("loggingUtils/bi/services/googleTagManagerLoader",[],function(){"use strict";return{load:function(e,i){requirejs(["//www.googletagmanager.com/gtm.js?id="+e],i)}}}),define("loggingUtils/bi/services/googleTagManager",["lodash","loggingUtils/bi/services/googleTagManagerLoader"],function(e,i){"use strict";function t(t,n){window.dataLayer?n():i.load(t,function(){window.dataLayer=window.dataLayer||[],window.dataLayer.push({"gtm.start":e.now(),event:"gtm.js"}),n()})}return{reportPageEvent:function(e,i){"undefined"!=typeof window&&setTimeout(function(){t(i,function(){window.dataLayer.push({event:"Pageview",url:e})})},200)},report:function(e,i){t(e,function(){var e;(e=window.dataLayer).push.apply(e,_toConsumableArray(i))})}}}),define("loggingUtils/bi/bi",["loggingUtils/bi/services/wixBI","loggingUtils/bi/services/googleAnalytics","loggingUtils/bi/services/facebookRemarketing","loggingUtils/bi/services/googleRemarketing","loggingUtils/bi/services/yandexMetrika","loggingUtils/bi/services/googleTagManager"],function(e,i,t,n,r,o){"use strict";return{wixBI:e,googleAnalytics:i,facebookRemarketing:t,googleRemarketing:n,yandexMetrika:r,googleTagManager:o}}),define("loggingUtils/logger/newrelic",["lodash"],function(e){"use strict";if(!("undefined"==typeof window||window.queryUtil&&window.queryUtil.isParameterTrue("suppressbi"))){var i=void 0;try{i=window.parent.newrelic}catch(e){i=window.newrelic}if(i){var t=window.performance&&window.performance.now?function(){return Math.round(window.performance.now())}:function(){return 0};return{setCustomAttribute:i.setCustomAttribute.bind(i),addPageAction:function(n,r){var o=t();return r=e.assign({},r,{timeSinceNavigate:o}),i.addPageAction(n,r)},finished:function(){return t()&&this.setCustomAttribute("timeSinceNavigate",t()),i.finished.apply(i,arguments)}}}}return{setCustomAttribute:e.noop,addPageAction:e.noop,finished:e.noop}}),define("loggingUtils/logger/performance",["lodash","loggingUtils/logger/newrelic"],function(e,i){"use strict";function t(){return-1}var n="undefined"!=typeof window&&window.queryUtil;if(!n||n.isParameterTrue("suppressperformance"))return{mark:e.noop,measure:e.noop,start:e.noop,startOnce:e.noop,finish:e.noop,time:function(e,i){return i.apply(this,Array.prototype.slice.call(arguments,2))},getMark:e.noop,getMeasure:e.noop,clearMarks:e.noop,clearMeasures:e.noop,now:e.now,getResourceSize:t};var r=void 0,o=window.performance;if(o&&o.now)r=o.now.bind(o);else{var s=window.wixBiSession&&window.wixBiSession.initialTimestamp||0;r=function(){return e.now()-s}}var a=function(t,n){t&&(n=e.defaults({measureName:t.name,startTime:Math.round(t.startTime),duration:Math.round(t.duration)},n),i.addPageAction("measure",n))},u=void 0;if(o&&o.measure){var g=function(i,t){return e.find(o.getEntriesByName(t),{entryType:i})};u={mark:o.mark.bind(o),measure:function(e,i,t,n,r){try{o.measure(e,i,t),n&&a(u.getMeasure(e),r)}catch(e){}},getMark:g.bind(this,"mark"),getMeasure:g.bind(this,"measure"),clearMarks:o.clearMarks.bind(o),clearMeasures:o.clearMeasures.bind(o)}}else{var c={domLoading:{name:"domLoading",startTime:0}},l={},d=function(e,i){i?delete e[i]:e={}};u={mark:function(e){c[e]={name:e,startTime:r()}},measure:function(e,i,t,n,r){var o=u.getMark(i),s=u.getMark(t);if(o&&s){var g={name:e,startTime:o.startTime,duration:s.startTime-o.startTime};isNaN(g.duration)||(l[e]=g,n&&a(g,r))}},getMark:function(e){return c[e]},getMeasure:function(e){return l[e]},clearMarks:d.bind(this,c),clearMeasures:d.bind(this,l)}}return u.start=function(e){u.clearMeasures(e),u.mark(e+" start")},u.startOnce=function(e){u.getMark(e+" start")||u.start(e)},u.finish=function(e,i,t){var n=e+" start";if(u.getMark(n)){var r=e+" finish";u.mark(r),u.measure(e,n,r,i,t),u.clearMarks(r),u.clearMarks(n)}return u.getMeasure(e)},u.time=function(e,i,t,n){try{return u.start(e),i.apply(this,Array.prototype.slice.call(arguments,4))}finally{u.finish(e,t,n)}},u.now=r,o&&window.performance.getEntriesByName?u.getResourceSize=function(i){var t=o.getEntriesByName(i);if(t&&t.length){var n=t[0],r=n.transferSize||n.encodedBodySize;if(e.isNumber(r))return r}return-1}:u.getResourceSize=t,u}),define("loggingUtils/logger/services/browsingSession",["lodash","coreUtils"],function(e,i){"use strict";function t(){var e=!1,i=Date.now(),t=o();return(isNaN(t.ts)||i-t.ts>u)&&(e=!0),e}function n(){try{var e=Date.now(),t=i.guidUtils.getGUID();return window.localStorage.setItem(s,e),window.localStorage.setItem(a,t),{ts:e,id:t}}catch(e){return{ts:null,id:null}}}function r(){try{var e=Date.now();return window.localStorage.setItem(s,e),e}catch(e){return null}}function o(){try{return{isNew:!1,ts:parseInt(window.localStorage.getItem(s),10),id:window.localStorage.getItem(a)}}catch(e){return{isNew:!1,ts:null,id:null}}}var s="beatSessionTs",a="beatSessionId",u=18e5;return{SESSION_TS_KEY:s,SESSION_ID_KEY:a,SESSION_TTL_MS:u,get:o,track:function(){var i=!1;return t()&&(n(),i=!0),r(),e.assign(o(),{isNew:i})}}}),define("loggingUtils/logger/beat",["lodash","loggingUtils/bi/bi","coreUtils","loggingUtils/logger/performance","loggingUtils/logger/services/browsingSession","experiment"],function(e,i,t,n,r,o){"use strict";function s(i){if(e.isString(i)){var t=i.split(".");if(t.length>1)return t[1]}return i}function a(i){var n=t.urlUtils.toQueryString(e.omit(i,A),!0);return e.reduce(A,function(e,n){return e+"&"+t.urlUtils.toQueryParam(n,i[n],!0)},n)}function u(i,t,n,r){var o=g(i),s=c(i,n,r),a={et:f(n)};return e.merge({},t,o,s,a)}function g(i){return{vuuid:d(),vid:i.getSvSession()||M,dc:s(i.serviceTopology.serverName),vsi:x[i.siteId].viewerSessionId,uuid:i.siteHeader.userId,sid:i.siteId,iss:e.invoke(i,"isClientAfterSSR",!1),msid:i.getMetaSiteId()}}function c(i,t,n){var r=i.getBiData(),o=r.getTime(),s=L(t,r),a={pid:n,pn:r.getPageNumber(),st:l(i),sr:m(),wr:p(),isjp:T.maybeBot?"1":"0",isp:i.isPremiumDomain(),url:w(i.currentUrl.full),ref:window.document.referrer,ts:"start"===t?0:o.loadingTime,tts:"start"===t?0:o.totalLoadingTime,c:e.now(),v:i.baseVersion||"unknown",fis:s.isNew,bsi:s.id};return"finish"===t&&"undefined"!=typeof window&&window.santaRenderingError&&(a.ssr_fb=window.santaRenderingError.reason),a}function l(i){var t=i.rendererModel.siteInfo.documentType,n=e.indexOf(E,t);return-1!==n?n:t}function d(){var i=t.cookieUtils.getCookie("_wixUIDX")||"";return i=i.slice(e.lastIndexOf(i,"|")+1),i=i.replace(/^(null-user-id|null)$/g,"")}function f(i){var t=e.indexOf(B,i);return-1!==t?t:i>3?i:-1}function w(e){return e.replace(/^http(s)?:\/\/(www\.)?/,"").substring(0,256)}function m(){return"undefined"==typeof window?"":(window.screen&&window.screen.width||0)+"x"+(window.screen&&window.screen.height||0)}function p(){if("undefined"==typeof window)return"";var e=0,i=0;return window.innerWidth?(e=window.innerWidth,i=window.innerHeight):window.document&&(window.document.documentElement&&window.document.documentElement.clientWidth?(e=window.document.documentElement.clientWidth,i=window.document.documentElement.clientHeight):window.document.body&&window.document.body.clientWidth&&(e=window.document.body.clientWidth,i=window.document.body.clientHeight)),e+"x"+i}function v(e,i){var t=i.et;T.et=t,e.wixBiSession.et=t}function h(e){var i=k[e];return k[e]=!0,i}function S(e,i){return e&&e.wixBiSession.viewerSessionId&&"preview"!==e.viewMode&&!t.stringUtils.isTrue(e.currentUrl.query.suppressbi)&&-1!==f(i)&&(!D(i)||!h(i))}function y(e){x[e.siteId]=x[e.siteId]||{viewerSessionId:e.wixBiSession.viewerSessionId||t.guidUtils.getGUID()}}function _(e,i){var t={queryString:a(i),adapter:R.adapter,biUrl:e.getServiceTopologyProperty("biServerUrl")||R.biUrl};return o.isOpen("beatNotBeacon",e)&&(t.useBeacon=!1),t}function I(i,t){var n=i.currentUrl.query.sampleratio;return!(!(e.result(i,"isDebugMode",!1)&&"force"!==n||"none"===n)&&t)||(o.isOpen("vsiCoin",i)&&i.wixBiSession.viewerSessionId?(e.isUndefined(i.wixBiSession.coin)&&(i.wixBiSession.coin=parseInt(i.wixBiSession.viewerSessionId,16)),i.wixBiSession.coin%t==0):0===Math.floor(i.wixBiSession.random*t))}function b(e,t){if(I(e,N[t.et])){var n=_(e,t);i.wixBI.report(e,n)}}var k=[],U=("undefined"!=typeof window?window:{}).wixBiSession,T=void 0===U?{}:U;T.beat&&T.beat(5);var x={},E=["No Site Type","WixSite","UGC","Template"],B=["No Event Type","start","visible","finish"],M="NO_SV",R={adapter:"bt",biUrl:"http://frog.wix.com/"},C={src:29,evid:3},A=["url","ref"],P={6:"packages loaded",7:"load data",8:"render",finish:"layout",16:"TPAs"},N={16:20},L=function(e){return"finish"===e?r.track():r.get()},D=function(e){return e>3&&16!==e},q=void 0;return{reportBeatEvent:function(e,i,t){y(e);var r=u(e,C,i,t);if(v(e,r),S(e,i)&&b(e,r),e.isViewerMode()){var o=e.viewMode;o="site"===o?"":" "+o,q||(n.measure("main-r started"+o,"domLoading","beat 4",!0),n.measure("utils loaded"+o,"beat 4","beat 5",!0),q="beat 5");var s="beat "+i;n.mark(s);var a=P[i]||i;n.measure(a+o,q,s,!0),q=s}},shouldIncludeInSampleRatio:I}}),define("loggingUtils/logger/logger",["lodash","loggingUtils/bi/bi","loggingUtils/logger/beat","coreUtils"],function(e,i,t,n){"use strict";function r(e){return"string"==typeof e?x[e]:e}function o(i,t){var o={};return(44===i.src||42===i.src&&t)&&(o.visitor_id=t),e.assign(o,{errn:i.errorName,evid:10,sev:r(i.severity),cat:b?1:2,iss:1,ut:n.cookieUtils.getCookie("userType")})}function s(i,t,n){var r=e.merge({src:44,sev:30,errn:"error_name_not_found"},m(i,T),o(i,n),w(i,t));return t&&t.description&&(r.desc=JSON.stringify(t.description).slice(0,512)),r}function a(i,t){return e.merge({src:42},m(i,E),w(i,t))}function u(i,t,n,r){var o=void 0,u=d(i);switch(t){case"error":o=s(n,r,y(i));break;case"event":o=a(n,r)}return e.merge(o,u)}function g(e,i,t){var n=i.reportType||(i.errorCode||i.errc?"error":"event"),r={biUrl:e.serviceTopology.biServerUrl,adapter:i.adapter||i.endpoint||("error"===n?"trg":"ugc-viewer"),params:u(e,n,i,t)};return"useBeacon"in i&&(r.useBeacon=i.useBeacon),r}function c(i){return e.isFunction(i.getMetaSiteId)?i.getMetaSiteId():i.rendererModel.metaSiteId}function l(e){var i=e.santaBase&&e.santaBase.match(/([\d\.]+)\/?$/);return i&&i[1]||""}function d(i){B[i.siteId]=B[i.siteId]||i.wixBiSession.viewerSessionId||n.guidUtils.getGUID();var t=i.serviceTopology.serverName?e.head(i.serviceTopology.serverName.split(".")):"",r={site_id:i.siteId,msid:c(i),majorVer:k,ver:l(i),server:t,viewMode:i.viewMode};return b||(r.vsi=B[i.siteId]),r}function f(e){return"string"==typeof e?encodeURIComponent(e):e}function w(i,t){var n=i.params;return e.isArray(n)?e.pick(t,n):e.isObject(n)?e.mapValues(n,function(e){return f(t[e])}):e.mapValues(t,f)}function m(i,t){return e.transform(i,function(e,i,n){var r=t[n];r&&(e[r]=i)},{})}function p(e){return n.stringUtils.isTrue(e.currentUrl.query.suppressbi)}function v(e){return!!e&&(e.callCount=e.callCount||0,e.callCount++,e.callLimit&&e.callCount>e.callLimit)}function h(i,n){if(i.forceBI)return!0;var r=U;return n&&(e.result(i,"isWixSite",!1)&&"wixSiteSampleRatio"in n?r=n.wixSiteSampleRatio:"sampleRatio"in n?r=n.sampleRatio:("errorCode"in n||"editor"===n.endpoint)&&(r=0)),!(r&&r>=1)||t.shouldIncludeInSampleRatio(i,r)}function S(e,i){return!p(e)&&!v(i)&&h(e,i)}function y(e){return B[e.siteId]||e.wixBiSession&&e.wixBiSession.viewerSessionId}function _(e,i){var t=e.isPremiumDomain();switch(i){case"googleAnalytics":if(I(e,i))return[e.googleAnalytics];break;case"googleTagManager":if(I(e,i))return[e.googleTagManager];break;case"facebookRemarketing":if(I(e,i)&&t)return[e.facebookRemarketing];break;case"googleRemarketing":if(I(e,i)&&t)return[e.googleRemarketing];break;case"yandexMetrika":if(I(e,i)&&t)return[e.yandexMetrika]}return[]}function I(i,t){return!e.isEmpty(i[t])}var b="undefined"!=typeof window&&window.queryUtil&&window.queryUtil.isParameterTrue("isEdited"),k="undefined"==typeof window||window.clientSideRender?3:4,U=10,T={errorName:"errn",errorCode:"errc",errc:"errc",src:"src",severity:"sev",sev:"sev",packageName:"errscp"},x={recoverable:10,warning:20,error:30,fatal:40},E={eventId:"evid",evid:"evid",src:"src"},B={};return{reportBI:function(t,n,r){if(t&&e.isObject(n)&&S(t,n)){var o=g(t,n,r);i.wixBI.report(t,o)}},reportGoogleAnalytics:function(t){if(!b){var n=_(t,"googleAnalytics");i.googleAnalytics.report(n,t.ipAnonymization,e.tail(arguments))}},reportGoogleTagManager:function(t,n){if(!b){var r=_(t,"googleTagManager");e.isEmpty(r)||i.googleTagManager.report(r[0],n)}},reportPageEvent:function(t,n){if(t&&e.isString(n)&&!b&&!p(t)){i.googleAnalytics.reportPageEvent(t,n,_(t,"googleAnalytics"));var r=_(t,"googleTagManager");e.isEmpty(r)||i.googleTagManager.reportPageEvent(n,r[0])}},register:function(i,t,n){e.forOwn(n,function(e){e.packageName=i})},reportBeatEvent:t.reportBeatEvent,initFacebookRemarketingUserPixel:function(e){if(!b&&!p(e)){var t=_(e,"facebookRemarketing")[0];i.facebookRemarketing.initRemarketingPixel(e,t)}},initFacebookRemarketingPixelId:function(e,t){b||p(e)||i.facebookRemarketing.initPixelId(e,t)},fireFacebookRemarketingPixel:function(e,t,n){i.facebookRemarketing.fireRemarketingPixel(e,t,n)},initGoogleRemarketingPixel:function(e){b||p(e)||i.googleRemarketing.initRemarketingPixel(_(e,"googleRemarketing"))},fireGoogleRemarketingPixel:function(){i.googleRemarketing.fireRemarketingPixel()},initYandexMetrika:function(e){b||p(e)||i.yandexMetrika.initialize(_(e,"yandexMetrika"))},reportYandexPageHit:function(e){i.yandexMetrika.reportPageHit(e)},shouldSendReport:S,getVisitorId:y}}),define("loggingUtils/bi/errors",["loggingUtils/bi/errors.json","lodash","loggingUtils/logger/logger"],function(e,i,t){"use strict";return i.forEach(e,function(e,i){e.errorName=i}),t.register("utils","error",e),e}),define("loggingUtils/logger/services/imageContext",["lodash","loggingUtils/logger/performance","experiment"],function(e,i,t){"use strict";function n(){var e=parseInt(t.getValue("viewPortImageLoadingBi"),10);return e>0?e:5e3}function r(i){if(e.isString(i)){var t=i.match(f);return t||(t=i.match(w))?t[1]:""}return""}function o(i,t,n){return e.filter(i,function(e){var i=e.id;return d[i]?n&&!!d[i][t]:(d[i]={},d[i][t]=!0,!0)})}function s(i,t,n){e.forEach(i,function(e){e.promise.then(t,n)})}function a(){this._current=null}function u(e,i,t){this._siteData=e,this._pageId=i.pageId,this._events=t,this._interval=0,this._finishCount=1,this._failDetailsBuffer=[],this._status=c.INITIAL,this._reason=l.INITIAL,this._images={total:0,success:0,fail:0,failDetails:[],totalSize:0}}var g={SUCCESS:0,FAIL:1},c={INITIAL:0,PROGRESS:1,FINISHED:2},l={INITIAL:0,SUCCESS_OR_FAIL:1,TIMED_OUT:2,DESTROYED:3},d={},f=/\/(v[0-9.]+\/.+)$/,w=/\/([^\/]+)$/;a.prototype={createImageContext:function(e,i,t,n,r){return this._current=new u(i,{pageId:e},{onProgress:t,onSuccess:n,onFail:r})},getCurrentImageContext:function(){return this._current}},u.prototype={_isFinished:function(){return this._images.total===this._images.success+this._images.fail},_isFinishSuccess:function(){return this._isFinished()&&0===this._images.fail},_checkFinished:function(){this._finishCount<=10&&this._isFinished()&&(this._finish(l.SUCCESS_OR_FAIL),this._isFinishSuccess()?this._events.onSuccess(this):this._events.onFail(this),this._finishCount++)},_startProgress:function(){var e=this,i=1;this._status=c.PROGRESS,this._interval=setInterval(function(){e._flushFailDetailsBuffer(),e._events.onProgress(e,i++),i>10&&e._finish(l.TIMED_OUT)},n())},_stopProgress:function(){this._interval&&(clearInterval(this._interval),this._interval=0)},_finish:function(e){this._status=c.FINISHED,this._reason=e,this._failDetailsBuffer.length&&this._flushFailDetailsBuffer(),this._stopProgress()},_onImageStatusChange:function(e,t){if(!(this._status<c.PROGRESS||this._reason>l.SUCCESS_OR_FAIL||t.canceled)){if(e===g.SUCCESS){var n=t.target?i.getResourceSize(t.target.src):0;this._increaseSuccessCount(n)}else{var o=t.target?r(t.target.src):"";this._increaseFailCount(o)}this._checkFinished()}},_increaseSuccessCount:function(e){this._images.success++,this._images.totalSize+=e},_increaseFailCount:function(e){var i=this._siteData.getBiData().getTime();this._images.fail++,this._failDetailsBuffer.push({d:i.totalLoadingTime,url:e})},_flushFailDetailsBuffer:function(){this._images.failDetails.push(this._failDetailsBuffer),this._failDetailsBuffer=[]},getImages:function(){return this._images},getPageId:function(){return this._pageId},setImages:function(e){var i=o(e,this.getPageId(),this._status===c.INITIAL);return this._images.total+=i.length,this._status===c.INITIAL&&(this._startProgress(),this._checkFinished()),s(i,this._onImageStatusChange.bind(this,g.SUCCESS),this._onImageStatusChange.bind(this,g.FAIL)),this},destroy:function(){this._finish(l.DESTROYED)}};var m={_sites:{},get:function(e){return this._sites[e.siteId]=this._sites[e.siteId]||new a}};return{create:function(i,t,n,r,o){return n=n||e.noop,r=r||e.noop,o=o||e.noop,m.get(i).createImageContext(t,i,n.bind(null,i),r.bind(null,i),o.bind(null,i))},getCurrent:function(e){return m.get(e).getCurrentImageContext()}}}),define("loggingUtils/logger/imagesBi",["lodash","loggingUtils/bi/bi","coreUtils","loggingUtils/logger/beat","loggingUtils/logger/services/imageContext"],function(e,i,t,n,r){"use strict";function o(i){return JSON.stringify({a:e.take(i,d)})}function s(e,i){var n=i.getImages(),r=n.totalSize>=0?Math.round(n.totalSize/1024):"",o=e.getBiData();return{src:29,d:o.getTime().totalLoadingTime,tn:n.total,sid:e.siteId,msid:e.getMetaSiteId(),pid:i.getPageId(),pn:o.getPageNumber(),vsi:e.wixBiSession.viewerSessionId,vid:t.cookieUtils.getCookie("svSession"),s:r}}function a(i,n,r){var o=e.defaults(s(i,n),r);return{adapter:"m",queryString:t.urlUtils.toQueryString(o)}}function u(e,t,n){var r=t.getImages();i.wixBI.report(e,a(e,t,{evid:11,i:n,sn:r.success,fn:r.fail,fd:o(r.failDetails[n-1])}))}function g(e,t){i.wixBI.report(e,a(e,t,{evid:12}))}function c(t,n){var r=n.getImages();i.wixBI.report(t,a(t,n,{evid:13,fn:r.fail,fd:o(e.flatten(r.failDetails))}))}function l(e){return e.isViewerMode()&&n.shouldIncludeInSampleRatio(e)&&!t.stringUtils.isTrue(e.currentUrl.query.suppressbi)}var d=8;return function(e,i){if(l(e)){var t=e.getBiData().getPageId(),n=r.getCurrent(e);return n&&n.getPageId()===t||(n&&n.destroy(),n=r.create(e,t,u,g,c)),n=n.setImages(i)}}}),define("loggingUtils",["loggingUtils/bi/errors","loggingUtils/logger/logger","loggingUtils/logger/performance","loggingUtils/logger/newrelic","loggingUtils/logger/imagesBi"],function(e,i,t,n,r){"use strict";return{bi:{errors:e},logger:i,performance:t,newrelic:n,imagesBi:r}});
//# sourceMappingURL=loggingUtils.min.js.map