define("core/utils/addComponentPlugins/plugins/page",["lodash","constants","util"],function(t,e,i){"use strict";function n(e,i,n){t.forEach(n,function(n){var o=function(e,i,n){var o=i;return t.forEach(n,function(t){var i=e.components.getChildren(o);o=i[t]}),o}(e,i,n.pathToParent),r=e.theme.styles.createItem(n.style),s=e.documentServices.tpa.widget.add(n.appDefinitionId,{widgetId:n.widgetId,pageId:i.id,parentContainerRef:o,layout:n.layout,styleId:r});t.forOwn(n.data,function(t,i){e.documentServices.tpa.data.set(s,i,t)})})}function o(t,i,n,o){t.history.add("adding new popup",{actionType:e.DS_ACTIONS.ADD_PAGE,nextPage:i.id,currentPage:n}),t.documentServices.waitForChangesApplied(function(){var e=t.pages.popupPages.getPopupContainer(i.id);t.selection.selectComponentByCompRef(e),o(e)})}return function(e,r,s,a,u,c){if(a.data.isPopup){a.layout.x=0,a.layout.y=0,a.data.pageUriSEO=null;var l=t.omit(a,"tpaComps"),p=e.pages.popupPages.add(i.translate(l.data.title),l),d=e.documentServices.pages.getFocusedPageId();return e.pages.navigateTo(p.id),a.tpaComps?e.documentServices.waitForChangesApplied(function(){n(e,p,a.tpaComps),o(e,p,d,c)}):o(e,p,d,c),p}return null}}),define("core/utils/addComponentPlugins/plugins/anchor",["lodash","util"],function(t,e){"use strict";function i(e,i,n){var o=void 0,r=function(e,i,n){var o=new RegExp(n+"\\s(\\d+)"),r=[];return t.forEach(i,function(t){var i=e.components.data.get(t).name.match(o);i&&r.push(parseInt(i[1],10))}),r}(e,i,n);for(r.sort(function(t,e){return t-e}),o=0;o<r.length;++o)if(!t.includes(r,o+1))return o+1;return o+1}return function(t,n,o,r,s,a){var u=e.translate("component_label_anchor"),c=t.documentServices.pages.getReference(t.documentServices.pages.getPrimaryPageId()),l=i(t,t.components.get.byType("wysiwyg.common.components.anchor.viewer.Anchor",c),u);r.data.name=u+" "+l;var p=n(o,r);return a&&t.documentServices.waitForChangesApplied(function(){a(p)}),p}}),define("core/utils/updateDataPlugins/plugins/imageData",["util"],function(t){"use strict";return function(e){return e.title&&(e.title=t.media.fixMediaTitleLength(e.title,100)),e.description&&(e.description=t.media.fixMediaTitleLength(e.description,1200)),e}}),define("core/utils/updateDataPlugins/plugins/vectorImageData",["util"],function(t){"use strict";return function(e){return e.title&&(e.title=t.media.fixMediaTitleLength(e.title,100)),e}}),define("core/utils/updateDataPlugins/plugins/wixVideoData",["util"],function(t){"use strict";return function(e){return e.title&&(e.title=t.media.fixMediaTitleLength(e.title,100)),e}}),define("core/utils/updateDataPlugins/updateDataPlugins",["core/utils/updateDataPlugins/plugins/imageData","core/utils/updateDataPlugins/plugins/vectorImageData","core/utils/updateDataPlugins/plugins/wixVideoData"],function(t,e,i){"use strict";return{Image:t,VectorImage:e,WixVideo:i}}),define("core/utils/addComponentPlugins/plugins/commonUtils/addMultiple",["lodash","core/utils/updateDataPlugins/updateDataPlugins"],function(t,e){"use strict";return function(i,n,o,r,s,a,u,c){t.forEach(c,function(s,c){var l=void 0,p=void 0,d=void 0;c>0?(d=i.documentServices.pages.getFocusedPageId(),p=i.pasteLogic.addContext.getPastePosition(i,r.layout,d),l=c>0?t.merge({},r,{layout:p}):r):l=r;var g=u(l,s),m=g.data&&g.data.type;e[m]&&(g.data=e[m](g.data));var h=n(o,g);a&&i.documentServices.waitForChangesApplied(function(){a(h)})})}}),define("core/utils/addComponentPlugins/plugins/documentMedia",["lodash","core/utils/addComponentPlugins/plugins/commonUtils/addMultiple","util"],function(t,e,i){"use strict";function n(e,i){return t.merge({},e,{data:{title:i.title,link:{docId:t.last(i.fileUrl.split("/")),name:i.title,type:"DocumentLink"}}})}return function(t,o,r,s,a,u){if(s.data.link&&s.data.link.docId)return!1;var c=t.mediaServices;return c.mediaManager.open(c.mediaManager.categories.DOCUMENT,{callback:function(i){e(t,o,r,s,a,u,n,i)},translation:{submitButton:i.translate("MMGR_submitbutton_addpanel_mydocs_add")}}),!0}}),define("core/utils/addComponentPlugins/plugins/commonUtils/addAudioPluginUtil",["lodash","core/utils/addComponentPlugins/plugins/commonUtils/addMultiple","util"],function(t,e,i){"use strict";return{handleAudioAdd:function(t,n,o,r,s,a,u){if(r.data.uri)return!1;var c=t.mediaServices;return c.mediaManager.open(c.mediaManager.categories.MUSIC,{callback:function(i){e(t,n,o,r,s,a,u,i)},translation:{submitButton:i.translate("MMGR_submitbutton_addpanel_mytracks_add")}}),!0}}}),define("core/utils/addComponentPlugins/plugins/audioPlayer",["lodash","core/utils/addComponentPlugins/plugins/commonUtils/addAudioPluginUtil"],function(t,e){"use strict";function i(e,i){return t.merge({},e,{data:{uri:i.fileName,originalFileName:i.title}})}return function(t,n,o,r,s,a){return e.handleAudioAdd(t,n,o,r,s,a,i)}}),define("core/utils/addComponentPlugins/plugins/singleAudioPlayer",["lodash","core/utils/addComponentPlugins/plugins/commonUtils/addAudioPluginUtil"],function(t,e){"use strict";function i(e,i){return t.merge({},e,{data:{uri:i.fileName,originalFileName:i.title,artist:"Unknown Artist",track:"Unknown Track"}})}return function(t,n,o,r,s,a){return e.handleAudioAdd(t,n,o,r,s,a,i)}}),define("core/utils/componentPreviewReadyPlugins/formPlugin",["lodash"],function(t){"use strict";function e(e,i){var n=e.toEmailAddress,o=i.documentServices.generalInfo.getUserInfo().email;n||function(e){return t.endsWith(e,"@wix.com")}(o)||(e.toEmailAddress=o)}return{updateDataWithDefaults:e}}),define("core/utils/addComponentPlugins/plugins/contactForm",["lodash","util","core/utils/componentPreviewReadyPlugins/formPlugin"],function(t,e,i){"use strict";var n={successMessage:"Contact_Form_Settings_Messages_Success_message_default",validationErrorMessage:"Contact_Form_Settings_Messages_Error_message_mandatory_fields_default",errorMessage:"Contact_Form_Settings_Messages_Error_message_for_email_fields_default"};return function(o,r,s,a,u,c){!function(i){t.forOwn(n,function(t,n){i[n]=e.translate(t)})}(a.data),i.updateDataWithDefaults(a.data,o);var l=r(s,a);return c&&o.documentServices.waitForChangesApplied(function(){c(l)}),l}}),define("core/utils/addComponentPlugins/plugins/clipArt",["lodash","experiment"],function(t,e){"use strict";var i="full",n="fit";return function(o,r,s,a,u,c){a.props||(a=function(o){return t.merge(o,{data:{title:""},layout:{rotationInDegrees:0,scale:1,fixedPosition:!1,anchors:[]},props:{displayMode:e.isOpen("se_addPanelClipArtToIllustration")?n:i,type:"WPhotoProperties"},style:o.style||"ca1"})}(a));var l=r(s,a);return c&&o.documentServices.waitForChangesApplied(function(){c(l)}),l}}),define("core/utils/addComponentPlugins/plugins/svgShape",["lodash"],function(t){"use strict";return function(e,i,n,o,r,s){var a=i(n,function(e){return t.defaults(e,{data:{link:null,type:"SvgShape"}})}(o));return s&&e.documentServices.waitForChangesApplied(function(){s(a)}),a}}),define("core/utils/addComponentPlugins/plugins/wPhoto",["lodash"],function(t){"use strict";return function(e,i,n,o,r,s){o.props||(o=function(e){return t.merge(e,{layout:{rotationInDegrees:0,scale:1,fixedPosition:!1,anchors:[]},props:{type:"WPhotoProperties"},style:e.style||"wp2"})}(o));var a=i(n,o);return s&&e.documentServices.waitForChangesApplied(function(){s(a)}),a}}),define("core/app/constants",["constants"],function(t){"use strict";return t}),define("core/utils/addComponentPlugins/plugins/verticalAnchorsMenu",["lodash","core/app/constants"],function(t,e){"use strict";return function(t,i,n,o,r,s){var a=o.layout;a.fixedPosition&&(a.docked.right.px+=e.SECTIONS_REORGANIZE.STRIP_WIDTH,a.docked.right.px+=t.isVerticalScrollbarHidden()?.01*window.innerWidth:e.SECTIONS_REORGANIZE.STRIP_WIDTH,delete a.x,delete a.y);var u=i(n,o);return s&&t.documentServices.waitForChangesApplied(function(){s(u)}),u}}),define("core/utils/addComponentPlugins/plugins/stripContainer",[],function(){"use strict";return function(t,e,i,n){n.layout.x=0}}),define("core/utils/addComponentPlugins/plugins/appControllerAddPlugin",["lodash"],function(t){"use strict";return function(e,i,n){var o=e.components.data.get(i),r=e.documentServices.platform.getAppDataByAppDefId(o.applicationId);if(r){var s={eventType:"controllerAdded",eventPayload:{controllerRef:i}};n&&t.assign(s,{origin:n}),e.documentServices.platform.notifyApplication(r.applicationId,s)}}}),define("core/utils/addComponentPlugins/plugins/vectorImageBefore",["lodash"],function(t){"use strict";return function(e,i,n,o){var r=o.data.svgId;e.media.vectorImage.fetchSvg(r,t.noop)}}),define("core/utils/layoutConstraintsUtil/boundariesConstraintsUtil",["lodash"],function(t){"use strict";function e(e,i,n){!function(e,i,n){var o=i.x,r=i.x+i.width,s=e.left;s&&(t.isNumber(s.compLeftX)&&(n.x&&o<s.compLeftX&&(i.x+=s.compLeftX-o),n.width&&o<s.compLeftX&&(i.width-=s.compLeftX-o)),t.isNumber(s.compRightX)&&(n.x&&r<s.compRightX&&(i.x+=s.compRightX-r),n.width&&r<s.compRightX&&(i.width+=s.compRightX-r)))}(e,i,n),function(e,i,n){var o=i.x,r=i.x+i.width,s=e.right;s&&(t.isNumber(s.compRightX)&&(n.x&&r>s.compRightX&&(i.x+=s.compRightX-r),n.width&&r>s.compRightX&&(i.width+=s.compRightX-r)),t.isNumber(s.compLeftX)&&(n.x&&o>s.compLeftX&&(i.x+=s.compLeftX-o),n.width&&o>s.compLeftX&&(i.width-=s.compLeftX-o)))}(e,i,n)}function i(e,i,n){!function(e,i,n){var o=i.y,r=i.y+i.height,s=e.top;s&&(t.isNumber(s.compTopY)&&(n.y&&o<s.compTopY&&(i.y+=s.compTopY-o),n.height&&o<s.compTopY&&(i.height-=s.compTopY-o)),t.isNumber(s.compBottomY)&&(n.y&&r<s.compBottomY&&(i.y+=s.compBottomY-r),n.height&&r<s.compBottomY&&(i.height+=s.compBottomY-r)))}(e,i,n),function(e,i,n){var o=i.y,r=i.y+i.height,s=e.bottom;s&&(t.isNumber(s.compBottomY)&&(n.y&&r>s.compBottomY&&(i.y+=s.compBottomY-r),n.height&&r>s.compBottomY&&(i.height+=s.compBottomY-r)),t.isNumber(s.compTopY)&&(n.y&&o>s.compTopY&&(i.y+=s.compTopY-o),n.height&&o>s.compTopY&&(i.height-=s.compTopY-o)))}(e,i,n)}function n(n,o,r,s,a){var u=function(e,i){return t(e).pick(["x","y","width","height"]).pickBy(function(e,n){return!t.isEqual(e,i[n])}).mapValues(function(t,e){return e}).value()}(s,a);(n.left||n.right)&&e(n,s,u),(n.top||n.bottom)&&i(n,s,u)}return{applyBoundariesConstraintOnLayout:n}}),define("core/utils/layoutConstraintsUtil/LayoutConstraintsUtil",["lodash","core/utils/layoutConstraintsUtil/boundariesConstraintsUtil"],function(t,e){"use strict";function i(i,n,o){return t(o).filter(function(e){return function(e){return t.isFunction(e.applyConstraint)||t.isFunction(e.getBoundaries)}(e)&&(!t.isFunction(e.shouldConstrain)||e.shouldConstrain(i,n))}).map(function(o){var r=t.clone(o);return r.applyConstraint||(r.applyConstraint=e.applyBoundariesConstraintOnLayout.bind(null,r.getBoundaries(i,n))),r}).value()}function n(t,e,n){this.constraintsToApply=i(t,e,n)}return n.prototype.applyConstraints=function(e,i,n,o){var r=t.assign({},o,n);t.forEach(this.constraintsToApply,function(t){t.applyConstraint(e,i,r,o)}),t.assign(n,t.pick(r,t.keys(n)))},n.prototype.getConstraintArea=function(e,i){var n=t(this.constraintsToApply).filter(function(e){return t.isFunction(e.getConstraintArea)}).invokeMap("getConstraintArea",e,i).compact().flatten().value();return t.isEmpty(n)?null:n},n.prototype.hasConstraints=function(){return!t.isEmpty(this.constraintsToApply)},n}),define("core/utils/layoutConstraintsUtil/layoutConstraints/stretchToScreenConstraints",["lodash"],function(t){"use strict";function e(e,n,o,r){var s=e.getPreviewPosition().width,a=function(e,i){return t(e).pick(["x","y","width","height"]).pickBy(function(e,n){return!t.isEqual(e,i[n])}).mapValues(function(t,e){return e}).value()}(o,r),u=void 0;if(a.x){var c=o.x,l=i;(u=t.min([l-c,0]))&&(o.x+=u)}if(a.width){var p=o.x+o.width,d=s-i;(u=t.max([d-p,0]))&&(o.width+=u)}}var i=80;return{shouldConstrain:function(t,e){return t.components.layout.isHorizontallyStretchedToScreen(e)},applyConstraint:e}}),define("core/utils/layoutConstraintsUtil/layoutConstraints/constraintsUtil",["lodash"],function(t){"use strict";return{isShownOnAllPagesComponent:function(e,i){var n=t.isArray(i)?i:[i];return t.some(n,function(t){return e.components.isShowOnAllPages(t)&&!e.utils.isSameRef(t,e.documentServices.siteSegments.getFooter())})}}}),define("core/utils/layoutConstraintsUtil/layoutConstraints/mobileBoundariesConstraints",["lodash","core/utils/layoutConstraintsUtil/layoutConstraints/constraintsUtil","stateManagement","core/app/constants"],function(t,e,i,n){"use strict";function o(t,e){var i=t.siteSegments[e].call(t.siteSegment);return t.components.layout.getRelativeToScreen(i)}function r(t,e){return{left:t.x,width:t.width,height:t.height-e.height}}function s(e,i){var n=o(e,d.HEADER);return t.assign(r(i,n),{top:i.y+n.height})}function a(t,e){return t.utils.isSameRef(e,t.documentServices.siteSegments.getHeader())}function u(t,e){return t.utils.isSameRef(e,t.documentServices.siteSegments.getFooter())}function c(t,e){return"SiteRegionContainer"===g.getCompTypeSuffix(e,t.documentServices)}function l(t){var e=o(t,d.SITE_STRUCTURE);return{top:{compBottomY:n.SIZE_LIMITS.MOBILE_DRAG_CONSTRAINT_MARGINS},bottom:{},left:{compRightX:e.x+n.SIZE_LIMITS.MOBILE_DRAG_CONSTRAINT_MARGINS},right:{compLeftX:e.x+e.width-n.SIZE_LIMITS.MOBILE_DRAG_CONSTRAINT_MARGINS}}}function p(t,e){var i=t.components.getType(e);return h[i]||m}var d={SITE_STRUCTURE:"getSiteStructure",HEADER:"getHeader",FOOTER:"getFooter"},g=i.components.selectors,m={getBoundaries:function(i,n){var r=i.components.getContainer(n);if(c(i,r))return function(t,e){var i=t.components.layout.getRelativeToScreen(e);return{top:{compTopY:i.y},bottom:{compBottomY:i.y+i.height},left:{compLeftX:i.x},right:{compRightX:i.x+i.width}}}(i,r);var s=l(i);if(!e.isShownOnAllPagesComponent(i,n))return t.assign(s.bottom,{compBottomY:5e5}),s;var p=o(i,d.FOOTER);if(t.assign(s.bottom,{compBottomY:p.y+p.height}),a(i,r)){var g=o(i,d.HEADER);return t.assign(s.bottom,{compBottomY:g.height}),s}return u(i,r)&&t.assign(s.top,{compTopY:p.y}),s},getConstraintArea:function(i,n){var l=i.components.getContainer(n),p=o(i,d.SITE_STRUCTURE);return c(i,l)?function(e,i,n){var s=o(e,d.HEADER),a={left:s.x,width:s.width,height:s.height,top:s.y},u=e.components.layout.getRelativeToScreen(n),c=t.assign(r(i,u),{top:i.y+u.height+u.y});return t.concat(a,c)}(i,p,l):e.isShownOnAllPagesComponent(i,n)?a(i,l)?s(i,p):u(i,l)?function(e,i){var n=o(e,d.FOOTER);return t.assign(r(i,n),{bottom:i.y+n.y})}(i,p):null:null}},h={"wysiwyg.viewer.components.HeaderContainer":{getBoundaries:function(e,i){var o=e.documentServices.components.getChildren(t.isArray(i)?i[0]:i),r=l(e);return t.isEmpty(o)?r:t.assign(r,{top:{compBottomY:n.SIZE_LIMITS.MOBILE_HEADER_MIN_HEIGHT}})},getConstraintArea:function(){return null}},"wysiwyg.viewer.components.mobile.TinyMenu":{getBoundaries:function(t){var e=o(t,d.SITE_STRUCTURE),i=o(t,d.HEADER);return{top:{compTopY:e.y},bottom:{compBottomY:i?Math.min(i.height,n.SIZE_LIMITS.FIXED_TINY_MENU_MAX_Y):n.SIZE_LIMITS.FIXED_TINY_MENU_MAX_Y},left:{compLeftX:e.x},right:{compRightX:e.x+e.width}}},getConstraintArea:function(e){var i=o(e,d.SITE_STRUCTURE),r=o(e,d.HEADER),a=s(e,i);return t.assign(a,{top:i.y+Math.min(n.SIZE_LIMITS.FIXED_TINY_MENU_MAX_Y,r.height)}),a}}};return{shouldConstrain:function(t){return t.isMobileEditor()},getConstraintArea:function(t,e){return p(t,e).getConstraintArea(t,e)},getBoundaries:function(t,e){return p(t,e).getBoundaries(t,e)}}}),define("core/utils/layoutConstraintsUtil/layoutConstraints/desktopBoundariesConstraints",["lodash","core/utils/layoutConstraintsUtil/layoutConstraints/constraintsUtil","experiment"],function(t,e,i){"use strict";function n(t,n){var s={};return s.top=i.isOpen("removeDesktopTopConstraintExp")?{compBottomY:o}:{compTopY:0},t.isCurrentPageLandingPage()||(s.bottom={compBottomY:function(t,i){if(e.isShownOnAllPagesComponent(t,i)&&(!t.siteSegments.isUsingSectionsLayout()||!function(t,e){var i=t.siteSegments.getSiteStructure();return t.utils.isSameRef(t.components.getContainer(e),i)}(t,i))){var n=t.components.layout.getRelativeToScreen(t.documentServices.siteSegments.getFooter());return n.y+n.height}return r}(t,n)}),s}var o=20,r=5e5;return{shouldConstrain:function(t){return!t.isMobileEditor()},getBoundaries:n}}),define("core/utils/layoutConstraintsUtil/layoutConstraints/repeaterElementsBoundariesConstraints",["stateManagement"],function(t){"use strict";var e=t.components.selectors,i=20;return{shouldConstrain:function(t,i){return t.isMobileEditor()&&t.components.is.descendantOfRepeaterItem(i)&&!e.isRepeaterItem(i,t.documentServices)},getBoundaries:function(t,e){var n=t.components.getAncestorRepeaterItem(e),o=t.components.layout.getRelativeToScreen(e),r=t.components.layout.getRelativeToScreen(n);return{left:{compLeftX:r.x-o.width+i},right:{compRightX:r.x+r.width+o.width-i},top:{compTopY:r.y},bottom:{compBottomY:r.y+r.height}}}}}),define("core/utils/layoutConstraintsUtil/editorConstraintsRegistry",["core/utils/layoutConstraintsUtil/layoutConstraints/stretchToScreenConstraints","core/utils/layoutConstraintsUtil/layoutConstraints/mobileBoundariesConstraints","core/utils/layoutConstraintsUtil/layoutConstraints/desktopBoundariesConstraints","core/utils/layoutConstraintsUtil/layoutConstraints/repeaterElementsBoundariesConstraints"],function(t,e,i,n){"use strict";return[t,e,i,n]}),define("core/utils/layoutConstraintsUtil/EditorLayoutConstraintsUtil",["core/utils/layoutConstraintsUtil/LayoutConstraintsUtil","core/utils/layoutConstraintsUtil/editorConstraintsRegistry"],function(t,e){"use strict";function i(i,n){t.call(this,i,n,e)}return i.prototype=t.prototype,i}),define("core/utils/updateLayoutUtil",["lodash","core/utils/layoutConstraintsUtil/EditorLayoutConstraintsUtil"],function(t,e){"use strict";function i(e,i,n,o){if(!e)return e;var r=t.pick(e,["width","height"]);return t.isNumber(e.x)&&(r.x=i.x+e.x,n&&(r.x+=o)),t.isNumber(e.y)&&(r.y=i.y+e.y),r}function n(e,i){return t.some(e,function(e,n){return!t.isEqual(e,i[n])})}function o(o,r,s,a){if(n(s,a)&&!o.utils.isPage(r)){var u=new e(o,r);if(u.hasConstraints()){var c=o.components.layout.isHorizontallyStretchedToScreen(r),l=o.site.getSiteX(),p=function(t,e){var i=t.components.getContainer(e);return t.components.layout.getRelativeToScreen(i)}(o,r),d=i(s,p,c,l),g=i(a,p,c,l);u.applyConstraints(o,r,d,g);var m=function(e,i,n,o){if(!e)return e;var r=t.pick(e,["width","height"]);return t.isNumber(e.x)&&(r.x=e.x-i.x,n&&(r.x-=o)),t.isNumber(e.y)&&(r.y=e.y-i.y),r}(d,p,c,l);t.assign(s,t.pick(m,t.keys(s)))}}return s}return{getLayoutAfterConstraints:o,resetCompLayoutToAspectRatio:function(e,i,n){var o=e.components.layout.getRelativeToStructure(i),r=t.pick(o,["x","y","width","height"]),s=Math.max(r.width,r.height);n<1?(r.height=s,r.width=r.height*n):(r.width=s,r.height=r.width/n),r.x=o.x+(o.width-r.width)/2,r.y=o.y+(o.height-r.height)/2,e.components.layout.updateRelativeToStructure(i,r,!0)},getLayoutRelativeToScreenAfterConstraints:function(t,i,o,r){if(n(o,r)&&!t.utils.isPage(i)){var s=new e(t,i);s.hasConstraints()&&s.applyConstraints(t,i,o,r)}return o}}}),define("core/utils/addComponentPlugins/plugins/vectorImageAfter",["lodash","core/utils/updateLayoutUtil"],function(t,e){"use strict";return function(t,i){var n=t.components.properties.get(i);if("fit"===n.displayMode||"legacyFit"===n.displayMode){var o=t.media.vectorImage.getSvgOriginalAspectRatio(i);e.resetCompLayoutToAspectRatio(t,i,o)}}}),define("core/utils/addComponentPlugins/plugins/wTwitterTweet",[],function(){"use strict";return function(t,e,i,n){n.data.urlFormat=t.documentServices.generalInfo.urlFormat.get()}}),define("core/utils/addComponentPlugins/addComponentPlugins",["core/utils/addComponentPlugins/plugins/page","core/utils/addComponentPlugins/plugins/anchor","core/utils/addComponentPlugins/plugins/documentMedia","core/utils/addComponentPlugins/plugins/audioPlayer","core/utils/addComponentPlugins/plugins/singleAudioPlayer","core/utils/addComponentPlugins/plugins/contactForm","core/utils/addComponentPlugins/plugins/clipArt","core/utils/addComponentPlugins/plugins/svgShape","core/utils/addComponentPlugins/plugins/wPhoto","core/utils/addComponentPlugins/plugins/verticalAnchorsMenu","core/utils/addComponentPlugins/plugins/stripContainer","core/utils/addComponentPlugins/plugins/appControllerAddPlugin","core/utils/addComponentPlugins/plugins/vectorImageBefore","core/utils/addComponentPlugins/plugins/vectorImageAfter","core/utils/addComponentPlugins/plugins/wTwitterTweet"],function(t,e,i,n,o,r,s,a,u,c,l,p,d,g,m){"use strict";return{before:{"mobile.core.components.Page":t,"wysiwyg.common.components.anchor.viewer.Anchor":e,"wysiwyg.viewer.components.documentmedia.DocumentMedia":i,"wysiwyg.viewer.components.AudioPlayer":n,"wysiwyg.common.components.singleaudioplayer.viewer.SingleAudioPlayer":o,"wysiwyg.viewer.components.ClipArt":s,"wysiwyg.viewer.components.ContactForm":r,"wysiwyg.viewer.components.DynamicContactForm":r,"wysiwyg.viewer.components.svgshape.SvgShape":a,"wysiwyg.viewer.components.WPhoto":u,"wysiwyg.viewer.components.StripContainer":l,"wysiwyg.common.components.verticalanchorsmenu.viewer.VerticalAnchorsMenu":c,"wysiwyg.viewer.components.WTwitterTweet":m,"wysiwyg.viewer.components.VectorImage":d},after:{"platform.components.AppController":p,"wysiwyg.viewer.components.VectorImage":g}}}),define("core/utils/addUtil",["core/utils/addComponentPlugins/addComponentPlugins","core/utils/updateDataPlugins/updateDataPlugins"],function(t,e){"use strict";return{addComponent:function(i,n,o,r,s,a,u){var c=r.componentType,l=r.data&&r.data.type;if(e[l]&&(r.data=e[l](r.data)),t.before[c]){var p=t.before[c](i,n,o,r,s,a);if(p)return p}var d=n(o,r,s);return i.documentServices.waitForChangesApplied(function(){a&&a(d),t.after[c]&&t.after[c](i,d,u)}),d},componentsWithPlugins:Object.keys(t)}}),define("core/bi/bi",["coreBi"],function(t){"use strict";return{events:t.events,errors:t.errors,registerEvents:t.registerEvents}}),define("core/utils/scrollUtils",["lodash"],function(t){"use strict";function e(){return window.document.getElementById("scrollableEditorStage")}return{getScroll:function(){var i=e();return t.pick(i,["scrollLeft","scrollTop","scrollHeight","scrollWidth"])},setScroll:function(i){var n=e();t.isUndefined(i.scrollTop)||(n.scrollTop=i.scrollTop),t.isUndefined(i.scrollLeft)||(n.scrollLeft=i.scrollLeft)}}}),define("core/utils/stageUtils",["lodash","uiConstants","core/utils/scrollUtils"],function(t,e,i){"use strict";var n={top:e.VIEWPORT_VERTICAL_MARGINS,bottom:e.VIEWPORT_VERTICAL_MARGINS,left:72,right:60},o={getViewPort:function(t,e){var r=o.getStageLayout();if(!r)return null;var s=i.getScroll(),a={y:n.top,minY:n.top,bottomY:r.height-n.bottom,maxBottomY:s.scrollHeight-n.bottom,marginBottom:n.bottom,x:n.left,rightX:r.width-n.right,height:r.height-(n.top+n.bottom),width:r.width-(n.left+n.right),scrollTop:s.scrollTop,scrollLeft:s.scrollLeft,stageLayout:r};t&&(a.y+=s.scrollTop,a.bottomY+=s.scrollTop,a.x+=s.scrollLeft,a.rightX+=s.scrollLeft);var u=e&&e.right+10;if(u&&u>a.x){var c=u-a.x;a.x=u,a.width-=c}return a},getStageLayout:function(){var t=window.document.getElementById("stageContainer");return t?t.getBoundingClientRect():{x:0,y:0,width:0,height:0}},getStageRect:function(){var t=o.getStageLayout(),e=i.getScroll();return{top:e.scrollTop,bottom:e.scrollTop+t.height,left:e.scrollLeft,right:e.scrollLeft+t.width}}};return o}),define("core/utils/AttachHandler",["lodash"],function(t){"use strict";function e(t,e){return t.components.layout.getRelativeToScreenConsideringScroll(e)}function i(i,n,o){var r=i.documentServices.siteSegments.getHeader(),s=i.documentServices.pages.getFocusedPageId(),a=i.components.getAllComponents(s);(function(t){return t.isMobileEditor()})(i,n.comp)&&(a=a.concat(i.documentServices.siteSegments.getSiteStructure()));return o===l.COMP&&(!i.components.isShowOnAllPages(n.comp)||i.siteSegments.isUsingSectionsLayout()&&function(t,e){var i=t.siteSegments.getSiteStructure();return t.utils.isSameRef(t.components.getContainer(e),i)}(i,n.comp))&&(a=function(e,i){var n=e.documentServices.siteSegments.getFooter();return t.filter(i,function(t){var i=e.components.isDescendantOfComp(t,n);return!e.utils.isSameRef(t,n)&&!i})}(i,a)),t(a).filter(function(t){return!i.utils.isSameRef(t,n.comp)&&p[o].isContainable(i,n.comp,t)}).filter(function(t){return i.components.isRenderedOnSite(t)}).map(function(t){return{layout:e(i,t),comp:t}}).filter(function(t){var e=i.utils.isSameRef(t.comp,r);return t.layout.width>=n.layout.width&&(e||t.layout.height>=n.layout.height)}).value()}function n(t,e,i,n){var o=t.components.is.fullWidth(e),r=t.utils.isSameRef(e,t.documentServices.siteSegments.getHeader());return(o||i.x>=n.x)&&(o||i.x+i.width<=n.x+n.width)&&(r||i.y>=n.y)&&i.y+i.height<=n.y+n.height}function o(e,i){var o=i.layout,r=i.comp,s=e.layout,a=p[this.type].getContainer(this.editorAPI,this.comp);return!(t.isEmpty(a)&&this.editorAPI.utils.isSiteStructure(r))&&!function(e,i,n){return!t.isEmpty(i)&&e.utils.isSiteStructure(i)&&e.utils.isPage(n)}(this.editorAPI,a,r)&&!function(e,i,n){return!t.isEmpty(i)&&!e.components.isShowOnAllPages(i)&&e.utils.isSiteStructure(n)}(this.editorAPI,a,r)&&!function(e,i,n){return!t.isEmpty(i)&&!e.components.isShowOnAllPages(i)&&"wysiwyg.viewer.components.FooterContainer"===e.components.getType(n)}(this.editorAPI,a,r)&&!this.editorAPI.utils.isSameRef(a,r)&&n(this.editorAPI,i.comp,s,o)}function r(t,e){return!(t.x>=e.x+e.width||e.x>=t.x+t.width||t.y>=e.y+e.height||e.y>=t.y+t.height)}function s(s,a){t.has(this,"attachCandidates")||(this.attachCandidates=i(this.editorAPI,this.initialCompWithLayout,this.type));var u=t.find(this.attachCandidates,t.bind(function(t){return t.layout=function(t,i,n){return t.components.is.repeatedComponent(n)?e(t,i.comp):i.layout}(this.editorAPI,t,this.comp),a?n(this.editorAPI,t.comp,s,t.layout):r(s,t.layout)},this));return u&&o.call(this,{layout:s},u)?u.comp:null}function a(e,i){var n=e||p[this.type].getCompLayout(this.editorAPI,this.comp),o=function(e){var i=p[this.type].getContainer(this.editorAPI,this.comp);return!(!t.isEmpty(i)&&p[this.type].getCompLayout&&r(e,p[this.type].getCompLayout(this.editorAPI,i)))}.call(this,n),a=s.call(this,n,o),u=t.find(i,t.isEqual.bind(t,a));return a&&!u?a:function(t,e,i,n){var o=p[n].getContainer(t,i);return!t.utils.isPage(o)&&(t.isMobileEditor()?e&&!p[n].isShowOnAllPages(t,i):e)}(this.editorAPI,o,this.comp,this.type)?this.editorAPI.pages.getFocusedPage():null}function u(e){(e=function(e,i,n){var o=void 0,r=e.documentServices.pages.popupPages.getCurrentPopupId();if(r)if(n){if(n.id===r)return null}else if(o=e.pages.popupPages.getPopupContainer(),t.find(i,["comp.id",o.id]))return o;return n}(this.editorAPI,this.attachCandidates,e))&&this.editorAPI.utils.isSiteStructure(e)||this.editorAPI.setAttachCandidate(e,this.type===l.STRUCTURE)}function c(t,e,n){t&&(this.editorAPI=t,this.type=n,this.initialCompWithLayout=e,this.comp=e.comp,this.attachCandidates=i(t,e,n))}var l={COMP:"comp",STRUCTURE:"structure"},p={comp:{getContainer:function(t,e){return t.components.getContainer(e)},isContainable:function(t,e,i){return t.components.is.containable(e,i)&&!t.components.is.group(i)},getCompLayout:function(t,e){return t.components.layout.getRelativeToScreenConsideringScroll(e).bounding},getCompType:function(t,e){return t.components.getType(e)},isShowOnAllPages:function(t,e){return t.components.isShowOnAllPages(e)}},structure:{getCompType:function(){return""},getContainer:function(){return{}},isContainable:function(t,e,i){return t.components.is.containableByStructure(e,i)&&!t.components.is.group(i)},isShowOnAllPages:function(){return!1}}};return c.prototype={getCurrentAttachCandidate:a,highlightAttachCandidate:u,clearHighlightAttachCandidate:function(t){this.editorAPI.setAttachCandidate(null,!!t)}},c.TYPES=l,c}),define("core/utils/mouseCoordinatesHandler",["core/utils/stageUtils","lodash"],function(t,e){"use strict";return{fitMouseCoordinatesToViewer:function(i,n){var o=i.getSiteScale(),r=t.getStageLayout(),s=r.width*(1-o)/2,a=i.ui.scroll.getScroll(),u=e.pick(n,["pageX","pageY","clientX","clientY"]);u.originalPageX=u.pageX,u.originalPageY=u.pageY,u.originalClientX=u.clientX,u.originalClientY=u.clientY,u.pageX+=a.scrollLeft,u.pageY+=a.scrollTop;var c=i.getPreviewPosition();return u.clientX-=c.left,u.clientY-=c.top,u.pageX-=c.left,u.pageY-=c.top,o&&1!==o&&function(t,e,i){return e>=t.left&&e<=t.right&&i>=t.top&&i<=t.bottom}(r,u.clientX,u.clientY)&&(u.pageX=(u.pageX-s)/o,u.pageY/=o,u.clientX=(u.clientX-s)/o,u.clientY/=o),u}}}),define("core/utils/mediaManagerPresetUtil",["lodash"],function(t){"use strict";function e(i){var n=t.get(i,"data",{});switch(n.type){case"VectorImage":return n.svgId;case"Image":return n.uri;case"WixVideo":return(n=t.get(i,"design",{})).videoId||"";case"BackgroundMedia":return n=t.get(i,"design",{}),e(n.mediaRef)||"";default:return""}}return{getIdByDataType:e,storePath:function(t,e,i){i&&t.getUserPreferences().session.set("last_media_path_"+e,i)},getPath:function(t,e){return t.getUserPreferences().session.get("last_media_path_"+e)||""}}}),define("core/utils/gridLinesUtil",[],function(){"use strict";return{getPageGridLines:function(t,e){return function(t,e){var i=t.y+t.height,n=t.x+t.width,o={x1:t.x,y1:0,x2:t.x,y2:"100%"},r={x1:n,y1:0,x2:n,y2:"100%"},s={x1:0,y1:t.y,x2:"100%",y2:t.y};return e?[o,r]:[o,r,s,{x1:0,y1:i,x2:"100%",y2:i}]}(function(t){var e=t.siteSegments.getPagesContainerAbsLayout(),i=t.getSiteScale();if(!i||1===i)return e;var n={y:e.y*i,width:e.width*i,height:e.height*i},o=e.width-n.width;return n.x=e.x+o/2,n}(t),e)},getContainerGridLines:function(t,e){"wysiwyg.viewer.components.StripColumnsContainer"===t.components.getType(e)&&(e=t.components.getChildren(e)[0]);var i=t.components.layout.getCompMargin(e),n=t.components.layout.getRelativeToScreen(e),o=n.y+n.height,r=n.x+i.left,s=n.x+n.width-i.right;return[{x1:r,y1:n.y,x2:r,y2:o},{x1:s,y1:n.y,x2:s,y2:o}]}}}),define("core/utils/SnapToHandler",["lodash","core/utils/stageUtils","core/utils/gridLinesUtil"],function(t,e,i){"use strict";function n(e,i,n,o){return i||t.isEqual(n,e)||t.isEqual(o,e)}function o(t,e,i,o,r){var s=n(e,i,o,r);return t.components.layout.getRelativeToScreen(e,s).bounding}function r(t,e){return e&&t.components.is.page(e)}function s(n,s){var a=n.documentServices.siteSegments.getHeader(),u=n.documentServices.siteSegments.getFooter();return t(s).map(function(e){var i=r(n,e);return{layout:o(n,e,i,a,u),isDynamicLayout:function(e,i,n,o){return n||t.isEqual(o,i)||e.components.isDescendantOfComp(i,o)}(n,e,i,u),comp:e}}).concat(function(i){if(!i.rulers.isRulersEnabled())return[];var n=function(i){var n=i.rulers.getHorizontalGuides(),o=e.getStageRect();return t.map(n,function(t){return{id:t.guideId,x:o.left,y:t.guidePosition,height:0,width:o.right}})}(i);return n=n.concat(function(i){var n=i.rulers.getVerticalGuides(),o=e.getStageRect();return t.map(n,function(t){var e=i.rulers.getVerticalGuideRealPosition(t.guidePosition);return{id:t.guideId,x:e,y:o.top,height:o.bottom,width:0}})}(i)),t.map(n,function(t){return{layout:t,isDynamicLayout:!1}})}(n)).concat(function(e){var n=e.selection.getFocusedContainer();if(!n||!e.components.is.showMarginsIndicator(n))return[];return t(n).thru(i.getContainerGridLines.bind(null,e)).map(function(t){return{layout:{x:t.x1,y:t.y1,height:t.y2-t.y1,width:0},isDynamicLayout:!1}}).value()}(n)).value()}function a(t){var e=t.layout;return this.right>=e.x&&e.x+e.width>=this.left&&this.bottom>=e.y&&e.y+e.height>=this.top}function u(i){return t.filter(i,t.bind(a,e.getStageRect()))}function c(e,i,o){var s=e.documentServices.siteSegments.getHeader(),a=e.documentServices.siteSegments.getFooter();return t.filter(o,function(t){var o=t.comp,u=r(e,o),c=t.layout;return!n(o,u,s,a)&&(i===c.y||i===c.y+c.height)})}function l(e,i,o){var s=e.documentServices.siteSegments.getHeader(),a=e.documentServices.siteSegments.getFooter();return t.filter(o,function(t){var o=t.comp,u=r(e,o),c=t.layout;return!n(o,u,s,a)&&(i===c.x||i===c.x+c.width)})}function p(e,i){return t.map(i,function(i){return t(i.layout).pick(["x","y","width","height"]).assign({isOnMasterPage:i.comp&&(e.components.isShowOnAllPages(i.comp)||e.components.isShowOnSomePages(i.comp))}).value()})}function d(e,i,n,o,r){var s=t.map(o,"layout"),a=[n].concat(s),u=function(e){return t.minBy(e,"x")}(a.concat(r)),c=function(e){return t.maxBy(e,function(t){return t.x+t.width})}(a.concat(r)),l=p(e,o);return{line:[{x:u.x,y:i},{x:c.x+c.width,y:i}],rectanglesDrawData:l}}function g(e,i,n,o,r){var s=t.map(o,"layout"),a=[n].concat(s),u=function(e){return t.minBy(e,"y")}(a.concat(r)),c=function(e){return t.maxBy(e,function(t){return t.y+t.height})}(a.concat(r)),l=p(e,o);return{line:[{x:i,y:u.y},{x:i,y:c.y+c.height}],rectanglesDrawData:l}}function m(e,i){var n=e.documentServices.pages.getFocusedPageId();return e.components.getAllComponents(n,function(e,i,n){return!(e.selection.isComponentSelected(n)||e.components.is.groupedComponent(n)||t.includes(P,n.id)||!e.components.isRenderedOnSite(n)||e.components.layout.isRenderedInFixedPosition(n)||i&&e.components.isAscendantOfComp(i,n))}.bind(null,e,i))}function h(t,e){t&&(this.editorAPI=t,this.compRefs=e)}function f(n,o){var r=function(n){var o=e.getStageRect().right;return t(n).thru(i.getPageGridLines).filter({x2:"100%"}).map(function(t){return{x:t.x1,y:t.y1,width:o}}).value()}(n);return t.filter(r,{y:o})}function y(n,o){var r=function(n){var o=e.getStageRect().bottom;return t(n).thru(i.getPageGridLines).filter({y2:"100%"}).map(function(t){return{x:t.x1,y:t.y1,height:o}}).value()}(n);return t.filter(r,{x:o})}var P=["SITE_PAGES","PAGES_CONTAINER"];return h.prototype.getSnapCandidates=function(){if(!t.has(this,"snapCandidates")){var e=m(this.editorAPI,this.compRefs);this.snapCandidates=s(this.editorAPI,e),this.compRefs=null}return this.snapCandidates},h.prototype.getClosestLayoutDistance=function(e,i,s){var a=this.getSnapCandidates();!function(e,i){t.forEach(i,function(t){t.layout=t.isDynamicLayout?o(e,t.comp):t.layout})}(e,a);var c=u(a);return{x:function(e,i,o,s){var a=e.documentServices.siteSegments.getHeader(),u=e.documentServices.siteSegments.getFooter(),c=t.reduce(o,function(t,o){var c=o.layout,l=o.comp;return n(l,r(e,l),a,u)||(s.left&&(t.push(c.x-i.x),t.push(c.x+c.width-i.x)),s.right&&(t.push(c.x-(i.x+i.width)),t.push(c.x+c.width-(i.x+i.width)))),s.centerX&&t.push((c.x+(c.x+c.width))/2-(i.x+(i.x+i.width))/2),t},[]),l=function(t,e,i){var n=t.siteSegments.getPagesContainerAbsLayout(),o=[];return i.left&&(o.push(n.x-e.x),o.push(n.x+n.width-e.x)),i.right&&(o.push(n.x-(e.x+e.width)),o.push(n.x+n.width-(e.x+e.width))),o}(e,i,s);return t.minBy(c.concat(l),function(t){return Math.abs(t)})}(e,i,c,s),y:function(e,i,o,s){var a=e.documentServices.siteSegments.getHeader(),u=e.documentServices.siteSegments.getFooter(),c=t.reduce(o,function(t,o){var c=o.layout,l=o.comp;return n(l,r(e,l),a,u)||(s.top&&(t.push(c.y-i.y),t.push(c.y+c.height-i.y)),s.bottom&&(t.push(c.y-(i.y+i.height)),t.push(c.y+c.height-(i.y+i.height)))),s.centerY&&t.push((c.y+(c.y+c.height))/2-(i.y+(i.y+i.height))/2),t},[]),l=function(t,e,i){var n=t.siteSegments.getPagesContainerAbsLayout(),o=[];return i.top&&(o.push(n.y-e.y),o.push(n.y+n.height-e.y)),i.bottom&&(o.push(n.y-(e.y+e.height)),o.push(n.y+n.height-(e.y+e.height))),o}(e,i,s);return t.minBy(c.concat(l),function(t){return Math.abs(t)})}(e,i,c,s)}},h.prototype.getSnapData=function(e,i){var n=[],o=u(this.getSnapCandidates()),r=[],s=[],a=i.centerY&&function(e,i){return t.filter(i,function(t){var i=t.layout;return e===(i.y+(i.y+i.height))/2})}((e.y+e.y+e.height)/2,o);if(a&&a.length>0)n.push(d(this.editorAPI,(e.y+e.y+e.height)/2,e,a,r));else{var p=[];if(i.top&&(p=c(this.editorAPI,e.y,o),r=f(this.editorAPI,e.y),(p.length>0||r.length>0)&&n.push(d(this.editorAPI,e.y,e,p,r))),i.bottom){var m=e.y+e.height;p=c(this.editorAPI,m,o),r=f(this.editorAPI,m),(p.length>0||r.length>0)&&n.push(d(this.editorAPI,m,e,p,r))}}var h=i.centerX&&function(e,i){return t.filter(i,function(t){var i=t.layout;return e===(i.x+(i.x+i.width))/2})}((e.x+e.x+e.width)/2,o);if(h&&h.length>0)n.push(g(this.editorAPI,(e.x+e.x+e.width)/2,e,h,s));else{var P=[];if(i.right){var v=e.x+e.width;P=l(this.editorAPI,v,o),s=y(this.editorAPI,v),(P.length>0||s.length>0)&&n.push(g(this.editorAPI,v,e,P,s))}i.left&&(P=l(this.editorAPI,e.x,o),s=y(this.editorAPI,e.x),(P.length>0||s.length>0)&&n.push(g(this.editorAPI,e.x,e,P,s)))}return n},h}),define("core/utils/AddPanelDragHandler",["lodash","jquery","experiment","constants","core/bi/bi","core/utils/stageUtils","core/utils/AttachHandler","core/utils/mouseCoordinatesHandler","core/utils/mediaManagerPresetUtil","core/utils/SnapToHandler"],function(t,e,i,n,o,r,s,a,u,c){"use strict";function l(e,s,a,u,c,l,g){e&&(this.editorAPI=e,this.initialEvent=s,this.item=a,this.panelElm=u,this.dragBoxClass=c,this.onItemDragStart=l,this.onItemDragEnd=g,this.isFirstDragEvent=!0,this.originalDragPosition={x:this.initialEvent.pageX,y:this.initialEvent.pageY},this.item.onDrop=this.item.onDrop||function(e,r,s,a){t.assign(s.structure.layout,r),e.components.add(a,s.structure,void 0,function(r){if(!t.isEmpty(e.components.modes.getModes(a))&&r.id){var u=e.components.modes.getComponentActiveModeIds(a);e.components.modes.showComponentOnlyInModesCombination(r,t.keys(u)),e.tabIndicationState.activateAddAnimation(!0),e.components.modes.addDefaultSingleModeAnimations(r)}"Page"!==s.structure.type&&e.history.add("component dragged to stage from add panel");var c=e.components.getType(a),l=e.components.is.repeatedComponent(a);if(e.selection.selectComponentByCompRef(r),e.openFirstTimePanel(r),e.bi.event(o.events.addPanel.COMPONENT_ADDED_TO_STAGE,{origin:"add_panel",category:s.categoryId,section:s.sectionTitle,component_type:s.structure.componentType,component_id:r.id,preset_id:s.itemId||"",adding_method:"drag",preset_data_skin:s.structure.style.skin||s.structure.skin||s.structure.style,preset_data_tags:s.tags||"",page_id:e.pages.getFocusedPage()&&e.pages.getFocusedPage().id,target_component:c,is_target_repeated:l}),e.openCompOutOfGridPanelIfNeeded(r),i.isOpen("se_santaMembers")&&s.appDefinitionId){var p=e.documentServices.platform.getAppDataByAppDefId(s.appDefinitionId);e.documentServices.platform.notifyApplication(p.applicationId,{eventType:n.EVENTS.ADD_PANEL.COMPONENT_ADDED_TO_STAGE,eventPayload:{compRef:r}})}})}.bind(null,this.editorAPI),this.stageLayout=r.getStageLayout(),this.editorAPI.components.is.fullWidthByStructure(this.item.structure)?(this.isFullWidth=!0,this.allowedSnapDirections=d):(this.allowedSnapDirections=p,this.isFullWidth=!1),this.init())}var p={top:!0,bottom:!0,left:!0,right:!0,centerX:!0,centerY:!0},d={top:!0,bottom:!0,left:!1,right:!1,centerX:!1,centerY:!0},g=8;return l.prototype={init:function(){this.snapToHandler=new c(this.editorAPI),this.attachHandler=new s(this.editorAPI,{comp:this.item.structure,layout:t.pick(this.item.structure.layout,["width","height"])},s.TYPES.STRUCTURE)},getFixedDragPosition:function(t){return{x:t.clientX,y:t.clientY}},onDrag:function(t){var e=a.fitMouseCoordinatesToViewer(this.editorAPI,t);if(this.isFirstDragEvent){if(!function(t,e){return Math.abs(e.x-t.pageX)>=g||Math.abs(e.y-t.pageY)>=g}(e,this.originalDragPosition))return;this.onInitialDrag(),this.isFirstDragEvent=!1}this.lastDragPosition={x:e.pageX,y:e.pageY},this.lastDragFixedPosition=this.getFixedDragPosition(t);var i=this.isInPanelArea();i?this.handleDragInPanelArea():this.handleDragOutsidePanelArea(t),this.setDragBox(i)},onInitialDrag:function(){t.isFunction(this.onItemDragStart)&&this.onItemDragStart()},isInPanelArea:function(){var t=this.getPanelClientRect();return this.lastDragFixedPosition.x>=t.left&&this.lastDragFixedPosition.x<=t.right&&this.lastDragFixedPosition.y>=t.top&&this.lastDragFixedPosition.y<=t.bottom},getPanelClientRect:function(){return this._panelClientRect||(this._panelClientRect=this.panelElm.getBoundingClientRect()),this._panelClientRect},handleDragOutsidePanelArea:function(){var t=this.getDragBoxStageLayout(),e=this.getDragBoxStageLayout(!0),i=void 0;"popup"!==this.item.categoryId&&(this.snapDragBoxToCompIfNeeded(t),i=this.attachHandler.getCurrentAttachCandidate(e),this.attachHandler.highlightAttachCandidate(i||this.editorAPI.pages.getFocusedPage()))},handleDragInPanelArea:function(){this.editorAPI.snapData.clear(!0),this.attachHandler.clearHighlightAttachCandidate(!0)},getDragBoxStageLayout:function(t){var e={x:this.lastDragPosition.x+this.getBoxOffset().left*this.item.structure.layout.width,y:this.lastDragPosition.y+this.getBoxOffset().top*this.item.structure.layout.height,width:this.item.structure.layout.width,height:this.item.structure.layout.height};if(t){var i=this.editorAPI.ui.scroll.getScroll();e.x-=i.scrollLeft,e.y-=i.scrollTop}return e},getBoxOffset:function(){if(!this._boxOffset){var t=this.getRectSize();this._boxOffset={left:(this.item.rect.left+e(window).scrollLeft()-this.originalDragPosition.x)/t.width,top:(this.item.rect.top+e(window).scrollTop()-this.originalDragPosition.y)/t.height}}return this._boxOffset},getRectSize:function(){return{width:this.item.rect.width,height:this.item.rect.height}},setDragBox:function(e){var i={key:"dragToStageDragBox",coords:{left:this.lastDragFixedPosition.x,top:this.lastDragFixedPosition.y},boxOffset:this.getBoxOffset()};if(e)i.boxSize=this.getRectSize();else if("popup"===this.item.categoryId)(i=function(e,i,n){var o=i.structure.components[0],r=o.layout,s=o.props.alignmentType,a=o.props.verticalAlignment,u=o.props.horizontalAlignment,c={fullHeight:function(){return{left:"left"===u?n.left:n.right-r.width,top:n.top,height:n.height,width:r.width}},fullWidth:function(){return{left:n.left,top:"bottom"===a?n.bottom-r.height:n.top,height:r.height,width:n.width}},nineGrid:function(){return{left:(n.width-r.width)/2,top:(n.height-r.height)/2,height:r.height,width:r.width}}}[s]();return e.coords=t.pick(c,["left","top"]),e.boxSize=t.pick(c,["height","width"]),e.boxOffset={left:0,top:0},e}(i,this.item,this.stageLayout)).boxSize.height*=this.editorAPI.getSiteScale();else{i.boxSize=t.pick(this.item.structure.layout,["width","height"]);var n=this.editorAPI.getSiteScale();i.boxSize.height*=n,this.isFullWidth&&(i=function(e,i,n){return e.boxOffset=t.assign({},e.boxOffset,{left:0}),e.coords.left=n.left,i&&(e.boxSize.width=i),e}(i,this.stageLayout.width,this.editorAPI.getPreviewPosition()))}var o={props:i,componentType:this.item.structure.componentType,reactClass:this.dragBoxClass};this.editorAPI.setPortalChildren("addPanel",[o])},snapDragBoxToCompIfNeeded:function(t){var e=this.snapToHandler.getClosestLayoutDistance(this.editorAPI,t,this.allowedSnapDirections);Math.abs(e.x)<=5&&(this.lastDragPosition.x+=e.x,this.lastDragFixedPosition.x+=e.x,t.x+=e.x),Math.abs(e.y)<=5&&(this.lastDragPosition.y+=e.y,this.lastDragFixedPosition.y+=e.y,t.y+=e.y);var i=this.snapToHandler.getSnapData(t,this.allowedSnapDirections);this.editorAPI.snapData.set(i,!0)},clearDrag:function(){this.editorAPI.snapData.clear(!0),this.attachHandler.clearHighlightAttachCandidate(!0)},endDrag:function(t){if(this.clearDrag(),this.editorAPI.setPortalChildren("addPanel",null),this.isFirstDragEvent)return!1;var e=a.fitMouseCoordinatesToViewer(this.editorAPI,t);return this.lastDragPosition={x:e.pageX,y:e.pageY},this.isInPanelArea()||this.onDrop(t),this.onItemDragEnd&&this.onItemDragEnd(),!0},getCompPositionRelativeToContainer:function(t,e){return{x:this.lastDragPosition.x-t.x-e.x+this.getBoxOffset().left*this.item.structure.layout.width,y:this.lastDragPosition.y-t.y-e.y+this.getBoxOffset().top*this.item.structure.layout.height}},onDrop:function(){var e=this.getDropContainer(this.getDragBoxStageLayout(!0)),n=this.editorAPI.components.layout.getRelativeToStructure(e),o=function(t){var e=t.documentServices.siteSegments.getPagesContainer();return{x:t.components.layout.getRelativeToScreen(e).x,y:0}}(this.editorAPI),r=this.getCompPositionRelativeToContainer(o,n);this.item.onDrop&&(t.defer(function(){i.isOpen("se_santaMembers")||i.isOpen("newBlogIntegration")?this.item.onDrop(r,this.item,e,this.editorAPI):this.item.onDrop(r,this.item,e)}.bind(this)),u.storePath(this.editorAPI,u.getIdByDataType(this.item.structure),t.get(this.item,["mediaManager","path"])))},getDropContainer:function(t){var e=this.attachHandler.getCurrentAttachCandidate(t);return e||(e=this.editorAPI.pages.getFocusedPage()),e}},l}),define("core/utils/layoutSymmetryUtil",["lodash"],function(t){"use strict";function e(e){return{horizontal:function(t){return Boolean(t.docked&&t.docked.hCenter||t.symmetry&&t.symmetry.horizontal)}(e)||function(e){var i=t.chain(e).get("docked.left.vw").isFinite().value(),n=t.chain(e).get("docked.right.vw").isFinite().value();return i&&n}(e),vertical:function(t){return Boolean(t.docked&&t.docked.vCenter||t.symmetry&&t.symmetry.vertical)}(e)}}return{getLayoutSymmetry:e}}),define("core/utils/layoutTransitionsUtil",["lodash","core/utils/layoutSymmetryUtil"],function(t,e){"use strict";function i(t,e){return Math.atan2(t.y-e.y,t.x-e.x)}function n(t,e,i){return 0===e?t:{x:(t.x-i.x)*Math.cos(e)-(t.y-i.y)*Math.sin(e)+i.x,y:(t.x-i.x)*Math.sin(e)+(t.y-i.y)*Math.cos(e)+i.y}}function o(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function r(e,i,n){if(!e)return null;var o=t.clone(e),r=n.x-i.x,s=n.y-i.y;return n.isShiftPressed&&(Math.abs(r)>=Math.abs(s)?s=0:r=0),o.x+=r,o.y+=s,o}function s(e,i,n){e&&(this.initLayout=e,this.boundCompsPositionRelativeToLayout=t.map(n,function(t){return{x:t.x-e.x,y:t.y-e.y}}),this.initMouseLocation=i,this.getLayout=r.bind(null,this.initLayout,this.initMouseLocation),this.getBoundComponentLayouts=function(e,i){return t.map(e,function(t){return{x:i.x+t.x,y:i.y+t.y}})}.bind(null,this.boundCompsPositionRelativeToLayout))}function a(t,e,i,n){var o=0,r=i?Math.floor(e/2):e;return 1===t?o=Math.max(-r,n):-1===t&&(o=Math.min(r,n)),o}function u(i,r,s,u,c){i&&(this.initLayout=i,this.initMouseLocation=r,this.direction=s,this.proportional=u,this.rotationInRad=l*i.rotationInDegrees,this.ratio=c||1,this.initLayoutAspectRatio=i.width/i.height,this.getCorrectXYAfterTransformOriginChange=function(e){var i=t.pick(e,["x","y"]);return i=n(i,-this.rotationInRad,o(e)),n(i,this.rotationInRad,o(this.initLayout))},this.getLayoutAfterProportionalHorizontalResize=function(e,i){var n=t.clone(e),o=void 0;this.direction.x===p.LEFT?(o=-Math.min(i.x,e.width),n.x-=o):this.direction.x===p.RIGHT&&(o=Math.max(i.x,-e.width)),n.width+=o,n.height=n.width/this.initLayoutAspectRatio;var r=n.height-this.initLayout.height;return n.y-=r/2,t.assign(n,this.getCorrectXYAfterTransformOriginChange(n)),n},this.getLayoutAfterProportionalVerticalResize=function(e,i){var n=t.clone(e),o=0;this.direction.y===p.TOP?(o=-Math.min(i.y,e.height),n.y-=o):this.direction.y===p.BOTTOM&&(o=Math.max(i.y,-e.height)),n.height+=o,n.width=n.height*this.initLayoutAspectRatio;var r=n.width-this.initLayout.width;return n.x-=r/2,t.assign(n,this.getCorrectXYAfterTransformOriginChange(n)),n},this.getLayoutAfterStandardResize=function(i,n){var o=e.getLayoutSymmetry(i);return this.direction.x&&(o.horizontal?function(t,e,i){var n=a(i,t.width,!0,e.x);1===i?(t.x-=n,t.width+=2*n):-1===i&&(t.x+=n,t.width-=2*n)}(i,n,this.direction.x):(n.x/=this.ratio,function(t,e,i){var n=a(i,t.width,!1,e.x);1===i?t.width+=n:-1===i&&(t.x+=n,t.width-=n)}(i,n,this.direction.x))),this.direction.y&&(o.vertical?function(t,e,i){var n=a(i,t.height,!0,e.y);1===i?(t.y-=n,t.height+=2*n):-1===i&&(t.y+=n,t.height-=2*n)}(i,n,this.direction.y):(n.y/=this.ratio,function(t,e,i){var n=a(i,t.height,!1,e.y);1===i?t.height+=n:-1===i&&(t.y+=n,t.height-=n)}(i,n,this.direction.y))),t.assign(i,this.getCorrectXYAfterTransformOriginChange(i)),this.direction.x||delete i.width,this.direction.y||delete i.height,i},this.getLayout=function(e){var i=t.cloneDeep(this.initLayout),o=void 0,r={x:e.x-this.initMouseLocation.x,y:e.y-this.initMouseLocation.y};return r=function(t,e){return n(t,e,{x:0,y:0})}(r,-this.rotationInRad),this.proportional?(!function(t){return t.y===p.NONE&&t.x!==p.NONE}(this.direction)?!function(t){return t.x===p.NONE&&t.y!==p.NONE}(this.direction)?(r=function(t,e,i){var n={x:i.x>0?e.x:e.x+e.width,y:i.y>0?e.y:e.y+e.height},o={x:i.x<0?e.x:e.x+e.width,y:i.y<0?e.y:e.y+e.height},r=(o.y-n.y)/(o.x-n.x),s=r,a=-1,u=n.y-r*n.x,c={x:o.x+t.x,y:o.y+t.y};return{x:(a*(a*c.x-s*c.y)-s*u)/(s*s+1)-o.x,y:(s*(s*c.y-a*c.x)-a*u)/(s*s+1)-o.y}}(r,i,this.direction),o=this.getLayoutAfterStandardResize(i,r)):o=this.getLayoutAfterProportionalVerticalResize(i,r):o=this.getLayoutAfterProportionalHorizontalResize(i,r),o=t.mapValues(o,Math.round)):o=this.getLayoutAfterStandardResize(i,r),o})}var c=180/Math.PI,l=1/c,p={TOP:-1,BOTTOM:1,LEFT:-1,RIGHT:1,NONE:0};return{Drag:s,Rotate:function(e,n,r){e&&(this.initLayout=e,this.initMouseLocation=n,this.center=o(r),this.initMouseAngle=i(this.initMouseLocation,this.center),this.getLayout=function(e){var n=t.clone(this.initLayout),o=i(e,this.center);return n.rotationInDegrees+=(o-this.initMouseAngle)*c,n})},Resize:u,dragLayout:r,resizeLayout:function(t,e,i,n,o){return t?new u(t,e,i,n).getLayout(o):null}}}),define("core/utils/compsSectionsAnalyzer",["lodash"],function(t){"use strict";function e(e,i){return t(i).reject(function(t){return e.components.layout.isPinned(t)}).map(function(t){var i=e.components.layout.get(t);return i.bounding&&(i=i.bounding),i.bottomY=i.y+i.height,{layout:i,comp:t}}).sortBy("layout.y").value()}function i(e,i){return t.filter(e,function(t){return function(t,e){var i=e?g:d;return t.layout.width>=i}(t,i)})}function n(e,i,n){return t.forEach(e,function(e){var o=function(t){return{y:t.position.top,bottomY:t.position.bottom,height:r(t)}}(e),s=t.filter(i,function(t){return function(t,e,i){i=i||1;var n=e.y>=t.y&&e.y<=t.bottomY,o=e.bottomY>=t.y&&e.bottomY<=t.bottomY,r=e.y<=t.y&&e.bottomY>=t.bottomY;return n&&t.bottomY-e.y>=e.height*i||o&&e.bottomY-t.y>=e.height*i||r&&t.height>=e.height*i}(o,t.layout,n)});i=t.difference(i,s),e.comps=t.union(e.comps,t.map(s,"comp"))}),e}function o(t,e){for(var i=[],n=0;n<t.length;n++){var o=t[n],r={position:{top:o.layout.y,bottom:o.layout.bottomY},comps:[]};r.position.top=o.layout.y,r.comps.push(o.comp);for(var s=!1;!s;){var a=t[n+1];!a||a.layout.y>r.position.bottom+e?s=!0:(r.comps.push(a.comp),r.position.bottom=Math.max(r.position.bottom,a.layout.bottomY),n++)}i.push(r)}return i}function r(t){return t.position.bottom-t.position.top}function s(t,e,i){var n=t[e],o=t[i];o.comps=o.comps.concat(n.comps),o.position.top=Math.min(o.position.top,n.position.top),o.position.bottom=Math.max(o.position.bottom,n.position.bottom),t.splice(e,1)}function a(t){for(var e=void 0,i=void 0,n=void 0,o=void 0,a=0;a<t.length;a++)if(o=!1,e=t[a],r(e)<m){n=t[a-1],i=t[a+1];var u=n?e.position.top-n.position.bottom:Number.POSITIVE_INFINITY,c=i?i.position.top-e.position.bottom:Number.POSITIVE_INFINITY;u<c&&u<=h?(s(t,a,a-1),o=!0):c<u&&c<=h&&(s(t,a,a+1),o=!0),o&&a--}return t}function u(t){for(var e=0;e<t.length;){t[e+1]&&t[e+1].position.top<=t[e].position.bottom+f?s(t,e+1,e):e++}return t}function c(t){return t.position.bottom<0}function l(e,i){return t.map(i,function(i){var n=t.some(i.comps,function(t){return!e.components.is.removable(t)});return i.isRemovable=!n,i})}function p(r,s){var p=e(r,r.components.getChildren(s)),d=i(p,r.isMobileEditor()),g=t.difference(p,d),m=o(d,f),h=o(g=function(e,i){var n=t(i).flatMap("comps").keyBy("id").value();return t.reject(e,function(t){return!!n[t.comp.id]})}(g,m=n(m,g,.5)),y);return t(m).union(h).sortBy("position.top").thru(a).thru(u).reject(c).thru(t.partial(l,r)).value()}var d=700,g=300,m=30,h=30,f=-3,y=30;return{analyzeContainer:p,getSortedComponentsWithLayout:e}}),define("core/utils/sectionsReorganizeUtil",["lodash","core/utils/compsSectionsAnalyzer"],function(t,e){"use strict";function i(t){return t.position.top}function n(t){return t.position.bottom-t.position.top}function o(e,i,n){t.forEach(i,function(t){var i=e.components.layout.get(t);e.components.layout.update(t,{y:i.y+n},!0)})}function r(e,i){var o=t.clone(e.position),r=t.clone(i.position),s=n(e),a=n(i),u=s-a;e.position.top=r.top-u,e.position.bottom=e.position.top+s,i.position.top=o.top,i.position.bottom=i.position.top+a}function s(e,i,n){var o=t.findIndex(e,i),r=t.findIndex(e,n);e[o]=n,e[r]=i}function a(t,e,i){e.position.top+=i,e.position.bottom+=i,e.comps&&o(t,e.comps,i)}function u(i,n){n=n||i.pages.getFocusedPage();var o=e.analyzeContainer(i,n),r=i.components.layout.getRelativeToScreen(n);return t.forEach(o,function(t){t.position.top+=r.y,t.position.bottom+=r.y}),i.isMobileEditor()?(o=t.union(function(i,n){var o=i.documentServices.siteSegments.getSiteStructure(n),r=i.documentServices.components.get.byType("wysiwyg.viewer.components.SiteRegionContainer",o)||[];if(!r.length)return[];var s=e.getSortedComponentsWithLayout(i,r);return t.map(s,function(t){return{position:{top:t.layout.y,bottom:t.layout.bottomY},comps:[t.comp],isStaticSection:!0}})}(i,"MOBILE"),o),t.sortBy(o,"position.top")):o}return{addSectionByPosition:function(e,i){var n=t.findIndex(e,function(t){return t.position.top>i.position.top});return n?e.splice(n,0,i):e.push(i),e},getSectionSizeForBI:function(t){return t>500?"large":t>61?"medium":"small"},getPageSections:u,getHeaderSection:function(t){var e=t.components.layout.getRelativeToScreen(t.documentServices.siteSegments.getHeader());return{position:{top:e.y,bottom:e.height}}},duplicateSection:function(t,e,i){for(var o=e[i],r=t.components.layout.getRelativeToStructure(o.comps),s=n(o),u=i+1;u<e.length;u++)a(t,e[u],s);var c=t.copyPaste.duplicate(o.comps);t.documentServices.waitForChangesApplied(function(){t.components.layout.updateRelativeToStructure(c,{x:r.x,y:o.position.bottom})})},deleteSection:function(t,e,i){for(var o=e[i],r=n(o),s=i+1;s<e.length;s++)a(t,e[s],-1*r);t.components.remove(o.comps)},shiftSection:a,switchSectionsByDrag:function(t,e,n,a){var u=void 0,c=void 0;n.position.top<a.position.top?(u=n,c=a):(u=a,c=n);var l=i(u),p=i(c);r(u,c),s(e,u,c),a===c?o(t,a.comps,i(c)-p):o(t,a.comps,i(u)-l)},switchSections:function(t,e,n,a){var u=i(n),c=i(a);r(n,a),s(e,n,a),o(t,a.comps,i(a)-c),o(t,n.comps,i(n)-u)},isAtSectionsSwitchPoint:function(t,e,i){var o=n(e),r=e.position.top+o/2;return 1===i?t.y+t.height>=r:t.y<=r}}}),define("core/utils/mouseMoveActions/sectionDrag",["lodash","core/utils/layoutTransitionsUtil","core/utils/sectionsReorganizeUtil","constants"],function(t,e,i,n){"use strict";function o(t,e){return t.clientY+m.ui.scroll.getScroll().scrollTop/(e||1)}function r(t){var e={x:0,y:t},i=v.getLayout(e);return i.y=Math.max(i.y,I),i}function s(e){for(var i=v.getBoundComponentLayouts(e),n=0;n<f.comps.length;n++)m.components.layout.updateRelativeToScreen(f.comps[n],t.pick(i[n],"y"),!0)}function a(e,n){var o=function(t){return t>y?1:-1}(e);y=e;var r=t.findIndex(h,f)+o;if(r>=h.length||r<0)return!1;var s=h[r];return!(!s||!i.isAtSectionsSwitchPoint(n,s,o))&&(i.switchSectionsByDrag(m,h,f,s),t.defer(c),!0)}function u(t,e){return e.position.top<t.position.bottom}function c(){var e=t.findIndex(h,f),n=h[e-1],o=h[e+1],r=0,s=0;if(o&&u(f,o)&&(s=f.position.bottom-o.position.top),n&&u(n,f)&&(s+=r=n.position.bottom-f.position.top),r&&i.shiftSection(m,f,r),s)for(var a=e+1;a<h.length;a++)i.shiftSection(m,h[a],s)}function l(i,n){if(T=!1,P=!0,m=i,f=n.draggedSection){var r={x:0,y:o(n.evt,m.getSiteScale())};y=r.y,h=t.sortBy(n.sections,"position.top"),S=n.onDragEnd,C=n.onDragStart,I=n.minY||0;var s={y:f.position.top,height:f.position.bottom-f.position.top},a=t.map(f.comps,function(t){return m.components.layout.getRelativeToScreen(t)});v=new e.Drag(s,r,a)}}function p(e){if(f)if(P)P=!1,function(){var e=t.map(f.comps,"id");t.isEmpty(e)||(m.documentServices.renderPlugins.setCompsToShowOnTop(e),m.documentServices.renderPlugins.setCompsToShowWithOpacity(e,.5)),t.isFunction(C)&&C(),window.setTimeout(function(){c(),T=!0},g)}();else if(T){var i=o(e,m.getSiteScale()),n=r(i);s(n),a(i,n)}}function d(e){var i=o(e);f&&!P&&(!function(t){var e=r({y:t,x:0});e.y=f.position.top,s(e)}(i),m.history.add("Dragged Components Section"),m.documentServices.renderPlugins.setCompsToShowOnTop(null),m.documentServices.renderPlugins.setCompsToShowWithOpacity(null)),t.isFunction(S)&&S(f)}var g=0,m=void 0,h=void 0,f=void 0,y=void 0,P=void 0,v=void 0,S=void 0,C=void 0,T=void 0,I=void 0;return{start:l,on:p,end:d,type:n.MOUSE_ACTION_TYPES.SECTION_DRAG}}),define("core/utils/AddPanelSectionDragHandler",["lodash","core/utils/AddPanelDragHandler","core/utils/mouseMoveActions/sectionDrag","core/utils/sectionsReorganizeUtil"],function(t,e,i,n){"use strict";function o(t,i,n,o,r,s,a){e.call(this,t,i,n,o,r,s,a)}return o.prototype=Object.create(e.prototype),o.prototype.constructor=o,t.assign(o.prototype,{init:t.noop,getFixedDragPosition:function(t){return{x:t.clientX,y:t.clientY}},handleDragOutsidePanelArea:function(t){var e=this.getDragBoxStageLayout();this.handleSectionDrag(t,e)},handleDragInPanelArea:function(){this.cancelSectionDragIfNeeded()},handleSectionDrag:function(t,e){this.isSectionDrag||(this.initSectionDrag(t,e),this.isSectionDrag=!0),this.draggedSection.layout.y=e.y,i.on(t)},initSectionDrag:function(e,o){this.draggedSection=function(e,i){var n=function(t){var e=t.pages.getFocusedPage();return t.components.layout.getRelativeToScreen(e)}(e),o=Math.max(n.y-i.y,0);return{origin:"addPanel",comps:[],layout:t.pick(i,["y","height"]),position:{top:i.y+o,bottom:i.y+i.height+o}}}(this.editorAPI,o);var r=n.getPageSections(this.editorAPI);r=n.addSectionByPosition(r,this.draggedSection),this.editorAPI.setPageSections(r,null),i.start(this.editorAPI,{sections:r,evt:e,draggedSection:this.draggedSection})},cancelSectionDragIfNeeded:function(){this.isSectionDrag&&(this.isSectionDrag=!1,this.editorAPI.history.add("sections reorganize"),this.editorAPI.history.undo(),this.editorAPI.clearPageSections())},clearDrag:function(){this.isSectionDrag&&this.editorAPI.clearPageSections()},getDropContainer:function(){return this.editorAPI.pages.getFocusedPage()},getCompPositionRelativeToContainer:function(t,i){var n=e.prototype.getCompPositionRelativeToContainer.call(this,t,i),o=this.draggedSection.position.top-this.draggedSection.layout.y;return n.y+=o,n}}),o}),define("core/utils/AttachHandlerExperimentAttachImprovements",["lodash"],function(t){"use strict";function e(e,i,n){var s=e.documentServices.siteSegments.getHeader(),a=e.documentServices.siteSegments.getFooter(),u=e.documentServices.pages.getFocusedPageId(),c=e.components.getAllComponents(u);(function(t){return t.isMobileEditor()})(e,i.comp)&&(c=c.concat(e.documentServices.siteSegments.getSiteStructure()));return n===o.COMP&&!e.components.isShowOnAllPages(i.comp)&&(c=function(e,i){var n=e.documentServices.siteSegments.getFooter();return t.filter(i,function(t){var i=e.components.isDescendantOfComp(t,n);return!e.utils.isSameRef(t,n)&&!i})}(e,c)),t(c).filter(function(t){return!e.components.layout.isRenderedInFixedPosition(t)&&!e.utils.isSameRef(t,i.comp)&&r[n].isContainable(e,i.comp,t)}).map(function(t){return{layout:function(t,e){return t.components.layout.getRelativeToScreen(e)}(e,t),comp:t}}).filter(function(t){return e.components.is.container(t.comp)}).filter(function(t){return e.components.isRenderedOnSite(t.comp)}).filter(function(t){var n=e.utils.isSameRef(t.comp,s),o=e.utils.isSameRef(t.comp,a);return t.layout.width>=i.layout.width&&t.layout.height>=i.layout.height||n||o}).value()}function i(e,i){var n=this.editorAPI.documentServices.siteSegments.getHeader(),o=this.editorAPI.documentServices.siteSegments.getFooter(),r=t.find(this.attachCandidates,t.bind(function(r){var s=this.editorAPI.utils.isSameRef(r.comp,n),a=this.editorAPI.utils.isSameRef(r.comp,o);return this.editorAPI.components.is.page(r.comp)||s||a||function(t){return this.currentAttachedContainer&&this.currentAttachedContainer.id===t.id}.call(this,r.comp)?function(e,i,n){var o=e.selection.getComponentsUnderClick(i);return t.some(o,function(t){return e.utils.isSameRef(t,n)})}(this.editorAPI,i,r.comp):function(t,e,i,n){var o=t.components.is.fullWidth(e),r=t.utils.isSameRef(e,t.documentServices.siteSegments.getHeader());return(o||i.x>=n.x)&&(o||i.x+i.width<=n.x+n.width)&&(r||i.y>=n.y)&&i.y+i.height<=n.y+n.height}(this.editorAPI,r.comp,e,r.layout)},this));return r?(this.currentAttachedContainer=r.comp,r.comp):null}function n(t,i,n){t&&(this.editorAPI=t,this.type=n,this.comp=i.comp,this.currentAttachedContainer=null,this.attachCandidates=e(t,i,n))}var o={COMP:"comp",STRUCTURE:"structure"},r={comp:{getContainer:function(t,e){return t.components.getContainer(e)},isContainable:function(t,e,i){return t.components.is.containable(e,i)&&!t.components.is.group(i)},getCompLayout:function(t,e){return t.components.layout.getRelativeToScreen(e).bounding},getCompType:function(t,e){return t.components.getType(e)},isShowOnAllPages:function(t,e){return t.components.isShowOnAllPages(e)}},structure:{getCompType:function(){return""},getContainer:function(){return{}},isContainable:function(t,e,i){return t.components.is.containableByStructure(e,i)&&!t.components.is.group(i)},isShowOnAllPages:function(){return!1}}};return n.prototype.getCurrentAttachCandidate=function(t,e){var n=t||r[this.type].getCompLayout(this.editorAPI,this.comp);return i.call(this,n,e)||null},n.prototype.highlightAttachCandidate=function(t){t&&this.editorAPI.utils.isSiteStructure(t)||this.editorAPI.setAttachCandidate(t,this.type===o.STRUCTURE)},n.TYPES=o,n}),define("core/utils/updateDataUtil",["lodash","core/utils/updateDataPlugins/updateDataPlugins"],function(t,e){"use strict";function i(n){return e[n.type]&&e[n.type](n),t.forEach(n,function(e){t.isPlainObject(e)&&e.type&&i(e)}),n}return{fixData:i}}),define("core/utils/updatePropertiesPlugins/plugins/wPhotoPropertiesPlugin",["lodash"],function(t){"use strict";return function(e,i,n,o){return o||function(e,i,n){var o=t.pick(e,"effectName");if(!t.isEmpty(o)){var r=n.viewMode.VIEW_MODES.MOBILE,s=n.components.getPage(i).id,a=n.components.get.byId(i.id,s,r);a&&n.components.is.exist(a)&&n.components.properties.mobile.isForked(a)&&n.components.properties.update(a,o)}}(e,i,n),e}}),define("core/utils/updatePropertiesPlugins/updatePropertiesPlugins",["core/utils/updatePropertiesPlugins/plugins/wPhotoPropertiesPlugin"],function(t){"use strict";return{WPhotoProperties:t}}),define("core/utils/updatePropertiesUtil",["lodash","core/utils/updatePropertiesPlugins/updatePropertiesPlugins"],function(t,e){"use strict";return{fixProperties:function(t,i,n,o){var r=t.type||"DefaultProperties";return e[r]&&e[r](t,i,n,o),t}}}),define("core/utils/DragConstraintsHandler",["lodash","core/utils/layoutConstraintsUtil/EditorLayoutConstraintsUtil"],function(t,e){"use strict";function i(t,i){if(t){this.editorAPI=t,this.comp=i;var n=new e(t,i);this.constraintArea=n.getConstraintArea(t,i)}}return i.prototype.highlightDragConstraints=function(){this.editorAPI.setConstraintArea(this.constraintArea)},i.prototype.removeHighlightDragConstraints=function(){this.editorAPI.setConstraintArea(null)},i}),define("core/utils/compControlsMeasurer",["lodash","jquery","uiConstants"],function(t,e,i){"use strict";function n(t){return{y:t.y,x:t.x,width:t.width,height:t.height,bottomY:t.y+t.height,rightX:t.x+t.width}}function o(t,e){var i=e.viewPortForChildOfFocused||e.viewPort;return t.y>=i.y?P.COMP_TOP:t.bottomY<=i.bottomY?P.COMP_BOTTOM:P.VIEWPORT_TOP}function r(t,i,n){var o=i.viewPort,r=o.bottomY-t.y,s=t.bottomY-o.y,a=n?e(n).height():0,u=t.y<o.y,c=a<=r,l=t.bottomY>o.bottomY,p=a<=s,d=a<=o.bottomY-o.y;return u||!d?P.VIEWPORT_TOP:c?P.COMP_TOP:l?P.VIEWPORT_BOTTOM:p?P.COMP_BOTTOM:P.VIEWPORT_TOP}function s(t,e,i){return{gfpp:o(t,e),compPanel:r(t,e,i)}}function a(t,e,i,n,o){var r=Math.max(f,o&&o.top||0)+n,s=n+f,a=Math.max(f,o&&o.bottom||0);switch(t){case P.COMP_TOP:return Math.max(e.y-r,i.y-s);case P.COMP_BOTTOM:return e.bottomY+a;case P.VIEWPORT_TOP:return i.y-s}}function u(t,e,i,n){switch(t){case P.COMP_BOTTOM:return e.bottomY-n;case P.COMP_TOP:return e.y;case P.VIEWPORT_BOTTOM:return i.bottomY-n}return i.y}function c(t,e,i,n,o){if(h(e,i.width)){return Math.max(o,i.x)}switch(t){case P.COMP_LEFT:return e.x;case P.VIEWPORT_LEFT:return i.x;case P.VIEWPORT_RIGHT:return i.rightX-n}}function l(t,i,n,o,s){var l=s.gfppSize,p=s.viewPort,d=s.rotateKnobMargins,g=s.pageXBoundary,m=s.alignToPageBoundaries,v={gfpp:{top:0,left:0},compPanel:{top:0,left:0}},S=l.height,C=l.width,T=o?e(o).height():0,I=o?e(o).width():0;if(v.gfpp.top=a(t.gfpp,n,p,S,d),v.gfpp.left=c(i.gfpp,n,p,C,g),m||h(n,p.width)){var x=Math.max(g,p.x),A=function(t,i,n,o,s,a,c){var l={left:0,top:0},p=n?e(n).height():0,d=n?e(n).width():0;if(0===d||0===p)return{left:0,top:0};var g=u(r(t,{viewPort:i},n),t,i,p),m=d<=s-i.x,h=p<=i.bottomY-c,v=a===P.COMP_TOP&&p<=c-i.y-y,S=a===P.COMP_BOTTOM&&p<=i.bottomY-(c+o)-y;m?(l.left=s-(d+y/2),l.top=h?c:i.bottomY-p):v?(l.left=s,l.top=c-(p+f)):S?(l.left=s,l.top=c+o+f):(l.left=i.rightX-d,l.top=g);return l}(n,p,o,l.height,x,t.gfpp,v.gfpp.top);v.compPanel=A}else v.compPanel.top=u(t.compPanel,n,p,T),v.compPanel.left=function(t,e,i,n,o,r,s){var a=e.rightX-e.x;switch(t){case P.COMP_LEFT:return e.x-n-Math.max(y,s&&s.left||0);case P.COMP_RIGHT:return e.x+a+Math.max(y,s&&s.right||0);case P.VIEWPORT_LEFT:return i.x;case P.VIEWPORT_RIGHT:return i.rightX-n-y;case P.GFPP_LEFT:return r-n-y;case P.GFPP_RIGHT:return r+o+y}}(i.compPanel,n,p,I,C,v.gfpp.left,d);return v}function p(t,e,i){return t.x>=e.x?i+t.x<=e.rightX?P.COMP_LEFT:P.VIEWPORT_RIGHT:P.VIEWPORT_LEFT}function d(t,e,n){var o={},r=function(t){var e=t.x+i.CUSTOM_GFPP_POS.X_OFFSET_FROM_CLICK,n=t.y;return{y:n,x:e,width:0,height:0,bottomY:n,rightX:e}}(t),u=s(r,{viewPort:e}).gfpp,l=p(r,e,n.width);return o.top=a(u,r,e,n.height),o.left=c(l,r,e,n.width,0),o}function g(t,n,o,r){var s=r.gfppSize,a=r.viewPort,u=r.navControlsSize,c=s.width,l=o?e(o).width():0,d=t.rightX-t.x,g={},m=void 0,h=void 0;return g.gfpp=p(t,a,c),g.navControls=function(t,e,n){return t.x>=e.x?n+t.x+i.NAVIGATION_CONTROLS_POS.LEFT<=e.rightX?P.COMP_LEFT:P.VIEWPORT_RIGHT:P.VIEWPORT_LEFT}(t,a,u.width),n.gfpp===n.compPanel?(m=t.rightX+l+y<=a.rightX,h=t.x-l-y>=a.x,t.rightX<a.x?g.compPanel=P.VIEWPORT_LEFT:g.compPanel=m?P.COMP_RIGHT:h?P.COMP_LEFT:P.VIEWPORT_RIGHT):g.gfpp===P.COMP_LEFT?c<=d?(m=t.x+d+y+l<a.rightX,h=t.x-y-l>=a.x,g.compPanel=m?P.COMP_RIGHT:h?P.COMP_LEFT:P.VIEWPORT_RIGHT):(h=t.x-y-l>=a.x,g.compPanel=h?P.COMP_LEFT:P.GFPP_RIGHT):g.gfpp===P.VIEWPORT_RIGHT?g.compPanel=P.GFPP_LEFT:g.gfpp===P.VIEWPORT_LEFT&&((m=Math.max(a.x+c,t.x+d)+l<=a.rightX)?a.x+c>t.x+d?g.compPanel=P.GFPP_RIGHT:g.compPanel=P.COMP_RIGHT:g.compPanel=P.VIEWPORT_RIGHT),g}function m(t,e,n){var o=s(t,n,e),r=g(t,o,e,n),a=l(o,r,t,e,n),u=function(t,e,n,o){var r=o.navControlsSize,s=o.viewPort,a=o.pageXBoundary,u={};if(h(n,s.width)){var c=Math.max(a,s.x);u.left=c-n.x+i.NAVIGATION_CONTROLS_POS.LEFT}else switch(e.navControls){case P.VIEWPORT_LEFT:u.left=s.x-n.x+i.NAVIGATION_CONTROLS_POS.LEFT;break;case P.VIEWPORT_RIGHT:u.left=s.rightX-(n.x+r.width+i.NAVIGATION_CONTROLS_POS.LEFT);break;case P.COMP_LEFT:u.left=i.NAVIGATION_CONTROLS_POS.LEFT}switch(t.gfpp){case P.COMP_BOTTOM:u.top=i.NAVIGATION_CONTROLS_POS.BOTTOM;break;case P.COMP_TOP:case P.VIEWPORT_TOP:u.top=i.NAVIGATION_CONTROLS_POS.TOP}return u}(o,r,t,n),c=function(t,e){return e.navControlsSize.width?t.left+e.navControlsSize.width+i.MARGIN_BETWEEN_FOCUS_TAB_AND_COMP_LABELS:0}(u,n);return{gfppStyle:a.gfpp,compPanelStyle:a.compPanel,navControlsStyle:u,editBoxLabelsOffset:c}}function h(t,e){return t.x<1&&t.width>=e}var f=void 0,y=i.compPanelMargins,P={COMP_TOP:"compTop",COMP_BOTTOM:"compBottom",COMP_LEFT:"compLeft",COMP_RIGHT:"compRight",VIEWPORT_TOP:"viewPortTop",VIEWPORT_BOTTOM:"viewPortBottom",VIEWPORT_LEFT:"viewPortLeft",VIEWPORT_RIGHT:"viewPortRight",GFPP_LEFT:"gfppLeft",GFPP_RIGHT:"gfppRight"};return{getCompControlsPositions:function(e,o,r,s,a){s=t(s).pickBy().defaults({gfppSize:{width:0,height:0},navControlsSize:{width:0,height:0},pageXBoundary:0,rotateKnobMargins:{},alignToPageBoundaries:!1}).value();var u=void 0,c=void 0,l=n(r.layout),p=e&&e.id!==r.id;if(f=i.gfppMargins,e&&!p?f=i.navControlsGfppMargins:r.hasLabels&&(f=i.componentLabelsGfppMargins),u=e?m(c=n(e.layout),o,s):m(l,o,s),e&&p){var g=function(e,n,o){if(n.height<o.height+2*i.VIEWPORT_VERTICAL_MARGINS)return e;var r={y:Math.max(e.y,n.y+i.VIEWPORT_VERTICAL_MARGINS),height:Math.min(e.height,n.height-2*i.VIEWPORT_VERTICAL_MARGINS),bottomY:Math.min(e.bottomY,n.bottomY-i.VIEWPORT_VERTICAL_MARGINS)};return t.assign({},e,r)}(s.viewPort,c,l),h=m(l,o,t.defaults({viewPortForChildOfFocused:g},s));u.gfppStyle=h.gfppStyle,u.compPanelStyle=h.compPanelStyle,u.editBoxLabelsOffset=0}return a&&(u.gfppStyle=d(a,s.viewPort,s.gfppSize)),u},getGfppPosition:function(t,e,r){f=i.gfppMargins;var s=n(e),u=o(s,{viewPort:r}),l=p(s,r,t.width);return{top:a(u,s,r,t.height),left:c(l,s,r,t.width,0)}}}}),define("core/utils/fixedPositionPlugins/tinyMenuFixedPositionPlugin",["lodash","core/app/constants"],function(t,e){"use strict";function i(i,n,o){var r=i.components.layout.getRelativeToStructure(n),s={fixedPosition:o},a=e.SIZE_LIMITS.FIXED_TINY_MENU_MAX_Y;r.y>a&&(!function(e,i){var n=e.components.getContainer(i),o=e.documentServices.siteSegments.getHeader();t.isEqual(n,o)||e.components.setContainer(i,o)}(i,n),t.merge(s,i.mobile.mobileOnlyComponents.getTinyMenuDefaultPosition())),i.components.layout.update(n,s)}return i}),define("core/utils/fixedPositionPlugins/fixedPositionPlugins",["lodash","core/utils/fixedPositionPlugins/tinyMenuFixedPositionPlugin"],function(t,e){"use strict";var i={"wysiwyg.viewer.components.mobile.TinyMenu":e};return{registerPlugin:function(t,e){i[t]=e},setFixedPosition:function(e,n,o){var r=e.components.getType(n);return i[r]&&t.isFunction(i[r])?i[r].call(null,e,n,o):function(t,e,i){t.components.layout.updateFixedPosition(e[0],i)}(e,n,o),o}}}),define("core/utils/social",["lodash","util","require","coreUtilsLib"],function(t,e,i,n){"use strict";function o(t){window.open(t)}var r="https://twitter.com/intent/tweet?url=",s="135c3d92-0fea-1f9d-2ba5-2a1dfb04297e",a="feedb3b8-0b1a-413f-bcab-73e805d0f554",u=t.once(function(e){var i=void 0,n=function(){var t=window.location.hostname.match(/editor\.(.*)/);return t?"www."+t[1]:"www.wix.com"}(),o={appId:i=t.includes(n,"wix.com")?"304553036307597":"394905507233800",status:!0,cookie:!0,xfbml:1};e.init(o)});return{openShoutout:function(t){o(["//www.wix.com/my-account/sites/",t,"/app/",s,"?referralInfo=ed_prem_promo","&appState=%3Fdl%3Dmessage%26messageId%3D",a].join(""))},openTwitter:function(t,i){o(function(e,i,n){return e=decodeURIComponent(e),r+t+"&text="+e+"&related="+i+"&hashtags="+n}(i?e.translate("TWITTER_CHECK_OUT_MY_SITE_MSG_PREMIUM"):e.translate("TWITTER_CHECK_OUT_MY_SITE_MSG_NON_PREMIUM"),e.translate("TWITTER_RELATED_WIX_ACCOUNTS"),e.translate("TWITTER_WIX_HASHTAGS")))},openFacebook:function(o,r,s,a){i(["facebook"],function(i){u(i);var n=function(t){return"http://"+r+".wix.com/html5webbuilder/share?utm_campaign=vir_fb_pub_h_"+r+"&experiment_id="+t.replace(/https?:\/\//,"")}(t.clone(o)),c={method:"feed",name:s,description:a,link:o,actions:[{name:e.translate("FACEBBOK_SHARE_MESSAGE"),link:n}]};i.ui(c)},function(t){n.log.error(t)})}}}),define("core/utils/spotifyUtils",["util"],function(t){"use strict";var e=["tracks","albums","artists"],i=t.url.joinURL(t.editorModel.editorBase,"app/external/SpotifySearch/index.html?id=");return{openIframe:function(t,n,o){var r=t.getLanguageCode(),s="spotifySearch_"+Date.now();n=n||e;var a=t.selection.getSelectedComponentType();t.panelManager.openPanel("panels.focusPanels.spotifySearchFocusPanel",{panelName:"Spotify Search",iframeSrc:function(t,e,n){return i+t+"&lang="+n+"&tabs="+JSON.stringify(e)+"&default_tab="+e[0]+"&fontFaceUrl=https://static.parastorage.com/services/wix-public/1.160.0/css/Helvetica/fontFace.css"}(s,n,r),id:s,selectedComponentType:a,callback:o},!1)},validateSpotifyUri:function(t){return function(t){return t&&0===t.indexOf("spotify:")}(t)&&function(t){var e=t.split(":");return e.length>2&&e[e.length-1].length>0}(t)},validateFollowUri:function(t){return 0===t.toLowerCase().indexOf("spotify:artist:")}}}),define("core/utils/uiControlsBIUtil",["lodash","coreBi"],function(t,e){"use strict";var i=e.CONTROLS_TO_EVENTS;return{getEventDefinition:function(t){return i[t]},getParams:function(e,n){var o=t(i[e].fields).keys().union(["value"]).value();return t(n).pick(o).mapValues(function(t){return"boolean"==typeof t?t.toString():t}).value()}}}),define("core/app/styleManager",["lodash"],function(t){"use strict";function e(e,i){return t.isEqual(e,i)}function i(e){var i=e.styles.getAllIds();return t.map(i,e.styles.get)}function n(e,n,o){var r=i(e);return t.filter(r,function(e){return(e.componentClassName===n||o&&o.length>0&&t.includes(o,e.componentClassName))&&"custom"===e.styleType})}function o(e,i){var n=function(e,i){var n=t.find(e,function(t){return t.styles[i]});return n&&n.styles[i]}(e,i);return n?{id:i,compId:"",componentClassName:"",pageId:"",styleType:"system",type:"TopLevelStyle",skin:n,style:{groups:{},properties:{},propertiesSource:{}}}:null}function r(e){var i=t.map(e,function(t,e){return[e,t]});return t.sortBy(i,t.head)}return{getStyleIdByDef:function(n,o,r,s){if("system"===r.styleType)return r.id;var a=function(e,n){var o=i(e);return t.filter(o,{skin:n})}(n,r.skin),u=t.find(a,function(i){if(t.isUndefined(i.style)&&r.style)return!1;if(i.style&&r.style){var n=o.COMPONENT_DEFINITION_MAP[s]?t.keys(o.COMPONENT_DEFINITION_MAP[s].styles):[];return!(!t.includes(n,i.id)&&i.componentClassName!==s)&&e(i.style.properties,r.style.properties)}return!0});return u?u.id:this.createNewStyleByDef(n,r,r.componentClassName)},createNewStyleByDef:function(e,i,n){var o=t.cloneDeep(i);return o.styleType="custom",o.componentClassName=o.componentClassName||n,e.styles.createAndAddItem(o).id},getStyleById:function(t,e,i){var n=t.styles.get(i);return n||(n=o(e.COMPONENT_DEFINITION_MAP,i)),n},getUniqueCustomStyleList:function(e,i,o){var s=n(e,o),a=this.getUniqueThemeStyleList(e,i,o),u=t.uniqBy(s,function(t){return JSON.stringify(t.style?r(t.style.properties):{})});return t.remove(u,t.bind(function(e){return t.find(a,t.bind(function(t){return this.isEqualWithoutTypeConsideration(e,t)},this))},this)),t.sortBy(u,"skin")},getUniqueThemeStyleList:function(e,i,n){var o=this.getThemedStyleForComp(e,i,n),s=t.uniqBy(o,function(t){return JSON.stringify(t.style?r(t.style.properties):{})+t.skin});return t.sortBy(s,"skin")},getThemedStyleForComp:function(e,i,n){var o=i.COMPONENT_DEFINITION_MAP[n]?t.keys(i.COMPONENT_DEFINITION_MAP[n].styles):[];return t.map(o,t.bind(function(t){return this.getStyleById(e,i,t)},this))},getDuplicateToStyleList:function(e,i,o,r,s){var a=this.getThemedStyleForComp(e,i,r),u=n(e,r,s),c=a.concat(u);return t(c).reject({id:o.id}).filter(this.isEqualWithoutTypeConsideration.bind(this,o)).value()},getUniqueStyleList:function(t,e,i){var n=this.getUniqueCustomStyleList(t,e,i);return this.getUniqueThemeStyleList(t,e,i).concat(n)},isEqual:function(t,i){if(!t||!i)throw new Error("Style is not defined");return t.skin===i.skin&&t.styleType===i.styleType&&("system"===t.styleType?t.id===i.id:!t.style||!i.style||e(t.style.properties,i.style.properties))},isEqualWithoutTypeConsideration:function(t,i){if(!t||!i)throw new Error("Style is not defined");return t.skin===i.skin&&(!t.style||!i.style||e(t.style.properties,i.style.properties))},getTempStyleId:function(t,e){var i=this.createNewStyleByDef(t,e);return t.styles.setExcluded(i),i},prepareTempStyleValue:function(t){t.styleType="custom"}}}),define("core/utils/defaultActions/mediaManagerDefaultActions",["lodash","util","constants","core/app/styleManager","core/utils/mediaManagerPresetUtil","core/utils/updateLayoutUtil"],function(t,e,i,n,o,r){"use strict";function s(e,i,n){var s=e.components.data.get(i),a=e.components.design.get(i),u=t.get(s,["svgId"]),m="shape"===n?l:c,h=o.getPath(e,u)||m,f=e.media.vectorImage.getSvgInfoFromCache(u);e.mediaServices.mediaManager.open(e.mediaServices.mediaManager.categories[p],{multiSelect:!1,callback:function(n,u){if(!t.isEmpty(n)){var c=t.get(n,[0,"title"],""),l=t.get(n,[0,"uri"]);e.media.vectorImage.fetchSvg(l,t.noop),e.documentServices.waitForChangesApplied(function(){var n=t.assign({},s,{svgId:l,title:c}),o=t.get(e.media.vectorImage.getSvgInfoFromCache(l),"svgType"),u=t.assign({},a,function(e,i,n){var o=t.assign(t.omit(i,"svgType"),t.get(e,"overrideColors")),r=t.get(e,["shapeStyle"]),s=t.get(r,["opacity"],d.opacity),a=o.color1&&!o.color2?o.color1:g.color1,u=void 0;switch(n){case"shape":u={overrideColors:{color1:a},shapeStyle:t.defaults(r,d)};break;case"tint":u={overrideColors:{color1:a},shapeStyle:{opacity:s}};break;case"color":u={overrideColors:null,shapeStyle:{opacity:s}}}return u}(a,f,o));e.components.data.update(i,n,!0),e.components.design.update(i,u,!0),e.documentServices.waitForChangesApplied(function(){!function(t,e){var i=t.components.properties.get(e);if("fit"===i.displayMode||"legacyFit"===i.displayMode){var n=t.media.vectorImage.getSvgOriginalAspectRatio(e);r.resetCompLayoutToAspectRatio(t,e,n),t.components.properties.update(e,{displayMode:"fit"},!0)}}(e,i),e.history.add("Change Vector Image")})}),o.storePath(e,l,u.path)}},path:h})}var a=["uri","width","height","title","originalImageDataRef","type"],u=["uri","width","height","title"],c="public/3980fbc8-b1b0-4ebd-9bda-2c0578ca9462/d9b8c13b-6067-4103-bdb7-cbe035b07711",l="public/ec9ed40a-6502-4df2-a088-355405d7bd25/6a7c5cab-2dfb-4447-bdea-93157abf1300",p="VECTOR_ART",d=i.VECTOR_IMAGE_DEFAULTS.VECTOR_SHAPE_DEFAULT_STYLE,g=i.VECTOR_IMAGE_DEFAULTS.VECTOR_SHAPE_COLOR_DEFAULT;return{changeBgImageStrip:function(e,i){e.mediaServices.mediaManager.open(e.mediaServices.mediaManager.categories.IMAGE,{multiSelect:!1,callback:function(n){if(n){var o=t.pick(n[0],a);o.uri=n[0].fileName,o.originalImageDataRef=null,o.type="Image",o.crop=null,e.components.data.update(i,o,!0),e.history.add("Change Image")}}})},changeClipArt:function(i,n,r){var s=i.components.data.get(n),a=o.getPath(i,s.uri);i.mediaServices.mediaManager.open(r,{multiSelect:!1,translation:{submitButton:e.translate("MMGR_submitbutton_onstage_clipart_freeclipart_choose")},path:a,callback:function(e,r){if(e){var s=t.pick(e[0],u);s.uri=e[0].fileName,s.originalImageDataRef=null,s.crop=null,o.storePath(i,s.uri,r.path),i.components.data.update(n,s,!0),i.history.add("Change Clipart")}}})},changeDocumentMedia:function(e,i){var n=e.mediaServices;n.mediaManager.open(n.mediaManager.categories.DOCUMENT,{multiSelect:!1,callback:function(n){if(!t.isEmpty(n)){var o=e.components.data.get(i),r=t.cloneDeep(o.link),s=n[0];r.name=s.title,r.docId=s.fileUrl,o.link=r,e.components.data.update(i,o)}}})},changeFlashComponent:function(e,i){var n=e.mediaServices;n.mediaManager.open(n.mediaManager.categories.FLASH,{multiSelect:!1,callback:function(n){if(!t.isEmpty(n)){var o=n[0],r=e.components.data.get(i);t.assign(r,{uri:o.fileName},t.pick(o,["width","height","title"])),e.components.data.update(i,r)}}})},changePinterestPinIt:function(e,i){var n=e.mediaServices;n.mediaManager.open(n.mediaManager.categories.IMAGE,{multiSelect:!1,callback:function(n){if(!t.isEmpty(n)){var o=e.components.data.get(i);o.uri=n[0].fileName,e.components.data.update(i,o)}}})},changeSingleAudioPlayer:function(e,i){var n=e.mediaServices;n.mediaManager.open(n.mediaManager.categories.MUSIC,{multiSelect:!1,callback:function(n){if(!t.isEmpty(n)){var o=n[0],r=e.components.data.get(i);t.assign(r,{uri:o.fileUrl,originalFileName:o.title,artist:"Unknown Artist",track:"Unknown Track"}),e.components.data.update(i,r)}}})},changeSvgShape:function(i,o,r){var s=i.mediaServices;s.mediaManager.open(s.mediaManager.categories.SHAPE,t.assign({multiSelect:!1,callback:function(r){if(!t.isEmpty(r)){var s=e.svgUrlParser.parseSvgSkinFromUrl(r[0].fileUrl),a=function(t,e){var i=t.components.style.getId(e);return t.theme.styles.get(i)}(i,o);if(s!==a.skin){a.skin=s;var u=n.getStyleIdByDef(i.theme,i.components,a,i.components.getType(o));i.components.style.setId(o,u),i.history.add("Change Shape")}}}},r))},changeVectorImage:function(t,e){var i=t.components.data.get(e);s(t,e,t.media.vectorImage.getSvgInfoFromCache(i.svgId).svgType)},changeWPhoto:function(e,i){e.mediaServices.mediaManager.open(e.mediaServices.mediaManager.categories.IMAGE,{multiSelect:!1,callback:function(n){if(n){var o=t.pick(n[0],a);o.uri=n[0].fileName,o.originalImageDataRef=null,o.crop=null,e.components.data.update(i,o,!0),e.history.add("Change Image")}}})}}}),define("core/utils/componentsDefaultAction",["lodash","core/bi/bi","core/app/constants","core/utils/defaultActions/mediaManagerDefaultActions","core/utils/spotifyUtils"],function(t,e,i,n,o){"use strict";function r(t,e){e&&t.openComponentPanel(e)}function s(t){return function(e){r(e,t)}}function a(t,e){t.panelHelpers.openOrganizeImagesPanel(function(i){var n=t.components.data.get(e);n.items=i,t.components.data.update(e,n)})}function u(t){t.openPagesPanel()}return{WRichText:function(t,n,o){t.isMobileEditor()?r(t,i.componentPanels.settings):(t.bi.event(e.events.textControls.Text_Panel_opened,{origin:o}),t.text.startEditing())},Container:s(i.componentPanels.design),FiveGridLine:s(i.componentPanels.design),FooterContainer:s(i.componentPanels.design),HeaderContainer:s(i.componentPanels.design),screenWidthContainer:s(i.componentPanels.design),Page:s(i.componentPanels.design),VerticalLine:s(i.componentPanels.design),Anchor:s(i.componentPanels.settings),ContactForm:s(i.componentPanels.settings),FacebookLikeBox:s(i.componentPanels.settings),FacebookShare:s(i.componentPanels.settings),FlickrBadgeWidget:s(i.componentPanels.settings),BoxSlideShow:s(i.componentPanels.settings),GoogleMap:s(i.componentPanels.settings),HtmlComponent:s(i.componentPanels.settings),ImageButton:s(i.componentPanels.settings),ItunesButton:s(i.componentPanels.settings),PayPalButton:s(i.componentPanels.settings),PinItPinWidget:s(i.componentPanels.settings),PinterestFollow:s(i.componentPanels.settings),SiteButton:s(i.componentPanels.settings),SkypeCallButton:s(i.componentPanels.settings),SoundCloudWidget:s(i.componentPanels.settings),SpotifyFollow:s(i.componentPanels.settings),SubscribeForm:s(i.componentPanels.settings),Video:s(i.componentPanels.settings),VKShareButton:s(i.componentPanels.settings),WFacebookLike:s(i.componentPanels.settings),WTwitterFollow:s(i.componentPanels.settings),WTwitterTweet:s(i.componentPanels.settings),YouTubeSubscribeButton:s(i.componentPanels.settings),AudioPlayer:function(e,i){var n=e.mediaServices;n.mediaManager.open(n.mediaManager.categories.MUSIC,{multiSelect:!1,callback:function(n){if(!t.isEmpty(n)){var o=e.components.data.get(i);o.uri=n[0].fileName,e.components.data.update(i,o)}}})},BgImageStrip:n.changeBgImageStrip,ClipArt:n.changeClipArt,DocumentMedia:n.changeDocumentMedia,FlashComponent:n.changeFlashComponent,PinterestPinIt:n.changePinterestPinIt,SingleAudioPlayer:n.changeSingleAudioPlayer,SvgShape:n.changeSvgShape,VectorImage:n.changeVectorImage,WPhoto:n.changeWPhoto,DropDownMenu:u,GalleryDefaultAction:a,MatrixGallery:a,SliderGallery:a,PaginatedGridGallery:a,Impress:a,Masonry:a,Thumbnails:a,StripSlideshow:a,StripShowcase:a,Accordion:a,Freestyle:a,Collage:a,Honeycomb:a,SlideShowGallery:a,TPA3DGallery:a,TPA3DCarousel:a,LinkBar:function(t){t.panelHelpers.openOrganizeSocialIconsPanel()},SpotifyPlayer:function(t,e){o.openIframe(t,null,function(i){var n=t.components.data.get(e);i&&i.uri&&i.uri!==n.uri&&(t.components.data.update(e,{uri:i.uri}),t.history.add("Change Spotify Track"))})},TinyMenu:u,VerticalMenu:u}}),define("core/utils/componentPreviewReadyPlugins/componentPastePlugins",["lodash"],function(t){"use strict";function e(e,i){return t.isEqual(i.controllerRef,e.controllerRef)&&t.isEqual(i.role,e.role)}function i(i,n){var o=function(e,i){var n=i.id&&e.components.get.byId(i.id);return n&&e.components.is.exist(n)?t.omit(i,"id"):i}(i,t.cloneDeep(n)),r=i.documentServices.platform.serialization.getConnectedComponents(o),s=t.transform(r,function(n,o,r){n[r]=function(i,n,o){var r=i.components.get.byId(n,i.documentServices.pages.getFocusedPageId());if(!r)return[];var s=i.documentServices.platform.controllers.connections.get(r);return t.reject(o,function(i){return t.find(s,t.partial(e,i))})}(i,r,o)},{});return i.documentServices.platform.serialization.setConnectedComponents(o,s)}var n="platform.components.AppController";return{removeConnectedComponentsIfAlreadyExist:i,removeSerializedDataId:function(e,i){return i.componentType===n?i:t.omit(i,"id")}}}),define("core/utils/componentPreviewReadyPlugins/componentPreviewReadyPlugins",["lodash","core/utils/componentPreviewReadyPlugins/formPlugin","core/utils/componentPreviewReadyPlugins/componentPastePlugins"],function(t,e,i){"use strict";return[function(i,n){var o=n.components.get.byType(i);t.forEach(o,function(i){var o=n.components.data.get(i),r=t.clone(o);e.updateDataWithDefaults(o,n),t.isEqual(o,r)||n.components.data.update(i,o)})}.bind(null,["wysiwyg.viewer.components.ContactForm","wysiwyg.viewer.components.DynamicContactForm","wysiwyg.common.components.subscribeform.viewer.SubscribeForm"]),function(t){t.registerPasteComponentPlugin("platform.components.AppController",i.removeConnectedComponentsIfAlreadyExist),t.registerPasteComponentPlugin("*",i.removeSerializedDataId)}]}),define("core/utils/pageUtils/blogTypeUtils",[],function(){"use strict";var t={isBlog:function(t,e){return!!e.appInnerID&&"blog"===t.documentServices.wixapps.classics.getPackageName(e.appInnerID)},isBlogSpecialPage:function(t){return"7326bfbb-4b10-4a8e-84c1-73f776051e10"===t.appPageId},isBlogSectionPage:function(e,i){return t.isBlog(e,i)&&!t.isBlogSpecialPage(i)}};return t}),define("core/utils/pageUtils/dynamicTypeUtils",["lodash"],function(t){"use strict";function e(e,i){return t.isObject(function(e,i){var n=t.get(i,"id")&&e.documentServices.pages.getReference(i.id);return n&&e.documentServices.routers.getRouterRef.byPage(n)}(e,i))}return{isDynamicPage:e}}),define("core/utils/pageUtils/tpaTypeUtils",[],function(){"use strict";var t={isTPA:function(t){return!!t.tpaApplicationId},isTPASpecialPage:function(e,i,n){if(!t.isTPA(i))return!1;var o=e.pages.isContainsCompWithType(i.id,e.documentServices.tpa.constants.COMP_TYPES.TPA_MULTI_SECTION),r=!n||!e.documentServices.routers.getRouterDataForPageIfExist(i.id);return o&&r},isPageNotVisibleInPagesMenu:function(t,e){return t.documentServices.tpa.isPageMarkedAsHideFromMenu(e.tpaApplicationId,e.tpaPageId)}};return t}),define("core/utils/pageUtils/wixStoreTypeUtils",["lodash","core/utils/pageUtils/tpaTypeUtils"],function(t,e){"use strict";function i(t,i,n){return function(t,i){if(e.isTPA(i)){var n=t.documentServices.tpa.section.getPageData(i.id).appData;return n&&n.appDefinitionId}}(i,n)===t}function n(t,e){return e.tpaPageId===t}var o={PRODUCT_PAGE:"product_page",SHOPPING_CART_PAGE:"shopping_cart",THANK_YOU_PAGE:"thank_you_page"};return{isWixStore:t.partial(i,"1380b703-ce81-ff05-f115-39571d94dfcd"),isWixStoreCartPage:t.partial(n,o.SHOPPING_CART_PAGE),isWixStoreThankYouPage:t.partial(n,o.THANK_YOU_PAGE),isWixStoreProductPage:t.partial(n,o.PRODUCT_PAGE)}}),define("core/mixins/editorAPIMixin",["prop-types"],function(t){"use strict";return{contextTypes:{editorAPI:t.object},getEditorAPI:function(){return this.context.editorAPI}}}),define("core/app/lazyComponent",["react","lodash","coreUtilsLib"],function(t,e,i){"use strict";var n={},o={};return t.createClass({displayName:"LazyLoader",statics:{isLoaded:function(t){return e.has(n,t)}},componentWillMount:function(){},componentWillReceiveProps:function(t){this.props.moduleName!==t.moduleName&&(o[this.props.moduleName]=e.without(o[this.props.moduleName],this))},componentWillUnmount:function(){o[this.props.moduleName]=e.without(o[this.props.moduleName],this)},render:function(){var r=this.props.moduleName;if(r&&!n.hasOwnProperty(r)){var s=function(t){return t.split(".")[0]}(this.props.moduleName),a=function(t){return t.split(".").slice(1)}(this.props.moduleName);if(require.defined(s)){var u=e.get(require(s),a);u?n[r]=u:i.log.warn("(lazyComponent.js) -> Module [["+r+"]] has not yet loaded. It is possible that this has not yet been implemented in the editor.")}else o.hasOwnProperty(r)||(o[r]=[]),e.includes(o[r],this)||o[r].push(this),require([s],function(t,r,s){for(var a=s,u=0;u<r.length;u++){if(!a.hasOwnProperty(r[u]))return void i.log.warn("(lazyComponent.js) -> Module [["+t+"]] has not yet loaded. It is possible that this has not yet been implemented in the editor.");a=a[r[u]]}n[t]=a,e.forEach(o[t],function(t){e.has(t.props,"onLoad")?t.props.onLoad():t.forceUpdate()})}.bind(null,r,a))}if(!this.props.placeHolder&&n[r]){var c=e.omit(this.props,["moduleName"]);return t.createElement(n[r],c)}return null}})}),define("core/app/designManager",["lodash"],function(t){"use strict";function e(e,i){return!t.isUndefined(o[e])&&!t.isUndefined(o[e][i.charas])}function i(i,n){return t(i.components.getAllComponents()).filter(t.flow(i.components.getType,t.partial(t.includes,n))).map(function(t){return{compRef:t,design:i.components.design.get(t)}}).reject(function(n){var o=i.components.getType(n.compRef),r=n.design;return function(e){var i=(e=e||this.props.compDesign).cssStyle;return t(i).keys().every(function(e){return t.isNull(i[e])})}(r)||e(o,r)}).uniqBy("design.charas").value()}var n={},o={};return{getPersonalizedDesigns:i,addPersonalizedDesign:function(e,i){t.isUndefined(n[e])&&(n[e]={}),n[e][i.charas]=i},removePersonalizedDesign:function(e,i){delete n[e][i.charas],t.isEmpty(n[e])&&delete n[e]},addThemePresetDesign:function(e,i){t.isUndefined(o[e])&&(o[e]={}),o[e][i.charas]=i},isThemeDesign:e}}),define("core/app/premiumServicesAPI",["jquery","lodash","util"],function(t,e,i){"use strict";function n(i,n,a){var u=t.ajax({type:"GET",dataType:"json",url:s+i});u.done(function(t,i){if("success"!==i)a();else{var s=function(t){return e.has(t,"payload.domain.domainName")&&e.has(t,"payload.domain.checkStatus")&&t.payload.domain.checkStatus===o}(t),u=function(t){var i=e.get(t,"payload.domain.domainName","");return e.isEmpty(i)||e.includes(i,r)||(i=r+i),e.isEmpty(i)?null:i}(t),c=function(t){return!e.isNil(e.get(t,"payload.plan.cycle"))}(t);n({isDomainConnected:s,sitePublishedDomain:u,isSitePremium:c})}}),u.fail(a)}var o=0,r="http://",s=i.serviceTopology.premiumStateApiUrl;return s=s?s.replace(/wix\/getTpaPremiumState/,"premium-management/external/getDocPremiumState?siteGuid="):"//editor.wix.com/_api/premium-management/external/getDocPremiumState?siteGuid=",{getSiteDomainInfo:n}}),define("core/utils/menuUtils/tpaPages",["lodash","core/utils/pageUtils/tpaTypeUtils"],function(t,e){"use strict";function i(e,i,n){return t.includes(i,n.tpaApplicationId)&&!t.has(e,n.id)}var n={getSectionPagesDataList:function(n,o){var r=function(i,n){return t(i).filter(t.partial(e.isTPASpecialPage,n)).keyBy("id").value()}(o,n),s=function(e,i){return t(e).filter(function(e){return t.has(i,e.id)}).map("tpaApplicationId").uniq().value()}(o,r);return t.filter(o,t.partial(i,r,s))},getSpecialPagesDataList:function(i,n){return t.filter(n,t.partial(e.isTPASpecialPage,i))},getSpecialPagesDataListByTPAId:function(e,i,o){return t.filter(n.getSpecialPagesDataList(e,o||e.documentServices.pages.getPagesData()),["tpaApplicationId",i])}};return n}),define("core/utils/menuUtils/blogPages",["lodash","core/utils/pageUtils/blogTypeUtils"],function(t,e){"use strict";return{getSectionPagesDataList:function(i,n){return t.filter(n,t.partial(e.isBlogSectionPage,i))},getSpecialPagesDataList:function(i,n){return t.filter(n,e.isBlogSpecialPage)}}}),define("core/utils/menuUtils/menuLogic",["lodash","core/utils/menuUtils/tpaPages","core/utils/menuUtils/blogPages","core/utils/pageUtils/blogTypeUtils","core/utils/pageUtils/tpaTypeUtils","core/utils/pageUtils/dynamicTypeUtils"],function(t,e,i,n,o,r){"use strict";var s=n.isBlog,a=o.isTPA;return{isSpecialPage:function(e,i,s){return n.isBlogSpecialPage(i)||o.isTPASpecialPage(e,i)||function(e,i,n){return n?t.has(n,i.id):r.isDynamicPage(e,i)}(e,i,s)},isSubPageMenuItem:function(t,e){return this.isSpecialPage(t,e)&&!o.isPageNotVisibleInPagesMenu(t,e)},getSectionPagesIds:function(n,o){var r=e.getSectionPagesDataList(n,o),s=i.getSectionPagesDataList(n,o);return t.union(t.map(r,"id"),t.map(s,"id"))},getSpecialPagesListBySectionPageOrBySibling:function(t,n,o){if(n){if(s(t,n))return function(t,e){return i.getSpecialPagesDataList(t,e||t.documentServices.pages.getPagesData())}(t,o);if(a(n))return function(t,i,n){return e.getSpecialPagesDataListByTPAId(t,i,n)}(t,n.tpaApplicationId,o)}return[]},getSectionPageDataBySpecialPage:function(n,o){var r=n.documentServices.pages.getPagesData(),u=void 0;if(s(n,o))return t.head(i.getSectionPagesDataList(n,r));if(a(o)){u=e.getSectionPagesDataList(n,r);var c=t.find(u,{tpaApplicationId:o.tpaApplicationId});if(!c){var l=n.homePage.get();c=t.find(r,{id:l})}return c}return o}}}),define("core/utils/pageUtils/pageTitleUtils",["util"],function(t){"use strict";var e=40;return{generateDuplicatedTitle:function(i){var n=new RegExp(/copy\s(\d+\s|)of\s/i),o=void 0;return n.test(i)?(o=RegExp.$1?parseInt(RegExp.$1,10)+1:2,i.replace(n,"Copy "+o+" of ")):((i=t.translate("Pages_Actions_Duplicate_CopyOf")+" "+i).length>e&&(i=i.substr(0,e-3)+"..."),i)},convertPageNameToUrl:function(e){var i=e.replace(/\s/g,"-");return t.validate.byInvalidCharacters(t.validationExpressions.invalidUrlCharacters)(i)?i.toLowerCase():"blank"}}}),define("core",["core/utils/addUtil","core/utils/AddPanelDragHandler","core/utils/AddPanelSectionDragHandler","core/utils/AttachHandler","core/utils/AttachHandlerExperimentAttachImprovements","core/utils/updateLayoutUtil","core/utils/layoutConstraintsUtil/LayoutConstraintsUtil","core/utils/updateDataUtil","core/utils/updatePropertiesUtil","core/utils/DragConstraintsHandler","core/utils/layoutTransitionsUtil","core/utils/SnapToHandler","core/utils/stageUtils","core/utils/scrollUtils","core/utils/compControlsMeasurer","core/utils/fixedPositionPlugins/fixedPositionPlugins","core/utils/social","core/utils/spotifyUtils","core/utils/uiControlsBIUtil","core/utils/componentsDefaultAction","core/utils/componentPreviewReadyPlugins/componentPreviewReadyPlugins","core/utils/compsSectionsAnalyzer","core/utils/sectionsReorganizeUtil","core/utils/pageUtils/blogTypeUtils","core/utils/pageUtils/dynamicTypeUtils","core/utils/pageUtils/tpaTypeUtils","core/utils/pageUtils/wixStoreTypeUtils","core/utils/mouseMoveActions/sectionDrag","core/utils/mouseCoordinatesHandler","core/utils/gridLinesUtil","core/mixins/editorAPIMixin","core/app/constants","core/app/lazyComponent","core/app/styleManager","core/app/designManager","core/app/premiumServicesAPI","core/bi/bi","core/utils/menuUtils/menuLogic","core/utils/mediaManagerPresetUtil","core/utils/pageUtils/pageTitleUtils"],function(t,e,i,n,o,r,s,a,u,c,l,p,d,g,m,h,f,y,P,v,S,C,T,I,x,A,w,b,E,R,O,M,_,D,L,U,F,B,N,k){"use strict";return{constants:M,utils:{pageTitleUtils:k,menuLogic:B,addUtil:t,AddPanelDragHandler:e,AddPanelSectionDragHandler:i,AttachHandler:n,AttachHandlerExperimentAttachImprovements:o,DragConstraintsHandler:c,updateLayoutUtil:r,LayoutConstraintsUtil:s,updateDataUtil:a,updatePropertiesUtil:u,layoutTransitionsUtil:l,SnapToHandler:p,stageUtils:d,scrollUtils:g,fixedPositionUtils:h,social:f,spotifyUtils:y,compControlsMeasurer:m,uiControlsBIUtil:P,componentsDefaultAction:v,compsSectionsAnalyzer:C,sectionsReorganizeUtil:T,componentPreviewReadyPlugins:S,blogTypeUtils:I,dynamicTypeUtils:x,tpaTypeUtils:A,wixStoreTypeUtils:w,mouseCoordinatesHandler:E,gridLinesUtil:R,mediaManagerPresetUtil:N,sectionDrag:b},mixins:{editorAPIMixin:O},lazyComponent:_,styleManager:D,designManager:L,premiumServicesAPI:U,bi:F}});
//# sourceMappingURL=core.min.js.map